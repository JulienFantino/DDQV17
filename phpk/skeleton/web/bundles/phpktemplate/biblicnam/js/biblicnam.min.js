
var ZoomTag=new function(){this.tailleinit=62.5;this.palierinit=1;this.nbzoom=5;this.pourcentzoom=12.5;this.nomCookiePalier="cookiePalier";this.uniteZoom="%";this.creerCookie=function(palier){document.cookie=this.nomCookiePalier+"="+palier;};this.lireCookie=function(){var cookie=document.cookie;var deb=cookie.indexOf(this.nomCookiePalier+"=");if(deb>=0){var str=cookie.substring(deb,cookie.length);var fin=str.indexOf(";");if(fin<0){fin=str.length;}
str=str.substring(0,fin).split("=");return unescape(str[1]);}else{return null;}};this.toggleAriaPressed=function(cssClass){$$(cssClass).each(function(bouton){if(bouton.getProperty('aria-pressed')==='false'){bouton.setProperty('aria-pressed','true');}else{bouton.setProperty('aria-pressed','false');}});};this.initSpan=function(){var zoomElements=$$('.cnamts-zoomtexte');zoomElements.each(function(zoomspan){var zoomAgrandir=new Element('span',{title:'Agrandir le texte',tabindex:'0',role:'button'});zoomAgrandir.addClass('zoom-agrandir');zoomAgrandir.inject(zoomspan);var zoomReduire=new Element('span',{title:'R\u00e9duire le texte',tabindex:'0',role:'button'});zoomReduire.addClass('zoom-reduire');zoomReduire.inject(zoomspan);zoomAgrandir.addEvents({'click':function(){ZoomTag.zoom();},'keydown':function(event){if(event.key==='enter'){ZoomTag.zoom();}}});zoomReduire.addEvents({'click':function(){ZoomTag.dezoom();},'keydown':function(event){if(event.key==='enter'){ZoomTag.dezoom();}}});});this.toggleAriaPressed('.zoom-agrandir');this.toggleAriaPressed('.zoom-reduire');};this.initZoom=function(){this.initSpan();var body=document.getElementsByTagName("body")[0];var palierActu=this.lireCookie();if(palierActu===null||palierActu===''||(palierActu<this.palierinit)){body.style.fontSize=this.tailleinit+this.uniteZoom;this.creerCookie(this.palierinit);}else{if(palierActu>this.palierinit+this.nbzoom){body.style.fontSize=(this.tailleinit+(this.nbzoom*this.pourcentzoom))+this.uniteZoom;this.creerCookie(this.palierinit+this.nbzoom);}else{body.style.fontSize=(((parseInt(palierActu)-1)*this.pourcentzoom)+this.tailleinit)+this.uniteZoom;}}};this.zoom=function(){this.toggleAriaPressed('.zoom-agrandir');var body=document.getElementsByTagName("body")[0];var palierActu=this.lireCookie();if(palierActu<=this.nbzoom){var nouvellevaleur=(((parseInt(palierActu))*this.pourcentzoom)+this.tailleinit);body.style.fontSize=nouvellevaleur+this.uniteZoom;this.creerCookie(parseInt(palierActu)+1);}
this.toggleAriaPressed('.zoom-agrandir');};this.dezoom=function(){this.toggleAriaPressed('.zoom-reduire');var body=document.getElementsByTagName("body")[0];var palierActu=this.lireCookie();if(palierActu>this.palierinit){var nouvellevaleur=(((parseInt(palierActu)-2)*this.pourcentzoom)+this.tailleinit);body.style.fontSize=nouvellevaleur+this.uniteZoom;this.creerCookie(parseInt(palierActu)-1);}
this.toggleAriaPressed('.zoom-reduire');};};
var MenuTag=new Class({Implements:[Options],options:{menuover:false},element:null,initialize:function(element,options){this.setOptions(options);this.element=element;this.initEvents();this.hierarchyHighlight();this.updateTabindex();if(this.options.menuover&&!('ontouchstart'in window)){this.menuOverEvents();}},initEvents:function(){var self=this;this.element.getElements('a').each(function(lien){if(lien.hasClass(MenuTag.classPlier)||lien.hasClass(MenuTag.classDeplier)){lien.addEvent('click',function(event){event.preventDefault();self.toggle(this.id);});}});this.element.addEvent('keydown',function(event){var lien=$(event.target);var role=lien.getParent('ul[role]').get('role');var subMenu=lien.getNext('ul');var items=(subMenu===null?null:subMenu.getChildren('li > a'));switch(event.key){case MenuTag.navigKeys[role].open:case'space':event.preventDefault();lien.fireEvent('click',event);if(subMenu!==null){lien.set('tabindex',-1);items[0].set('tabindex',0);items[0].focus();}
break;case MenuTag.navigKeys[role].previous:event.preventDefault();if(lien.hasClass(MenuTag.classDeplier)){lien.set('tabindex',-1);items[items.length-1].set('tabindex',0);items[items.length-1].focus();}else{MenuTag.previousKey(lien);}
break;case MenuTag.navigKeys[role].next:event.preventDefault();if(lien.hasClass(MenuTag.classDeplier)){lien.set('tabindex',-1);items[0].set('tabindex',0);items[0].focus();}else{MenuTag.nextKey(lien);}
break;case MenuTag.navigKeys[role].close:case'esc':var menuGroup=lien.getParent('ul');if(menuGroup.hasClass("niveau2")||menuGroup.hasClass("niveau3")){var linkMenuGroup=menuGroup.getPrevious('a');linkMenuGroup.fireEvent('click',event);lien.set('tabindex',-1);linkMenuGroup.set('tabindex',0);linkMenuGroup.focus();}
break;default:break;}});},menuOverEvents:function(){var self=this;this.element.getElements('li[role=menuitem]').each(function(li){li.addEvent('mouseenter',function(event){event.stop();if(this.getFirst('a').hasClass(MenuTag.classPlier)){self.toggle(this.getFirst('a').id);self.updateTabindex();}});});},hierarchyHighlight:function(){var courant=this.element.getElement('.courant');if(courant){var parents=courant.getParents('li[role=menuitem]').reverse();var parentsText=parents.map(function(menuParent){return menuParent.getFirst('a').get('text');});parents.each(function(menuParent){menuParent.addClass('mev');if(MenuTag.titlePrefix!==null){menuParent.getFirst('a').set('title',MenuTag.titlePrefix+parentsText.join(' / '));}});}},updateTabindex:function(){this.element.getElements('a').each(function(lien){lien.set('tabindex',-1);});if(this.element.getElement('.courant')===null||!this.element.getElement('.courant').isVisible()){this.element.getElement('a').set('tabindex',0);}else{this.element.getElement('.courant').set('tabindex',0);}},toggle:function(menuId){if(MenuTag.getSousMenu(menuId)){if($(menuId).hasClass(MenuTag.classDeplier)){MenuTag.replier(menuId);}else{this.element.getElements('a').each(function(lien){if(lien.hasClass(MenuTag.classDeplier)){MenuTag.replier(lien.id);}});MenuTag.deplier(menuId);}}}});MenuTag.Vertical=new Class({Extends:MenuTag,initialize:function(element,options){this.parent(element,options);},toggle:function(menuId){if(MenuTag.getSousMenu(menuId)){if($(menuId).hasClass(MenuTag.classDeplier)){MenuTag.replier(menuId);}else{MenuTag.deplier(menuId);}}}});MenuTag.Mixte=new Class({Extends:MenuTag,initialize:function(element,options){this.parent(element,options);this.element.getElements('a').each(function(lien){if(lien.hasClass(MenuTag.classDeplier)){MenuTag.replier(lien.id);}});this.menuCloseEvents();},menuOverEvents:function(){var self=this;this.element.getElements('li[role=menuitem]').each(function(li){li.addEvent('mouseenter',function(event){event.stop();self.toggle(this.getFirst('a').id);});});this.element.addEvent('mouseleave',function(event){event.stop();self.element.getElements('a').each(function(lien){if(lien.hasClass(MenuTag.classDeplier)){MenuTag.replier(lien.id);}});});},menuCloseEvents:function(){$(document).addEvent('click',function(event){if(this.element.getElement(event.target)===null){this.close();}}.bind(this));$(document).addEvent('keyup',function(event){if(event.key==='tab'&&document.activeElement&&this.element.getElement(document.activeElement)===null){this.close();}}.bind(this));},updateTabindex:function(){this.element.getElements('a').each(function(lien){lien.set('tabindex',-1);});var menuFocusable=this.element.getElement('.niveau1 > .mev > a');if(menuFocusable===null){this.element.getElement('a').set('tabindex',0);}else{menuFocusable.set('tabindex',0);}},toggle:function(menuId){if($(menuId).hasClass(MenuTag.classDeplier)){MenuTag.replier(menuId);}else{this.closeOthers(menuId);if($(menuId).hasClass(MenuTag.classPlier)){MenuTag.deplier(menuId);this.position(menuId);}}},closeOthers:function(menuId){this.element.getElements('a.'+MenuTag.classDeplier).each(function(lien){if(lien.getParent('li').getElement('#'+menuId)===null){MenuTag.replier(lien.id);}});},close:function(){this.element.getElements('a.'+MenuTag.classDeplier).each(function(lien){MenuTag.replier(lien.id);});this.updateTabindex();},position:function(menuId){var sousMenu=MenuTag.getSousMenu(menuId);if(sousMenu.hasClass('niveau2')){sousMenu.setPosition({x:$(menuId).getPosition(this.element).x,y:$(menuId).getComputedSize().height});}
if(sousMenu.hasClass('niveau3')){var ulNiveau2=sousMenu.getParent('li').getParent('ul');var posLiNiveau2=sousMenu.getParent('li').getPosition(ulNiveau2);var posX=ulNiveau2.getComputedSize().width;var sousMenuWidth=sousMenu.measure(function(){return this.getComputedSize();}).totalWidth;if((posX+ulNiveau2.getPosition().x+sousMenuWidth)>window.getSize().x){posX=-1*sousMenuWidth;}
sousMenu.setPosition({x:posX,y:posLiNiveau2.y});}}});MenuTag.extend({components:{},classPlier:"plier",classDeplier:"deplier",classInvisible:"cacher",classVisible:"visible",prefixeSousMenu:"ssMen_",classHorizontal:"nav-horizontal",classMixte:"nav-mixte",titlePrefix:'Vous \u00eates sur ',navigKeys:{menu:{next:"down",previous:"up",open:"right",close:"left"},menubar:{next:"right",previous:"left",open:"down",close:"up"}},init:function(element,options){if(element.hasClass(MenuTag.classHorizontal)){this.components[element.id]=new MenuTag(element,options);}else if(element.hasClass(MenuTag.classMixte)){this.components[element.id]=new MenuTag.Mixte(element,options);}else{this.components[element.id]=new MenuTag.Vertical(element,options);}},replier:function(menuId){$(menuId).swapClass(MenuTag.classDeplier,MenuTag.classPlier);MenuTag.getSousMenu(menuId).swapClass(MenuTag.classVisible,MenuTag.classInvisible);},deplier:function(menuId){$(menuId).swapClass(MenuTag.classPlier,MenuTag.classDeplier);MenuTag.getSousMenu(menuId).swapClass(MenuTag.classInvisible,MenuTag.classVisible);},getSousMenu:function(menuId){return $(MenuTag.prefixeSousMenu+menuId);},previousKey:function(lien){var menuGroup=lien.getParent('ul');var items=menuGroup.getChildren('li > a');var previousLink=items[items.length-1];for(var i=items.length-1;i>0;i--){if(items[i]===lien){previousLink=items[i-1];break;}}
lien.set('tabindex',-1);previousLink.set('tabindex',0);previousLink.focus();},nextKey:function(lien){var menuGroup=lien.getParent('ul');var items=menuGroup.getChildren('li > a');var nextLink=items[0];for(var i=0;i<items.length-1;i++){if(items[i]===lien){nextLink=items[i+1];break;}}
lien.set('tabindex',-1);nextLink.set('tabindex',0);nextLink.focus();}});
function syncSelToTextSimple(champSel,champTextName){var champText=document.getElementById(champTextName);if(champText!==null){if(champSel.selectedIndex>0){if(champText.defaultValue===null){champText.defaultValue=champText.value;}
champText.value=champSel.options[champSel.selectedIndex].text;}else{if(champText.defaultValue!==null){champText.value=champText.defaultValue;}}}}
function syncTextToSelSimple(champText,champSelName){var champSel=document.getElementById(champSelName);var code;var i;if(champSel!==null){code=champText.value;champText.defaultValue=code;lst=champSel.options;lst[0].selected=true;for(i=1;i<lst.length;i++){lst[i].selected=(code===lst[i].text);}}}
function syncSelToTextDouble(champSel,champCodePostalName,champLocaliteName){var champCodePostal=document.getElementById(champCodePostalName);var champLocalite=document.getElementById(champLocaliteName);if(champCodePostal!==null&&champLocalite!==null){if(champSel.selectedIndex>0){if(champCodePostal.defaultValue===null){champCodePostal.defaultValue=champCodePostal.value;}
if(champLocalite.defaultValue===null){champLocalite.defaultValue=champLocalite.value;}
champCodePostal.value=champSel.options[champSel.selectedIndex].getAttribute("value").split('|')[0];champLocalite.value=champSel.options[champSel.selectedIndex].getAttribute("value").split('|')[1];}else{if(champCodePostal.defaultValue!==null){champCodePostal.value=champCodePostal.defaultValue;}
if(champLocalite.defaultValue!==null){champLocalite.value=champLocalite.defaultValue;}}}}
function syncTextToSelDouble(champCodePostalName,champLocaliteName,champSelName){var champCodePostal=document.getElementById(champCodePostalName);var champLocalite=document.getElementById(champLocaliteName);var champSel=document.getElementById(champSelName);var codePostal;var localite;var i;if(champCodePostal!==null&&champLocalite!==null&&champSel!==null){codePostal=champCodePostal.value;localite=champLocalite.value;champCodePostal.defaultValue=codePostal;champLocalite.defaultValue=localite;lst=champSel.options;lst[0].selected=true;for(i=1;i<lst.length;i++){lst[i].selected=(codePostal===lst[i].getAttribute("value").split('|')[0])&&(localite===lst[i].getAttribute("value").split('|')[1]);}}}
function doTrim(string){return String(string).replace(/^\s+|\s+$/g,"").replace(/\s+/g," ");}
function controlRequiredFields(fieldsForm){if(fieldsForm===null||document.forms[fieldsForm]===null){return true;}
var el=document.forms[fieldsForm].elements;if(el===null){return true;}
var i=0;var notFound=true;var element;while(notFound&&(i<el.length)){element=el[i];if(element.getAttribute("obligatoire")!==null&&element.getAttribute("obligatoire")==="true"){notFound=notFound&&(doTrim(element.value).length>0);}
i++;}
if(!notFound){alert('Champ obligatoire');element.focus();}
return notFound;};
var ListNavig={previousKey:function(link){var group=link.getParent('ul');var items=group.getChildren(group.navigChildsSelector);var previousLink=items[items.length-1];for(var i=items.length-1;i>0;i--){if(items[i]===link){previousLink=items[i-1];break;}}
previousLink.focus();},nextKey:function(link){var group=link.getParent('ul');var items=group.getChildren(group.navigChildsSelector);var nextLink=items[0];for(var i=0;i<items.length-1;i++){if(items[i]===link){nextLink=items[i+1];break;}}
nextLink.focus();},initEvents:function(navigContainer){navigContainer.getElements('a').each(function(link){link.addEvent('keydown',function(event){switch(event.key){case'up':case'left':event.preventDefault();ListNavig.previousKey(this);break;case'down':case'right':event.preventDefault();ListNavig.nextKey(this);break;default:break;}});});var section=navigContainer.getNext();if(section!==null&&section.hasClass('section')){section.addEvent('keydown',function(event){if(event.control&&event.key==="up"){navigContainer.getElement('a[tabindex=0]').focus();}});}}};var MessageFormat={format:function(str,col){col=typeof col==='object'?col:Array.prototype.slice.call(arguments,1);return str.replace(/\{\{|\}\}|\{(\w+)\}/g,function(m,n){if(m=="{{"){return"{";}
if(m=="}}"){return"}";}
return col[n];});},pluralFormat:function(pattern01,patterns,test,col){var args=Array.prototype.slice.call(arguments,2);if(test<=1){return MessageFormat.format(pattern01,args);}else{return MessageFormat.format(patterns,args);}}};Fx.TweenBiblicnam=new Class({Extends:Fx.Tween,start:function(from,to){var delta=Math.abs(from-to);if(this.options.threshold&&delta<this.options.threshold){this.calcNewDuration(delta);}
return this.parent(from,to);},calcNewDuration:function(delta){var duration=(delta/this.options.threshold)*this.options.duration;var minDuration=this.options.duration/10;if(duration<minDuration){duration=minDuration;}
this.options.duration=duration;}});
var ArboTag=new Class({Implements:[Options],options:{nodeAction:null,contentContainer:null,branchAction:null},element:null,defaultAction:null,initialize:function(element,defaultAction,options){this.setOptions(options);this.element=element;this.defaultAction=defaultAction;this.initEvents();return this;},initEvents:function(){var self=this;if(self.options.nodeAction!==null&&self.options.contentContainer!==null){self.initAjaxNodeEvents(this.element);}
if(Browser.ie){self.element.getElements('li:last-child').each(function(item){item.addClass('dernier');});}
this.element.getElements('.dossier').each(function(item){if(item.hasClass("ferme")){var childContainer=item.getParent('li').getChildren('ul');if(childContainer!==null){childContainer.addClass('ferme');}}
item.addEvent('click',function(event){event.stop();self.toggleFolder(this);});});var toolbar=this.element.getElement('.actions');if(toolbar!==null){var openAllBtn=new Element('a',{href:'#'+this.element.id,'class':"tout-ouvrir",title:"Tout ouvrir",role:"button"});var closeAllBtn=new Element('a',{href:'#'+this.element.id,'class':"tout-fermer",title:"Tout fermer",role:"button"});openAllBtn.addEvent('click',function(event){event.stop();self.openAll();});closeAllBtn.addEvent('click',function(event){event.stop();self.closeAll();});openAllBtn.inject(toolbar);closeAllBtn.inject(toolbar);}
if($('btn_openall')!==null){$('btn_openall').addEvent('click',function(event){event.stop();self.openAll();});$('btn_closeall').addEvent('click',function(event){event.stop();self.closeAll();});}
self.initTabIndex();DOMEvent.defineKeys({'58':'2points','106':'multiply','111':'divide','170':'mu'});self.element.addEvent('keydown',self.arboKeydownEvent.bind(self));},arboKeydownEvent:function(event){if(ArboTag.isBranchLabel(event.target)){switch(event.key){case'multiply':case'mu':this.openAll();break;case'divide':event.preventDefault();this.closeAll();break;case'2points':if(event.shift){event.preventDefault();this.closeAll();}
break;case'space':event.preventDefault();$(event.target).fireEvent('click',event);break;case'home':event.preventDefault();var firstNode=this.element.getElement('ul a');if(firstNode!==null){ArboTag.switchFocus($(event.target),firstNode);}
break;case'end':event.preventDefault();var lastNode=this.element.getLast('ul:not(.ferme) > li > a');if(lastNode!==null){ArboTag.switchFocus($(event.target),lastNode);}
break;case'left':event.preventDefault();if($(event.target).hasClass('ouvert')){$(event.target).fireEvent('click',event);}else{var branch=$(event.target).getParent('li').getParent('li');if(branch!==null){ArboTag.switchFocus($(event.target),branch.getElement('a'));}}
break;case'right':event.preventDefault();if($(event.target).hasClass('ferme')){$(event.target).fireEvent('click',event);}else{var firstNode=$(event.target).getParent('li').getElement('ul a');if(firstNode!==null){ArboTag.switchFocus($(event.target),firstNode);}}
break;case'up':event.preventDefault();var visibleNodes=this.getVisibleNodes();if(visibleNodes.length>0){var posCurrentNode=visibleNodes.indexOf($(event.target));var posPreviousNode=((posCurrentNode-1)<0?visibleNodes.length-1:posCurrentNode-1);ArboTag.switchFocus($(event.target),visibleNodes[posPreviousNode]);}
break;case'down':event.preventDefault();var visibleNodes=this.getVisibleNodes();if(visibleNodes.length>0){var posCurrentNode=visibleNodes.indexOf($(event.target));var posNextNode=((posCurrentNode+1)>=visibleNodes.length?0:posCurrentNode+1);ArboTag.switchFocus($(event.target),visibleNodes[posNextNode]);}
break;default:break;}}else{switch(event.key){case'left':event.preventDefault();var label=$(event.target).getParent('li[role=treeitem]').getElement('a');if(label){label.focus();}
default:break;}}},getVisibleNodes:function(){if(Browser.ie7||Browser.ie8){return this.element.getElements('ul > li > a').filter(function(item,index){return item.getParent('ul.ferme')===null;});}else{return this.element.getElements('ul:not(.ferme) > li > a');}},selectNode:function(node){this.element.getElements('a.selected, a[tabindex=0]').each(function(link){link.removeClass('selected');link.set('tabindex',-1);link.erase('aria-selected');});node.addClass('selected');node.set('tabindex',0);node.set('aria-selected','true');},initTabIndex:function(){var found=false;this.element.getElements('ul a').each(function(link){if(link.hasClass('selected')){link.set('tabindex',0);found=true;}else{link.set('tabindex',-1);}});if(!found){var firstNode=this.element.getElement('ul a');if(firstNode!==null){firstNode.set('tabindex',0);}}},initAjaxNodeEvents:function(nodeContainer){var self=this;nodeContainer.getElements('ul a:not(.dossier)').each(function(node){if(node.href.indexOf(self.defaultAction)>-1){node.addEvent('click',function(e){e.stop();$(self.options.contentContainer).set('html',ArboTag.nodeWaitMessage);$(self.options.contentContainer).set('load',{method:'post',async:true});$(self.options.contentContainer).load(self.options.nodeAction+'?node='+this.id);self.selectNode(this);});node.set('aria-controls',self.options.contentContainer);}});},openAll:function(){var self=this;this.element.getElements('a.ferme + ul').each(function(element){self.toggleFolder(element.getParent('li').getElement('a'));});},closeAll:function(){var self=this;this.element.getElements('a.ouvert + ul').each(function(element){self.toggleFolder(element.getParent('li').getElement('a'));});},getChildRequest:function(target){var self=this;return new Request.JSON({url:self.options.branchAction,async:true,timeout:ArboTag.timeout,onRequest:function(){ArboTag.addMessageChild(ArboTag.branchWaitMessage,target);target.setProperty('aria-busy','true');},onSuccess:function(data){target.getChildren('ul').destroy();self.parseJsonChildrens(data).inject(target);if(Browser.ie){target.getElements('li:last-child').each(function(item){item.addClass('dernier');});}
target.getElements('ul .dossier').each(function(item){item.addEvent('click',function(event){event.stop();self.toggleFolder(this);});});var childContainer=target.getChildren('ul');if(childContainer.length>0){childContainer.removeClass('ferme');}
self.initTabIndex();target.setProperty('aria-busy','false');},onTimeout:function(){ArboTag.addMessageChild("Délai d'attente dépassé",target);target.setProperty('aria-busy','false');this.cancel();},onError:function(){ArboTag.addMessageChild("Erreur lors de la récupération",target);},onFailure:function(){ArboTag.addMessageChild("Erreur lors du chargement",target);}});},parseJsonChildrens:function(data){var self=this;var ul=new Element('ul');ul.addClass('ferme');for(var i=0;i<data.length;i++){var bean=data[i];var li=new Element('li',{'role':'treeitem'});var elementTitle=null;if(bean.link){elementTitle=new Element('a',{id:bean.key,text:bean.label});elementTitle.href=bean.link;}else if(this.defaultAction.length>0||bean.elements!==undefined||bean.branch){elementTitle=new Element('a',{id:bean.key,text:bean.label});elementTitle.href=this.defaultAction+'?node='+bean.key;if(self.options.nodeAction!==null&&self.options.contentContainer!==null){if(bean.elements===undefined&&bean.branch===undefined){elementTitle.addEvent('click',function(e){e.stop();$(self.options.contentContainer).innerHTML=ArboTag.nodeWaitMessage;$(self.options.contentContainer).set('load',{method:'post',async:true});$(self.options.contentContainer).load(self.options.nodeAction+'?node='+this.id);self.selectNode(this);});}}}else{elementTitle=new Element('span',{id:bean.key,text:bean.label});}
if(bean.pictogram){elementTitle.addClass(bean.pictogram);}
if(bean.elements!==undefined||bean.branch){li.addClass('branche');li.setProperty('aria-expanded','false');li.setProperty('role','treeitem');elementTitle.addClass('dossier ferme');elementTitle.inject(li);if(bean.extraHtml){var extraHtmlElement=Elements.from(bean.extraHtml);extraHtmlElement.inject(li);}
if(bean.branch){self.initAjaxNodeEvents(li);}else{self.parseJsonChildrens(bean.elements).inject(li);}}else{elementTitle.inject(li);if(bean.extraHtml){var extraHtmlElement=Elements.from(bean.extraHtml);extraHtmlElement.inject(li);}}
li.inject(ul);}
return ul;},toggleFolder:function(folder){var childContainer=folder.getParent('li').getChildren('ul');if(folder.hasClass('ouvert')){folder.removeClass('ouvert');folder.addClass('ferme');folder.getParent('li').setProperty('aria-expanded','false');if(childContainer.length>0){childContainer.addClass('ferme');}}else{folder.removeClass('ferme');folder.addClass('ouvert');folder.getParent('li').setProperty('aria-expanded','true');if(childContainer.length>0){childContainer.removeClass('ferme');}else{if(this.options.branchAction!==null){var request=this.getChildRequest(folder.getParent('li'));request.send("branch="+folder.id);}}}}});ArboTag.extend({components:{},nodeWaitMessage:'<div class="section"><p>Chargement en cours\u2026</p></div>',branchWaitMessage:'Chargement en cours\u2026',timeout:5000,init:function(element,defaultAction,options){this.components[element.id]=new ArboTag(element,defaultAction,options);},isBranchLabel:function(element){var branch=element.getParent('li[role=treeitem]');if(branch!==null){return branch.getFirst()===element;}
return false;},addMessageChild:function(message,target){target.getChildren('ul').destroy();var ul=new Element('ul');var li=new Element('li',{text:message});li.inject(ul);ul.inject(target);},switchFocus:function(node,nextNode){node.set('tabindex',-1);nextNode.set('tabindex',0);nextNode.focus();}});
(function(global,$){var browser=Browser;Object.append(Element.NativeEvents,{'paste':2,'input':2});Element.Events.paste={base:(browser.opera||(browser.firefox&&(browser.version<3)))?'input':'paste',condition:function(e){this.fireEvent('paste',e,1);return false;}};Element.Events.keyrepeat={base:(browser.firefox||browser.opera)?'keypress':'keydown',condition:Function.from(true)};var Meio={};var globalCache;var keysThatDontChangeValueOnKeyUp={9:1,16:1,17:1,18:1,224:1,91:1,37:1,38:1,39:1,40:1};var encode=function(str){return str.replace(/"/g,'&quot;').replace(/'/g,'&#39;');};Meio.Widget=new Class({initialize:function(){this.elements={};},addElement:function(name,obj){this.elements[name]=obj;},addEventToElement:function(name,eventName,event){this.elements[name].addEvent(eventName,event.bindWithEvent(this));},addEventsToElement:function(name,events){for(var eventName in events){this.addEventToElement(name,eventName,events[eventName]);}},attach:function(){for(var element in this.elements){this.elements[element].attach();}},detach:function(){for(var element in this.elements){this.elements[element].detach();}},destroy:function(){for(var element in this.elements){this.elements[element]&&this.elements[element].destroy();}}});Meio.Autocomplete=new Class({Extends:Meio.Widget,Implements:[Options,Events],options:{delay:200,minChars:0,cacheLength:20,selectOnTab:true,maxVisibleItems:10,cacheType:'shared',filter:{},fieldOptions:{},listOptions:{},requestOptions:{},urlOptions:{}},initialize:function(input,data,options,listInstance){this.input=input;this.parent();this.setOptions(options);this.active=0;$(input).setProperty('role','combobox');$(input).setProperty('aria-autocomplete','none');$(input).setProperty('aria-owns',this.input+'-list');$(input).setProperty('aria-expanded','false');this.filters=Meio.Autocomplete.Filter.get(this.options.filter);this.addElement('list',listInstance||new Meio.Element.List(this.input,this.options.listOptions));this.addListEvents();this.addElement('field',new Meio.Element.Field(input,this.options.fieldOptions));this.addFieldEvents();this.addSelectEvents();this.attach();this.initCache();this.initData(data);},addFieldEvents:function(){this.addEventsToElement('field',{'beforeKeyrepeat':function(e){this.active=1;var e_key=e.key,list=this.elements.list;if((e_key==='up')||(e_key==='down')||((e_key==='enter')&&list.showing)){e.preventDefault();}},'delayedKeyrepeat':function(e){var e_key=e.key,field=this.elements.field;field.keyPressControl[e_key]=true;switch(e_key){case'up':case'down':this.focusItem(e_key);break;case'enter':case'right':this.setInputValue();break;case'tab':if(this.options.selectOnTab){this.setInputValue();}
field.keyPressControl[e_key]=false;break;case'esc':this.elements.list.hide();break;default:this.setupList();}},'keyup':function(e){var field=this.elements.field;if(!keysThatDontChangeValueOnKeyUp[e.code]){if(!field.keyPressControl[e.key]){this.setupList();}
field.keyPressControl[e.key]=false;}},'focus':function(){this.active=1;var list=this.elements.list;list.focusedItem=null;list.positionNextTo(this.elements.field.node);},'click':function(){if((this.active++>1)&&!this.elements.list.showing){this.forceSetupList();}},'blur':function(e){var list=this.elements.list;if(!list.focusedItem&&(document.activeElement!==list.node)){this.active=0;list.hide();}},'paste':function(){return this.setupList();}});},addListEvents:function(){this.elements.list.node.addEvent('blur',function(e){this.elements.list.hide();}.bind(this));this.addEventsToElement('list',{'mousedown':function(e){if(this.active&&!e.dontHide){this.setInputValue();this.elements.list.focusedItem=null;this.inputedText=this.elements.field.node.get('value');}},'keydown':function(e){switch(e.key){case'up':case'down':e.preventDefault();this.elements.list.enableBlurEvent=false;this.focusItem(e.key);break;case'enter':case'tab':e.preventDefault();this.setInputValue();this.elements.list.focusedItem=null;this.inputedText=this.elements.field.node.get('value');this.elements.field.node.focus();break;case'esc':this.elements.list.hide();this.elements.list.focusedItem=null;this.elements.field.node.focus();break;default:this.elements.field.node.focus();break;}}});},update:function(){var oldDomaine=null;var idligne=null;var data=this.data,list=this.elements.list;var html;data=data.get();var itemsHtml=[],itemsData=[],classes=list.options.classes,text=this.inputedText;var filter=this.filters.filter,formatMatch=this.filters.formatMatch,formatItem=this.filters.formatItem;for(var row,i=0,n=0;row=data[i++];){var txt='text'.split('.');var dom='domaine'.split('.');if(row.text===""&&row.domaine===""){oldDomaine=null;continue;}
if(filter.call(this,text,row,txt)||filter.call(this,text,row,dom)){idligne=this.input+row.value+row.text+row.domaine;var newCat='';if(oldDomaine!==row.domaine){if(null===row.text||""===row.text){itemsHtml.push('<li id="',idligne,'" tabindex="0" role="option" title="',encode(row.domaine)+' - '+encode(row.domaine),'" data-index="',n,'" class="',classes.newcategorie,'">',encode(row.domaine),'</li>');}else{newCat='" class="'+classes.newcategorie;}
oldDomaine=row.domaine;}
if(null===row.domaine||""===row.domaine){itemsHtml.push('<li id="',idligne,'" tabindex="0" role="option" title="',encode(row.text),'" data-index="',n,newCat,'">',formatItem.call(this,text,row,n),'</li>');}else if(null!==row.text&&""!==row.text){itemsHtml.push('<li id="',idligne,'" tabindex="0" role="option" title="',encode(row.domaine)+' - '+encode(formatMatch.call(this,row.text,row)),'" data-index="',n,newCat,'">','<span class="',classes.categorie,'">',encode(row.domaine),'</span> - ',formatItem.call(this,text,row,n),'</li>');}
itemsData.push(row);n++;}}
html=itemsHtml.join('');this.itemsData=itemsData;list.list.set('html',html);list.list.getElements('li').each(function(item){item.addEvent('blur',function(event){if(list.enableBlurEvent===undefined||list.enableBlurEvent===true){list.hide();list.focusedItem=null;}else{list.enableBlurEvent=true;}});});if(this.options.maxVisibleItems){list.applyMaxHeight(this.options.maxVisibleItems);}},setupList:function(){this.inputedText=this.elements.field.node.get('value');this.forceSetupList(this.inputedText);return true;},forceSetupList:function(inputedText){inputedText=inputedText||this.elements.field.node.get('value');if(inputedText.length>=this.options.minChars){clearInterval(this.prepareTimer);this.prepareTimer=this.data.prepare.delay(this.options.delay,this.data,this.inputedText);}else{list=this.elements.list;list.list.set('html',"");list.hide();}},dataReady:function(){this.update();var list=this.elements.list;if(list.focusedItem){list.focusedItem=$(list.focusedItem.id);if(list.focusedItem){list.focusedItem.addClass(list.options.classes.hover);}}
if(this.onUpdate){this.onUpdate();this.onUpdate=null;}
list=this.elements.list;if(list.list.get('html')&&(this.inputedText.length!==null)&&(this.inputedText.length!==0)){if(this.active){list.show();}}else{this.fireEvent('noItemToList',[this.elements]);list.hide();}},setInputValue:function(){var list=this.elements.list;if(list.focusedItem){var item=list.focusedItem.clone();var text=list.focusedItem.get('title');if(item.getElement('span')){item.getElement('span').destroy();text=item.get('text').substring(3);}
this.elements.field.node.set('value',text);var index=list.focusedItem.get('data-index');this.fireEvent('select',[this.elements,this.itemsData[index],text,index]);}
list.hide();},focusItem:function(direction){var list=this.elements.list;if(list.showing){list.focusItem(direction);}else{this.forceSetupList();this.onUpdate=function(){list.focusItem(direction);};}},addSelectEvents:function(){this.addEvents({select:function(elements){elements.field.addClass('selected');},deselect:function(elements){elements.field.removeClass('selected');}});},initData:function(data){this.data=(typeOf(data)==='string')?new Meio.Autocomplete.Data.Request(data,this.cache,this.elements.field,this.options.requestOptions,this.options.urlOptions):new Meio.Autocomplete.Data(data,this.cache);this.data.addEvent('ready',this.dataReady.bind(this));},initCache:function(){var cacheLength=this.options.cacheLength;if(this.options.cacheType==='shared'){this.cache=globalCache;this.cache.setMaxLength(cacheLength);}else{this.cache=new Meio.Autocomplete.Cache(cacheLength);}},refreshCache:function(cacheLength){this.cache.refresh();this.cache.setMaxLength(cacheLength||this.options.cacheLength);},refreshAll:function(cacheLength,urlOptions){this.refreshCache(cacheLength);this.data.refreshKey(urlOptions);}});Meio.Autocomplete.Select=new Class({Extends:Meio.Autocomplete,options:{syncName:'id',valueField:null,valueFilter:function(data){return data.id;}},initialize:function(input,data,options,listInstance){this.parent(input,data,options,listInstance);this.valueField=$(this.options.valueField);if(!this.valueField){return;}
if(this.options.syncName){this.syncWithValueField(data);}},addValueFieldEvents:function(){this.addEvents({'select':function(elements,data){this.valueField.set('value',this.options.valueFilter.call(this,data));},'deselect':function(elements){this.valueField.set('value','');}});},syncWithValueField:function(data){var value=this.getValueFromValueField();if(value){this.addParameter(data);this.addDataReadyEvent(value);this.data.prepare(this.elements.field.node.get('value'));}else{this.addValueFieldEvents();}},addParameter:function(data){this.parameter={name:this.options.syncName,value:function(){return this.valueField.value;}.bind(this)};if(this.data.url){this.data.url.addParameter(this.parameter);}},addDataReadyEvent:function(value){var self=this;var runOnce=function(){var values=this.get();for(var i=values.length;i--;){if(self.options.valueFilter.call(self,values[i])===value){self.elements.field.node.set('value',self.filters.formatMatch.call(self,'',values[i],0));}}
if(this.url){this.url.removeParameter(self.parameter);}
self.addValueFieldEvents();this.removeEvent('ready',runOnce);};this.data.addEvent('ready',runOnce);},getValueFromValueField:function(){return this.valueField.get('value');}});Meio.Autocomplete.Select.One=new Class({Extends:Meio.Autocomplete.Select,options:{filter:{path:'text'}},initialize:function(select,options,listInstance){this.select=$(select);this.replaceSelect();this.parent(this.field,this.createDataArray(),Object.merge(options||{},{valueField:this.select,valueFilter:function(data){return data.value;}}),listInstance);},replaceSelect:function(){var selectedOption=this.select.getSelected()[0];this.field=new Element('input',{type:'text'});var optionValue=selectedOption.get('value');if(optionValue||optionValue===0){this.field.set('value',selectedOption.get('html'));}
this.select.setStyle('display','none');this.field.inject(this.select,'after');},createDataArray:function(){var selectOptions=this.select.options,data=[];for(var i=0,selectOption,optionValue;selectOption=selectOptions[i++];){optionValue=selectOption.value;if(optionValue||optionValue===0){data.push({value:optionValue,text:selectOption.innerHTML});}}
return data;},addValueFieldEvents:function(){this.addEvents({'select':function(elements,data,text,index){var option=this.valueField.getElement('option[value="'+
this.options.valueFilter.call(this,data)+'"]');if(option){option.selected=true;}},'deselect':function(elements){var option=this.valueField.getSelected()[0];if(option){option.selected=false;}}});},getValueFromValueField:function(){return this.valueField.getSelected()[0].get('value');}});Meio.Element=new Class({Implements:[Events],initialize:function(node){this.setNode(node);this.createBoundEvents();this.attach();},setNode:function(node){this.node=node?$(node)||$$(node)[0]:this.render();},createBoundEvents:function(){this.bound={};this.boundEvents.each(function(evt){this.bound[evt]=function(e){this.fireEvent('before'+evt.capitalize(),e);this[evt]&&this[evt](e);this.fireEvent(evt,e);return true;}.bind(this);},this);},attach:function(){for(var e in this.bound){if(this.node){this.node.addEvent(e,this.bound[e]);}}},detach:function(){for(var e in this.bound){if(this.node){this.node.removeEvent(e,this.bound[e]);}}},addClass:function(type){if(this.node){this.node.addClass(this.options.classes[type]);}},removeClass:function(type){if(this.node){this.node.removeClass(this.options.classes[type]);}},toElement:function(){this.node;},render:function(){}});Meio.Element.Field=new Class({Extends:Meio.Element,Implements:[Options],options:{classes:{loading:'ma-loading',selected:'ma-selected'}},initialize:function(field,options){this.keyPressControl={};this.boundEvents=['paste','focus','blur','click','keyup','keyrepeat'];this.setOptions(options);this.parent(field);$(global).addEvent('unload',function(){if(this.node){this.node.set('autocomplete','on');}}.bind(this));},setNode:function(element){this.parent(element);if(this.node){this.node.set('autocomplete','off');}},keyrepeat:function(e){clearInterval(this.keyrepeatTimer);this.keyrepeatTimer=this._keyrepeat.delay(1,this,e);},_keyrepeat:function(e){this.fireEvent('delayedKeyrepeat',e);},destroy:function(){this.detach();this.node.removeAttribute('autocomplete');}});Meio.Element.List=new Class({Extends:Meio.Element,Implements:[Options],options:{width:'field',classes:{container:'zone_autocompletion',hover:'li-hover',odd:'',even:'',newcategorie:'new-categorie',focus:'li-hover',categorie:'categorie',newcategorie2:'new-categorie2'}},initialize:function(input,options){this.boundEvents=['mousedown','mouseover','keydown'];this.setOptions(options);this.parent();this.focusedItem=null;this.input=input;this.list.set('id',input+'-list');},applyMaxHeight:function(maxVisibleItems){var listChildren=this.list.childNodes;var node=listChildren[maxVisibleItems-1]||(listChildren.length?listChildren[listChildren.length-1]:null);if(!node){return;}
node=$(node);var maxWidth=0;for(var k=0;k<listChildren.length;k++){var newElementVar=new Element('span',{'id':'id_name','class':'new-categorie','text':listChildren[k].title,styles:{visibility:'hidden'}});document.body.appendChild(newElementVar);if(newElementVar.offsetWidth>maxWidth){maxWidth=newElementVar.offsetWidth;}
document.body.removeChild(newElementVar);}
var height=node.getCoordinates(this.list).bottom;var width=maxWidth+30;this.node.setStyle('height',height);this.node.setStyle('width',width);var child=this.node.getChildren()[0];if(child!==null){child.setStyle('height',height);child.setStyle('width',width);}},mouseover:function(e){var item=this.getItemFromEvent(e),hoverClass=this.options.classes.focus;if(!item){return true;}
if(this.focusedkeyItem){this.focusedkeyItem.removeClass(hoverClass);}
item.addClass(hoverClass);this.focusedkeyItem=item;},mousedown:function(e){e.preventDefault();this.shouldNotBlur=true;if(!(this.focusedItem=this.getItemFromEvent(e))){e.dontHide=true;return true;}
this.focusedItem.removeClass(this.options.classes.hover);},focusItem:function(direction){var hoverClass=this.options.classes.hover,newFocusedItem;if(this.focusedItem){if((newFocusedItem=this.focusedItem[direction==='up'?'getPrevious':'getNext']())){this.focusedItem.removeClass(hoverClass);newFocusedItem.addClass(hoverClass);this.focusedItem=newFocusedItem;this.scrollFocusedItem(direction);newFocusedItem.focus();}}else{if((newFocusedItem=this.list.getFirst())){newFocusedItem.addClass(hoverClass);this.focusedItem=newFocusedItem;newFocusedItem.focus();}}},scrollFocusedItem:function(direction){var focusedItemCoordinates=this.focusedItem.getCoordinates(this.list);scrollTop=this.node.scrollTop;if(direction==='down'){var delta=focusedItemCoordinates.bottom-this.node.getStyle('height').toInt();if((delta-scrollTop)>0){this.node.scrollTop=delta;}}else{var top=focusedItemCoordinates.top;if(scrollTop&&(scrollTop>top)){this.node.scrollTop=top;}}},getItemFromEvent:function(e){var target=e.target;while(target&&(target.tagName.toLowerCase()!=='li')){if(target===this.node){return null;}
target=target.parentNode;}
return $(target);},render:function(){var node=new Element('span',{'class':this.options.classes.container});this.list=new Element('ul',{'role':'listbox','aria-hidden':'true'}).inject(node);$(document.body).grab(node);return node;},positionNextTo:function(fieldNode){var width=this.options.width,listNode=this.node;var elPosition=fieldNode.getCoordinates();listNode.setStyle('width',width==='field'?fieldNode.getWidth().toInt()-
listNode.getStyle('border-left-width').toInt()-
listNode.getStyle('border-right-width').toInt():width);listNode.setPosition({x:elPosition.left,y:elPosition.bottom});},show:function(){$(this.input).set('aria-expanded','true');this.node.scrollTop=0;this.node.setStyle('visibility','visible');var child=this.node.getChildren()[0];if(child!==null){child.scrollTop=0;child.set('aria-hidden','false');child.setStyle('visibility','visible');}
this.showing=true;},hide:function(){$(this.input).set('aria-expanded','false');this.showing=false;this.node.setStyle('visibility','hidden');var child=this.node.getChildren()[0];if(child!==null){child.set('aria-hidden','true');child.setStyle('visibility','hidden');}}});Meio.Autocomplete.Filter={filters:{},get:function(options){var type=options.type,keys=(options.path||'').split('.');var filters=(type&&this.filters[type])?this.filters[type](this,keys):options;return Object.merge(this.defaults(keys),filters);},define:function(name,options){this.filters[name]=options;},defaults:function(keys){var self=this;return{filter:function(text,data){if(!text){return true;}
var bool=self._getValueFromKeys(data,keys).test(new RegExp(text.escapeRegExp(),'i'));return bool;},filter:function(text,data,key){if(!text){return true;}
return self._getValueFromKeys(data,key).test(new RegExp(text.escapeRegExp(),'i'));},formatMatch:function(text,data){return self._getValueFromKeys(data,keys);},formatItem:function(text,data,i){return text?self._getValueFromKeys(data,keys).replace(new RegExp('('+text.escapeRegExp()+')','gi'),'<strong>$1</strong>'):self._getValueFromKeys(data,keys);}};},_getValueFromKeys:function(obj,keys){var key,value=obj;for(var i=0;key=keys[i++];){value=value[key];}
return value;}};Meio.Autocomplete.Filter.define('contains',function(self,keys){return{};});Meio.Autocomplete.Filter.define('startswith',function(self,keys){return{filter:function(text,data){return text?self._getValueFromKeys(data,keys).test(new RegExp('^'+text.escapeRegExp(),'i')):true;}};});Meio.Autocomplete.Data=new Class({Implements:[Options,Events],initialize:function(data,cache){this._cache=cache;this.data=data;this.dataString=JSON.encode(this.data);},get:function(){return this.data;},getKey:function(){return this.cachedKey;},prepare:function(text){this.cachedKey=this.dataString+(text||'');this.fireEvent('ready');},cache:function(key,data){this._cache.set(key,data);},refreshKey:function(){}});Meio.Autocomplete.Data.Request=new Class({Extends:Meio.Autocomplete.Data,options:{noCache:true,formatResponse:function(jsonResponse){return jsonResponse;}},initialize:function(url,cache,element,options,urlOptions){this.setOptions(options);this.rawUrl=url;this._cache=cache;this.element=element;this.urlOptions=urlOptions;this.refreshKey();this.createRequest();},prepare:function(text){this.cachedKey=this.url.evaluate(text);if(this._cache.has(this.cachedKey)){this.fireEvent('ready');}else{this.request.send({url:this.cachedKey});}},createRequest:function(){var self=this;this.request=new Request.JSON(this.options);this.request.addEvents({request:function(){self.element.addClass('loading');},complete:function(){self.element.removeClass('loading');},success:function(jsonResponse){self.data=self.options.formatResponse(jsonResponse);self.fireEvent('ready');}});},refreshKey:function(urlOptions){urlOptions=Object.merge(this.urlOptions,{url:this.rawUrl},urlOptions||{});this.url=new Meio.Autocomplete.Data.Request.URL(urlOptions.url,urlOptions);}});Meio.Autocomplete.Data.Request.URL=new Class({Implements:[Options],options:{queryVarName:'q',extraParams:null,max:20},initialize:function(url,options){this.setOptions(options);this.rawUrl=url;this.url=url;this.url+=this.url.contains('?')?'&':'?';this.dynamicExtraParams=[];var params=Array.from(this.options.extraParams);for(var i=params.length;i--;){this.addParameter(params[i]);}
if(this.options.max){this.addParameter('limit='+this.options.max);}},evaluate:function(text){text=text||'';var params=this.dynamicExtraParams,url=[];url.push(this.options.queryVarName+'='+encodeURIComponent(text));for(var i=params.length;i--;){url.push(encodeURIComponent(params[i].name)+'='+encodeURIComponent($lambda(params[i].value)()));}
return this.url+url.join('&');},addParameter:function(param){if(isFinite(param.nodeType)||(typeOf(param.value)==='function')){this.dynamicExtraParams.push(param);}else{this.url+=((typeOf(param)==='string')?param:encodeURIComponent(param.name)+'='+
encodeURIComponent(param.value))+'&';}},removeParameter:function(param){this.dynamicExtraParams.erase(param);}});Meio.Autocomplete.Cache=new Class({initialize:function(maxLength){this.refresh();this.setMaxLength(maxLength);},set:function(key,value){if(!this.cache[key]){if(this.getLength()>=this.maxLength){var keyToRemove=this.pos.shift();this.cache[keyToRemove]=null;delete this.cache[keyToRemove];}
this.cache[key]=value;this.pos.push(key);}
return this;},get:function(key){return this.cache[key||'']||null;},has:function(key){return!!this.get(key);},getLength:function(){return this.pos.length;},refresh:function(){this.cache={};this.pos=[];},setMaxLength:function(maxLength){this.maxLength=Math.max(maxLength,1);}});globalCache=new Meio.Autocomplete.Cache();if(global.Meio!=undefined&&global.Meio!=null){Object.append(global.Meio,Meio);}else{global.Meio=Meio;}})(this,document.id||$);
var BlocPliableTag={accordeon:'.accordeon',bloc:'.bpliable',header:'.bpliable-header',content:'.bpliable-body',duration:500,waitMessage:'<p>Chargement en cours\u2026</p>',errorMessage:'Erreur lors du chargement des données',openTransition:function(bpBody){return new Fx.Tween(bpBody,{duration:this.duration,transition:Fx.Transitions.Quad.easeInOut,property:'height',onComplete:function(){bpBody.setStyle('height','auto');bpBody.setStyle('overflow','visible');}});},closeTransition:function(bpBody){return new Fx.Tween(bpBody,{duration:this.duration,transition:Fx.Transitions.Quad.easeInOut,property:'height',onComplete:function(){bpBody.set('aria-hidden','true');bpBody.setStyle('height','auto');bpBody.setStyle('overflow','visible');}});},accordeonne:function(accordeonElement){var accordeon=accordeonElement.getParent(this.accordeon);accordeon.getElements(this.bloc).each(function(item){if(item.getElement(BlocPliableTag.header).get('aria-expanded')==='true'){BlocPliableTag.close(item);}});},isAccordeonElement:function(object){return object.getParent(this.accordeon)===null?false:true;},open:function(blocPliable){var bpHeader=blocPliable.getElement(BlocPliableTag.header);var bpBody=blocPliable.getElement(this.content);bpHeader.set('aria-expanded','true');bpBody.setStyle('overflow','hidden');this.openTransition(bpBody).start("0",bpBody.getDimensions().y);(function(){this.set('aria-hidden','false');}).delay(50,bpBody);},close:function(blocPliable){var bpHeader=blocPliable.getElement(BlocPliableTag.header);var bpBody=blocPliable.getElement(this.content);bpHeader.set('aria-expanded','false');bpBody.setStyle('overflow','hidden');this.closeTransition(bpBody).start(bpBody.getSize().y,"0");},toggle:function(blocPliable){var bpHeader=blocPliable.getElement(BlocPliableTag.header);if(bpHeader.get('aria-expanded')==='false'){if(this.isAccordeonElement(blocPliable)){this.accordeonne(blocPliable);}
this.open(blocPliable);}else{this.close(blocPliable);}},findNext:function(blocPliable){var blocs=blocPliable.getParent(this.accordeon).getElements(this.bloc);for(var i=1;i<blocs.length;i++){if(blocs[i-1]===blocPliable){return blocs[i].getElement(BlocPliableTag.header);}}
if(blocs.length>0){return blocs[0].getElement(BlocPliableTag.header);}},findPrevious:function(blocPliable){var blocs=blocPliable.getParent(this.accordeon).getElements(this.bloc);for(var i=0;i<blocs.length-1;i++){if(blocs[i+1]===blocPliable){return blocs[i].getElement(BlocPliableTag.header);}}
if(blocs.length>0){return blocs[blocs.length-1].getElement(BlocPliableTag.header);}},loadContent:function(blocPliable,url){var contentContainer=blocPliable.getElement(this.content);contentContainer.set('aria-busy',true);contentContainer.set('html',BlocPliableTag.waitMessage);contentContainer.set('load',{method:'get',async:true,onFailure:function(){contentContainer.set('text',BlocPliableTag.errorMessage);},onError:function(){contentContainer.set('text',BlocPliableTag.errorMessage);},onSuccess:function(){blocPliable.set('data-loaded',true);}});contentContainer.load(url);contentContainer.set('aria-busy',false);},initEvents:function(blocPliableId){$(blocPliableId).getElement(BlocPliableTag.header).addEvents({keydown:function(event){switch(event.key){case'space':case'enter':BlocPliableTag.toggle($(blocPliableId));break;case'left':case'up':if(BlocPliableTag.isAccordeonElement($(blocPliableId))){event.preventDefault();BlocPliableTag.findPrevious($(blocPliableId)).focus();}
break;case'right':case'down':if(BlocPliableTag.isAccordeonElement($(blocPliableId))){event.preventDefault();BlocPliableTag.findNext($(blocPliableId)).focus();}
break;default:break;}}});$(blocPliableId).getElement(this.content).addEvent('keydown',function(event){if(event.control&&event.key==="up"){$(blocPliableId).getElement(BlocPliableTag.header).focus();}});},handleClick:function(event){event.stop();BlocPliableTag.toggle($(blocPliableId));},initLocal:function(blocPliableId){BlocPliableTag.initEvents(blocPliableId);$(blocPliableId).getElement(BlocPliableTag.header).addEvents({click:function(event){event.stop();BlocPliableTag.toggle($(blocPliableId));}});},initAjax:function(blocPliableId,urlToLoad,cacheForAjax){var blocPliable=$(blocPliableId);BlocPliableTag.duration=0;BlocPliableTag.initEvents(blocPliableId);blocPliable.getElement(BlocPliableTag.header).addEvents({click:function(event){event.stop();var bpHeader=blocPliable.getElement(BlocPliableTag.header);if(bpHeader.get('aria-expanded')==='false'){if(BlocPliableTag.isAccordeonElement(blocPliable)){BlocPliableTag.accordeonne(blocPliable);}
if(!blocPliable.get('data-loaded')||cacheForAjax===false){BlocPliableTag.loadContent(blocPliable,urlToLoad);}
BlocPliableTag.open(blocPliable);}else{BlocPliableTag.close(blocPliable);}}});}};
﻿
var DatePicker=new Class({Implements:[Options,Events],today:'',choice:{},minDate:null,maxDate:null,dateSelection:null,dateFocus:null,targetSelection:null,options:{pickerClass:'datepicker',dayShort:3,monthShort:3,startDay:1,yearPicker:true,allowEmpty:true,linkTitle:'',animationDuration:400,useFadeInOut:!Browser.ie,positionOffset:{x:0,y:0},timeWheelStep:1},initialize:function(attachTo,options){Locale.use('fr-FR');this.setOptions({days:Locale.get('Date.days'),months:Locale.get('Date.months'),format:Locale.get('Date.shortDate')});var defaultFormat=this.options.format;this.setOptions(options);this.inputId=attachTo;var ico=new Element('a',{'id':attachTo+'_calendrier','class':'calendrier','tabindex':'-1','title':this.options.linkTitle});if($(this.inputId).get('disabled')){ico.addClass('cal-inactif');}
ico.inject($(this.inputId),'after');this.attach(attachTo,this.options.toggle);document.addEvent('mousedown',function(event){if(!(this.elems&&this.elems.contains(event.target))&&this.picker&&(event.target!==this.picker)&&!(this.picker.contains(event.target)&&(event.target!==this.picker))){this.close.call(this);}}.bind(this));},attach:function(attachTo,toggle){if(!attachTo){return this;}
if(toggle){var togglers=typeOf(toggle)==='array'?toggle:[document.id(toggle)];}
var elemsType=typeOf(attachTo);this.elems=(elemsType==='array'||elemsType==='elements')?attachTo:[document.id(attachTo)];var elems=this.elems;elems.each(function(item,index){if(item.retrieve('datepicker')){return;}
item.store('datepicker',true);var events;if(toggle&&togglers){var self=this;events={click:function(e){if(e){e.stop();}
if(!$(self.inputId).get('disabled')){self.destroy();self.show(item,togglers[index]);}},keydown:function(e){if(e.key==='down'){self.destroy();self.show(item,togglers[index]);}}};var toggler=togglers[index].addEvents(events);item.store('datepicker:toggler',toggler).store('datepicker:events',events);var eventsInput={click:function(e){if(e){e.stop();}
if(!$(self.inputId).get('disabled')){self.destroy();self.show(item,togglers[index],true);}},keydown:function(e){switch(e.key){case'down':e.stop();self.destroy();self.show(item,togglers[index]);break;case'tab':self.destroy();break;case'esc':if(self.picker){e.stop();}
self.destroy();break;default:break;}}};item.addEvents(eventsInput);}else{events={keydown:function(e){if(this.options.allowEmpty&&(e.key==='delete'||e.key==='backspace')){item.set('value','');this.close();}else if(e.key==='tab'){this.close();}else{e.stop();}}.bind(this),focus:this.show.pass(item,this),click:this.show.pass(item,this)};item.addEvents(events).store('datepicker:events',events);}}.bind(this));return this;},detach:function(detach){var elems=typeOf(detach)==='array'?detach:[document.id(detach)];elems.each(function(item){if(!item.retrieve('datepicker')){return;}
var toggler=item.retrieve('datepicker:toggler');var events=item.retrieve('datepicker:events');(toggler||item).removeEvents(events);});return this;},isDateExists:function(dateEnTableau){var isDateExists=false;var jour=parseFloat(dateEnTableau[0]);var mois=parseFloat(dateEnTableau[1]);var annee=parseFloat(dateEnTableau[2]);unedate=new Date(eval(annee),eval(mois)-1,eval(jour));if((unedate.getDate()===eval(jour))&&(unedate.getMonth()===eval(mois)-1)&&(annee===eval(annee))){isDateExists=true;}
return isDateExists;},controleFormat:function(date){var dateTableau=date.split('/');if(dateTableau.length===3){if((!isNaN(dateTableau[0]))&&(!isNaN(dateTableau[1]))&&(!isNaN(dateTableau[2]))){return this.isDateExists(dateTableau);}}
return false;},show:function(input,toggler,withoutFocus){input=document.id(input);if(!input.retrieve('datepicker')){return;}
this.d=input.get('value');if(!this.d){this.d=new Date().clearTime();}else if(!(this.d instanceof Date)){if(this.controleFormat(this.d)){this.d=Date.parse(this.d);}else{this.d=new Date().clearTime();}}
if(!this.d.isValid()){this.d=new Date().clearTime();}
this.input=input;this.minDate=this.getDateFromInputAttr('data-mindate');this.maxDate=this.getDateFromInputAttr('data-maxdate');if((this.minDate&&this.maxDate)&&(this.minDate>this.maxDate)){this.minDate=null;this.maxDate=null;}
if(this.isDateOutOfRange(this.d)){if(this.minDate!==null&&this.d<this.minDate){this.d=this.minDate.clone();}else if(this.maxDate!==null&&this.d>this.maxDate){this.d=this.maxDate.clone();}}
var inputCoords=(document.id(toggler)||input).getCoordinates();var position={left:inputCoords.left+this.options.positionOffset.x,top:inputCoords.top+inputCoords.height+this.options.positionOffset.y};this.fireEvent('show');this.today=new Date().clearTime();this.choice=this.d.toObject();this.render();this.position({x:position.left,y:position.top});if(this.dateSelection&&!withoutFocus){this.selectCurrentElement(this.dateSelection);}
if(Browser.ie){this.shim();}
return this;},close:function(e,force){$(this.inputId).focus();if(!document.id(this.picker)){return;}
if(this.options.useFadeInOut){this.picker.set('tween',{duration:this.options.animationDuration/2,onComplete:this.destroy.bind(this)}).tween('opacity',1,0);}else{this.destroy();}
return this;},shim:function(){var coords=this.picker.setStyle('zIndex',1000).getCoordinates();this.frame=new Element('iframe',{src:'javascript:false;document.write("");',styles:{position:'absolute',zIndex:999,height:coords.height,width:coords.width,left:coords.left,top:coords.top}}).inject(document.body);var frame=this.frame;if(this.frame.style!==null){this.frame.style.filter='progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)';}
frame.destroy();if(this.dragger){this.dragger.addEvent('drag',function(){var coords=this.picker.getCoordinates();frame.setStyles({left:coords.left,top:coords.top});}.bind(this));}},position:function(position){var size=window.getSize(),scroll=window.getScroll(),pickerSize=this.picker.getSize(),max_y=(size.y+scroll.y)-pickerSize.y,max_x=(size.x+scroll.x)-pickerSize.x,inputCoords=this.input.getCoordinates();if(position.x>max_x){position.x=inputCoords.right-this.options.positionOffset.x-pickerSize.x;}
if(position.y>max_y){position.y=inputCoords.top-this.options.positionOffset.y-pickerSize.y;}
this.picker.setStyles({left:position.x,top:position.y});},render:function(fx){var firstTime=true;if(!this.picker){this.constructPicker();}else{var old=this.oldContents;this.oldContents=this.newContents;this.newContents=old;this.newContents.empty();firstTime=false;}
var startDate=new Date(this.d.getTime());this.renderMonth();this.d=startDate;if(this.picker.getStyle('opacity')===0){this.picker.tween('opacity',0,1);}
if(fx){this.fx(fx);}
if(!firstTime&&this.dateSelection){this.selectCurrentElement.delay(this.options.animationDuration,this,this.dateSelection);}
this.initKeyEvents();},initKeyEvents:function(){this.picker.removeEvent('keydown',this.keyEvt);this.picker.addEvent('keydown',this.keyEvt=function(evt){switch(evt.key){case'tab':evt.stop();this.initFocusableElements();if(evt.shift){this.findPreviousTab(document.activeElement).focus();}else{this.findNextTab(document.activeElement).focus();}
break;case'right':evt.stop();this.goToNextDay();break;case'left':evt.stop();this.goToPreviousDay();break;case'up':evt.stop();this.goToPreviousWeek();break;case'down':evt.stop();this.goToNextWeek();break;case'esc':evt.stop();this.close();break;case'space':if(this.getCurrentElement()===document.activeElement){this.getCurrentElement().fireEvent('click');}
break;case'enter':evt.preventDefault();document.activeElement.fireEvent('click');break;case'pageup':evt.stop();if(evt.control){this.goToPreviousYear();}else{this.goToPreviousMonth();}
break;case'pagedown':evt.stop();if(evt.control){this.goToNextYear();}else{this.goToNextMonth();}
break;default:break;}}.bind(this));this.days=this.newContents.getElements('.week td.day:not(.semaine, .unavailable)');},initFocusableElements:function(){this.picker.focusableElements=this.picker.getElements('a:not([aria-disabled=true]), td[tabindex]:not([tabindex^="-"])');},goToNextDay:function(){var currentElement=this.getCurrentElement();if(currentElement){var posCurrentElement=this.days.indexOf(currentElement);if(posCurrentElement<this.days.length-1){this.deselectCurrentElement();this.selectCurrentElement(this.days[posCurrentElement+1]);}else{if(!this.isDateOutOfRange(this.firstDateOfNextMonth())){this.deselectCurrentElement();this.targetSelection=this.firstDateOfNextMonth();this.next();}}}else{this.selectCurrentElement(this.days[0]);}},goToPreviousDay:function(){var currentElement=this.getCurrentElement();if(currentElement){var posCurrentElement=this.days.indexOf(currentElement);if(posCurrentElement>0){this.deselectCurrentElement();this.selectCurrentElement(this.days[posCurrentElement-1]);}else{if(!this.isDateOutOfRange(this.lastDateOfPreviousMonth())){this.deselectCurrentElement();this.targetSelection=this.lastDateOfPreviousMonth();this.previous();}}}else{this.selectCurrentElement(this.days[this.days.length-1]);}},goToPreviousWeek:function(){var currentElement=this.getCurrentElement();if(currentElement){var posCurrentElement=this.days.indexOf(currentElement);if(posCurrentElement-7>=0){this.deselectCurrentElement();this.selectCurrentElement(this.days[posCurrentElement-7]);}else{if(!this.isDateOutOfRange(this.lastDateOfPreviousMonth())){this.deselectCurrentElement();if(this.isDateOutOfRange(this.dateFocus.decrement('day',7))){this.dateFocus=this.minDate.clone();}
this.targetSelection=this.dateFocus;this.previous();}}}else{this.selectCurrentElement(this.days[this.days.length-1]);}},goToNextWeek:function(){var currentElement=this.getCurrentElement();if(currentElement){var posCurrentElement=this.days.indexOf(currentElement);if(posCurrentElement+7<this.days.length){this.deselectCurrentElement();this.selectCurrentElement(this.days[posCurrentElement+7]);}else{if(!this.isDateOutOfRange(this.firstDateOfNextMonth())){this.deselectCurrentElement();if(this.isDateOutOfRange(this.dateFocus.increment('day',7))){this.dateFocus=this.maxDate.clone();}
this.targetSelection=this.dateFocus;this.next();}}}else{this.selectCurrentElement(this.days[0]);}},goToPreviousMonth:function(){if(!this.isDateOutOfRange(this.lastDateOfPreviousMonth())){var currentElement=this.getCurrentElement();if(currentElement&&this.dateFocus!==null){if(this.isDateOutOfRange(this.dateFocus.decrement('month',1))){this.dateFocus=this.minDate.clone();}
this.targetSelection=this.dateFocus;this.previous();}else{this.previous();}}},goToNextMonth:function(){if(!this.isDateOutOfRange(this.firstDateOfNextMonth())){var currentElement=this.getCurrentElement();if(currentElement&&this.dateFocus!==null){if(this.isDateOutOfRange(this.dateFocus.increment('month',1))){this.dateFocus=this.maxDate.clone();}
this.targetSelection=this.dateFocus;this.next();}else{this.next();}}},goToPreviousYear:function(){if(!this.isDateOutOfRange(this.previousYearDate())){var currentElement=this.getCurrentElement();if(currentElement&&this.dateFocus!==null){this.targetSelection=this.dateFocus.decrement('year',1);this.previousYear();}else{this.previousYear();}}},goToNextYear:function(){if(!this.isDateOutOfRange(this.nextYearDate())){var currentElement=this.getCurrentElement();if(currentElement&&this.dateFocus!==null){this.targetSelection=this.dateFocus.increment('year',1);this.nextYear();}else{this.nextYear();}}},getCurrentElement:function(){var currentElement=this.newContents.getElement('.current');if(!currentElement){currentElement=this.dateSelection;}
if(!currentElement){if(document.activeElement&&document.activeElement.hasClass('selected')){currentElement=document.activeElement;}}
return currentElement;},deselectCurrentElement:function(){var currentElement=this.newContents.getElement('.current');if(currentElement){currentElement.removeClass('current');currentElement.set('aria-selected','false');currentElement.set('tabindex',-1);}
this.dateSelection=null;},selectCurrentElement:function(element){element.addClass('current');element.set('tabindex',0);element.set('aria-selected','true');element.focus();this.dateFocus=Date.fromObject({day:element.get('text'),month:this.d.getMonth(),year:this.d.getFullYear()});},findNextTab:function(element){for(var i=0;i<this.picker.focusableElements.length-1;i++){if(this.picker.focusableElements[i]===element){return this.picker.focusableElements[i+1];}}
return this.picker.focusableElements[0];},findPreviousTab:function(element){for(var i=1;i<this.picker.focusableElements.length;i++){if(this.picker.focusableElements[i]===element){return this.picker.focusableElements[i-1];}}
return this.picker.focusableElements[this.picker.focusableElements.length-1];},fx:function(fx){this.slider.set('tween',{unit:'em'});if(fx==='right'){this.oldContents.setStyles({left:'0em',opacity:1});this.newContents.setStyles({left:'22.6em',opacity:1});this.slider.setStyle('left','0em').tween('left',0,'-22.6em');}else if(fx==='left'){this.oldContents.setStyles({left:'22.6em',opacity:1});this.newContents.setStyles({left:'0em',opacity:1});this.slider.setStyle('left','-22.6em').tween('left','-22.6em',0);}else if(fx==='fade'){this.slider.setStyle('left','0em');this.oldContents.setStyle('left','0em').set('tween',{duration:this.options.animationDuration/2}).tween('opacity',1,0);this.newContents.setStyles({opacity:0,left:'0em'}).set('tween',{duration:this.options.animationDuration}).tween('opacity',0,1);}},constructPicker:function(){this.picker=new Element('div',{'class':this.options.pickerClass}).inject(document.body);if(this.options.useFadeInOut){this.picker.setStyle('opacity',0).set('tween',{duration:this.options.animationDuration});}
var h=new Element('div').inject(this.picker);new Element('a',{'class':'titre_aujourdhui','href':'#'}).addEvent('click',this.aujourdhui.bind(this)).inject(h);var titreNavigation=new Element('div',{'class':'titre_navigation'}).inject(h);var navigationMois=new Element('div',{'style':'float: left'}).inject(titreNavigation);new Element('a',{'href':'#myself','class':'titre_navigation_mois_prec'}).addEvent('click',this.goToPreviousMonth.bind(this)).inject(navigationMois);new Element('div',{'class':'titre_navigation_mois'}).inject(navigationMois);new Element('a',{'href':'#myself','class':'titre_navigation_mois_suiv'}).addEvent('click',this.goToNextMonth.bind(this)).inject(navigationMois);new Element('div',{'class':'clear'}).inject(navigationMois);var navigationAnnee=new Element('div',{'style':'float: right'}).inject(titreNavigation);new Element('a',{'href':'#myself','class':'titre_navigation_annee_prec'}).addEvent('click',this.goToPreviousYear.bind(this)).inject(navigationAnnee);new Element('div',{'class':'titre_navigation_annee'}).inject(navigationAnnee);new Element('a',{'href':'#myself','class':'titre_navigation_annee_suiv'}).addEvent('click',this.goToNextYear.bind(this)).inject(navigationAnnee);new Element('div',{'class':'clear'}).inject(navigationAnnee);var b=new Element('div',{'class':'body'}).inject(this.picker);this.slider=new Element('div',{styles:{position:'absolute',top:0,left:0,width:'45.2em',height:'15.7em'}}).set('tween',{duration:this.options.animationDuration,transition:Fx.Transitions.Quad.easeInOut}).inject(b);this.oldContents=new Element('div',{styles:{position:'absolute',top:'0em',left:'22.6em',width:'22.6em',height:'15.7em'}}).inject(this.slider);this.newContents=new Element('div',{styles:{position:'absolute',top:'0em',left:'0em',width:'22.6em',height:'15.7em'}}).inject(this.slider);},getDateFromInputAttr:function(attr){if(this.input.get(attr)){if(this.input.get(attr)==='today'){return new Date().clearTime();}else if(this.controleFormat(this.input.get(attr))){return Date.parse(this.input.get(attr));}}
return null;},isDateOutOfRange:function(date){return(this.minDate!==null&&date<this.minDate)||(this.maxDate!==null&&date>this.maxDate);},fillCalendarHeader:function(){var month=this.d.getMonth();var dateDuJour=new Date().toLocaleString();if(this.picker.hasClass('dpmetier')){this.picker.getElement('.titre_aujourdhui').set({text:'Aujourd\'hui : '+dateDuJour.substr(0,dateDuJour.length-8),'aria-disabled':this.isDateOutOfRange(this.today)});}else{this.picker.getElement('.titre_aujourdhui').set({title:dateDuJour.substr(0,dateDuJour.length-8),text:'Aujourd\'hui','aria-disabled':this.isDateOutOfRange(this.today)});}
this.picker.getElement('.titre_navigation_mois').set('html',this.options.months[month]);this.picker.getElement('.titre_navigation_mois_prec').set({title:this.options.months[(month+11)%12],'aria-disabled':this.isDateOutOfRange(this.lastDateOfPreviousMonth())});this.picker.getElement('.titre_navigation_mois_suiv').set({title:this.options.months[(month+1)%12],'aria-disabled':this.isDateOutOfRange(this.firstDateOfNextMonth())});this.picker.getElement('.titre_navigation_annee').set('text',this.d.getFullYear());this.picker.getElement('.titre_navigation_annee_prec').set({title:this.d.getFullYear()-1,'aria-disabled':this.isDateOutOfRange(this.previousYearDate())});this.picker.getElement('.titre_navigation_annee_suiv').set({title:this.d.getFullYear()+1,'aria-disabled':this.isDateOutOfRange(this.nextYearDate())});},renderMonth:function(){var month=this.d.getMonth();var year=this.d.getFullYear();this.fillCalendarHeader();this.d.setDate(1);while(this.d.getDay()!==this.options.startDay){this.d.setDate(this.d.getDate()-1);}
var container=new Element('table',{'class':'days','role':'grid'}).inject(this.newContents);var caption=new Element('caption',{'class':'invisible'});caption.set('html','Calendrier '+this.options.months[month]+' '+year);caption.inject(container);var thead=new Element('thead').inject(container);var tbody=new Element('tbody').inject(container);var titles=new Element('tr',{'class':'titles'}).inject(thead);var d,i,classes,e,weekcontainer;if(this.picker.hasClass('dpmetier')){new Element('th',{'class':'title day week','title':'num\u00E9ro de semaine','scope':'col'}).set('text',"Num.").inject(titles);}
for(d=this.options.startDay;d<(this.options.startDay+7);d++){new Element('th',{'class':'title day day'+(d%7),'scope':'col'}).set('text',this.options.days[(d%7)].substring(0,1).toUpperCase()+
this.options.days[(d%7)].substring(1,this.options.dayShort).toLowerCase()+".").inject(titles);}
var t=this.today.toDateString();var currentChoice=Date.fromObject(this.choice).toDateString();for(i=0;i<42;i++){var isCurrent=false;classes=[];classes.push('day');classes.push('day'+this.d.getDay());if(this.d.toDateString()==t){classes.push('today');}
if((this.d.getDay()==6)||(this.d.getDay()==0)){classes.push('nonouvrable');}
if(this.d.toDateString()==currentChoice){classes.push('selected');}
if(this.targetSelection&&this.d.getTime()===this.targetSelection.getTime()){classes.push('current');isCurrent=true;}
var available=true;if(this.d.getMonth()!==month||this.isDateOutOfRange(this.d)){classes.push('unavailable');available=false;}
if(i%7===0){weekcontainer=new Element('tr',{'class':'week week'+(Math.floor(i/7))}).inject(tbody);var dateSemaine=new Date(this.d.getFullYear(),this.d.getMonth(),this.d.getDate(),0,0,0);var DoW=dateSemaine.getDay();dateSemaine.setDate(dateSemaine.getDate()-(DoW+6)%7+3);var ms=dateSemaine.valueOf();dateSemaine.setMonth(0);dateSemaine.setDate(4);if(this.picker.hasClass('dpmetier')){var numSemaine=Math.round((ms-dateSemaine.valueOf())/(7*864e5))+1;new Element('th',{'class':'day semaine','scope':'row'}).set('text',numSemaine).inject(weekcontainer);}}
var dateDebutAnnee=new Date();dateDebutAnnee.setDate(1);dateDebutAnnee.setMonth(0);dateDebutAnnee.setFullYear(this.d.getFullYear());var title=this.d.format(this.options.format);if(this.picker.hasClass('dpmetier')){var quantieme=(((this.d.getTime())-(dateDebutAnnee.getTime()))/(24*3600*1000)).ceil()+1;e=new Element('td',{'class':classes.join(' '),'role':'gridcell','aria-selected':'false'}).set('text',this.d.getDate()).inject(weekcontainer);title+=' Quanti\u00E8me '+quantieme;}else{e=new Element('td',{'class':classes.join(' '),'role':'gridcell','aria-selected':'false'}).set('text',this.d.getDate()).inject(weekcontainer);}
if(this.d.toDateString()===currentChoice){title+=' courant';if(!this.dateSelection){this.dateSelection=e;}}
e.set('title',title);if(isCurrent){this.dateSelection=e;}
if(available){e.addEvent('click',function(e,d){this.select(d);return false;}.bindWithEvent(this,{day:this.d.getDate(),month:this.d.getMonth(),year:this.d.getFullYear()}));e.addEvent('mouseover',function(cell){this.deselectCurrentElement();this.selectCurrentElement(cell);}.bind(this,e));}
this.d.setDate(this.d.getDate()+1);}},lastDateOfPreviousMonth:function(){var date=this.d.clone();date.setDate(1);date.decrement('day',1);return date;},firstDateOfNextMonth:function(){var date=this.d.clone();date.setDate(1);date.increment('month',1);return date;},previousYearDate:function(){var date=this.d.clone();date.setDate(1);date.decrement('year',1);date.setDate(date.get('lastdayofmonth'));return date;},nextYearDate:function(){var date=this.d.clone();date.setDate(1);date.increment('year',1);return date;},previous:function(){this.deselectCurrentElement();this.d.setDate(1);this.d.setMonth(this.d.getMonth()-1);this.render('left');this.fireEvent('previous');return false;},next:function(){this.deselectCurrentElement();this.d.setDate(1);this.d.setMonth(this.d.getMonth()+1);this.render('right');this.fireEvent('next');return false;},previousYear:function(){this.deselectCurrentElement();this.d.setFullYear(this.d.getFullYear()-1);this.render('left');this.fireEvent('previous');return false;},nextYear:function(){this.deselectCurrentElement();this.d.setFullYear(this.d.getFullYear()+1);this.render('right');this.fireEvent('next');return false;},aujourdhui:function(){var today=new Date().clearTime();if(!this.isDateOutOfRange(today)){this.choice=today.toObject();this.select('select',today.toObject());}
return false;},destroy:function(){if(this.picker){this.picker.destroy();this.picker=null;this.dateSelection=null;this.targetSelection=null;this.dateFocus=null;this.fireEvent('close');}},select:function(values){this.choice=Object.merge(this.choice,values);var d=Date.fromObject(this.choice);if(typeof Placeholders!=='undefined'){Placeholders.hide(this.input);}
this.input.set('value',d.format(this.options.format)).store('datepicker:value',d);this.fireEvent('select',d);this.close(null,true);},leadZero:function(v){return v<10?'0'+v:v;}});Date.implement({toObject:function(){return{year:this.getFullYear(),month:this.getMonth(),day:this.getDate()};},isValid:function(){return!isNaN(this);}});Date.extend({fromObject:function(values){values=values||{};var d=new Date();d.setDate(1);['year','month','day'].each(function(type){var v=values[type];if(!v&&v!==0){return;}
switch(type){case'day':d.setDate(v);break;case'month':d.setMonth(v);break;case'year':d.setFullYear(v);break;default:break;}});return d.clearTime();}});
var ChampSaisieTag={tagErreur:"b.erreur_champ",classErreur:"erreur_champ",prefixIdZoneMessageErreur:"_messageErreur",classSpan:"zone_champ_saisie",separateurTelephone:".",messagesErreur:[],lblErreurDate:"La date n'a pas un format correct (jj/mm/aaaa).",lblErreurHeure:"L'heure n'a pas un format correct (hh:mm:ss).",lblErreurTel:"Le t\u00E9l\u00E9phone n'a pas un format correct (01.23.45.67.89).",erreurChamp:function(champ,messageErreur){if(messageErreur.length!==0){var span=$(champ.id).getParent('span');var bTagErreur=$(champ.id).getParent(ChampSaisieTag.tagErreur);if(!bTagErreur){bTagErreur=new Element('b');bTagErreur.addClass(ChampSaisieTag.classErreur);$(champ.id).inject(bTagErreur);bTagErreur.inject(span,'top');}
$(champ.id).setProperty('aria-invalid','true');var icoCalendar=span.getElement('.calendrier');if(icoCalendar){icoCalendar.inject(bTagErreur);}
if($(champ.id+ChampSaisieTag.prefixIdZoneMessageErreur)!==null){$(champ.id+ChampSaisieTag.prefixIdZoneMessageErreur).removeClass('message_erreur_invisible');$(champ.id+ChampSaisieTag.prefixIdZoneMessageErreur).innerHTML=messageErreur;}}},isEmpty:function(champ){return champ.value.length===0;},champOK:function(champ){var span=$(champ.id).getParent('span');var bTagErreur=$(champ.id).getParent(ChampSaisieTag.tagErreur);if(bTagErreur){var elements=bTagErreur.getChildren();for(i=elements.length-1;i>=0;i--){(elements[i]).inject(span,'top');}
bTagErreur.destroy();}
$(champ.id).removeProperty('aria-invalid');if($(champ.id+ChampSaisieTag.prefixIdZoneMessageErreur)!==null){$(champ.id+ChampSaisieTag.prefixIdZoneMessageErreur).addClass('message_erreur_invisible');$(champ.id+ChampSaisieTag.prefixIdZoneMessageErreur).innerHTML="";}},controleHeure:function(champ){var erreur=false;var heureSaisie=champ.value;var heureSaisieSize=heureSaisie.length;if(!ChampSaisieTag.isEmpty(champ)&&(heureSaisieSize===4||heureSaisieSize===5||heureSaisieSize===6||heureSaisieSize===8)){if(heureSaisieSize===8){heureSaisie=heureSaisie.replace(":","");heureSaisie=heureSaisie.replace(":","");}
var Lheure=(heureSaisie).split("");var regExpFormatHH_MM=new RegExp("^[0-9]{4}$","g");var regExpFormatHHDeuxPointsMM=new RegExp("^[0-9]{2}[:]{1}[0-9]{2}$","g");var regExpFormatHH_MM_SS=new RegExp("^[0-9]{6}$","g");if(regExpFormatHH_MM.test(heureSaisie)){heureSaisie=Lheure[0]+Lheure[1]+":"+Lheure[2]+Lheure[3]+":00";}else{if(regExpFormatHHDeuxPointsMM.test(heureSaisie)){heureSaisie+=":00";}else{if(regExpFormatHH_MM_SS.test(heureSaisie)){heureSaisie=Lheure[0]+Lheure[1]+":"+Lheure[2]+Lheure[3]+":"+Lheure[4]+Lheure[5];}else{erreur=true;}}}}else{erreur=true;}
champ.value=heureSaisie;if(erreur&&!ChampSaisieTag.isEmpty(champ)){ChampSaisieTag.erreurChamp(champ,ChampSaisieTag.lblErreurHeure);return false;}else{ChampSaisieTag.champOK(champ);}
return true;},completeAnnee:function(annee,pPivot){if(pPivot===undefined){return"20"+annee;}
if(annee<pPivot){return"20"+annee;}else{return"19"+annee;}},normaliseDateAvecSlash:function(dateSaisie,pPivot){var dateSplitee=dateSaisie.split('/');if(dateSplitee[0].length<2){dateSaisie='0'+dateSplitee[0]+'/';}else{dateSaisie=dateSplitee[0]+'/';}
if(dateSplitee[1].length<2){dateSaisie+='0'+dateSplitee[1]+'/';}else{dateSaisie+=dateSplitee[1]+'/';}
if(dateSplitee[2].length===2){dateSaisie+=ChampSaisieTag.completeAnnee(dateSplitee[2],pPivot);}else{dateSaisie+=dateSplitee[2];}
return dateSaisie;},controleDate:function(champ,pPivot){var erreur=false;var dateSaisie=champ.value;var dateTableau=dateSaisie.split("");var regSixCaracEtQueDesNombres=new RegExp("^[0-9]{6}$","g");var regHuitCaracEtQueDesNombres=new RegExp("^[0-9]{8}$","g");var regFormatDate=new RegExp("^[0-9]{1,2}\/[0-9]{1,2}\/([0-9]{2}|[0-9]{4})$","g");if(regSixCaracEtQueDesNombres.test(dateSaisie)){dateSaisie=dateTableau[0]+dateTableau[1]+"/"+dateTableau[2]+dateTableau[3]+"/"+
ChampSaisieTag.completeAnnee(dateTableau[4]+dateTableau[5],pPivot);}else{if(regHuitCaracEtQueDesNombres.test(dateSaisie)){dateSaisie=dateTableau[0]+dateTableau[1]+"/"+dateTableau[2]+dateTableau[3]+"/"+
dateTableau[4]+dateTableau[5]+dateTableau[6]+dateTableau[7];}else{if(regFormatDate.test(dateSaisie)){dateSaisie=ChampSaisieTag.normaliseDateAvecSlash(dateSaisie,pPivot);}else{erreur=true;}}}
champ.value=dateSaisie;if(erreur&&!ChampSaisieTag.isEmpty(champ)){ChampSaisieTag.erreurChamp(champ,ChampSaisieTag.lblErreurDate);return false;}else{ChampSaisieTag.champOK(champ);}
return true;},controleTel:function(champ){var telSaisie=champ.value;var regExpFormatTel=new RegExp("^0[1-9]([-. ]?[0-9]{2}){4}$","g");if(regExpFormatTel.test(telSaisie)){telSaisie=telSaisie.replace(/[-. ]/g,'');var telComplet=telSaisie.substr(0,2)+ChampSaisieTag.separateurTelephone;telComplet+=telSaisie.substr(2,2)+ChampSaisieTag.separateurTelephone;telComplet+=telSaisie.substr(4,2)+ChampSaisieTag.separateurTelephone;telComplet+=telSaisie.substr(6,2)+ChampSaisieTag.separateurTelephone;telComplet+=telSaisie.substr(8,2);ChampSaisieTag.champOK(champ);champ.value=telComplet;}else{if(ChampSaisieTag.isEmpty(champ)){ChampSaisieTag.champOK(champ);}else{ChampSaisieTag.erreurChamp(champ,ChampSaisieTag.lblErreurTel);return false;}}
return true;},ajoutMessageErreur:function(message){ChampSaisieTag.messagesErreur[0]=message;},recupMessagesErreur:function(){return ChampSaisieTag.messagesErreur[0];},controleTaille:function(champ,tailleMin,tailleMax,message){var taille=champ.value.length;if(taille<tailleMin||taille>tailleMax){ChampSaisieTag.ajoutMessageErreur(message);return false;}
return true;},controlePattern:function(champ,regex,message){var regexp=new RegExp(regex);if(!regexp.test(champ.value)){ChampSaisieTag.ajoutMessageErreur(message);return false;}
return true;},controleMin:function(champ,valeurMin,message){var valeur=champ.value.replace(',','.');if(ChampSaisieTag.isEmpty(champ)||isNaN(valeur)||valeur<valeurMin){ChampSaisieTag.ajoutMessageErreur(message);return false;}
return true;},controleMax:function(champ,valeurMax,message){var valeur=champ.value.replace(',','.');if(ChampSaisieTag.isEmpty(champ)||isNaN(valeur)||valeur>valeurMax){ChampSaisieTag.ajoutMessageErreur(message);return false;}
return true;},controleFuture:function(champ,message){Date.defineParser('%d/%m/%Y');var valeur=new Date().parse(champ.value);if(ChampSaisieTag.isEmpty(champ)||!valeur.isValid()||valeur<(new Date())){ChampSaisieTag.ajoutMessageErreur(message);return false;}
return true;},controlePast:function(champ,message){Date.defineParser('%d/%m/%Y');var valeur=new Date().parse(champ.value);if(ChampSaisieTag.isEmpty(champ)||!valeur.isValid()||valeur>(new Date())){ChampSaisieTag.ajoutMessageErreur(message);return false;}
return true;},effacerFormulaire:function(formid){ChampTag.getForm(formid).getElements('span').each(function(span){var champ;if(span.hasClass(ChampSaisieTag.classSpan)){champ=span.getElement('input');ChampSaisieTag.champOK(champ);$(champ.id).setProperty('value','');}});return true;}};
var ChampTag={suffixIdErr:"_messageErreur",erreurChamp:function(champ,messageErreur){if(messageErreur.length!==0){if(champ.get('tag')==='input'&&champ.get('type')==='text'){ChampSaisieTag.erreurChamp(champ,messageErreur);}else if(champ.get('tag')==='textarea'){TexteTag.erreurChamp(champ,messageErreur);}else if(champ.getParent('.zone_choix')!==null){ChoixTag.erreurChamp(champ,messageErreur);}else if(champ.getParent('.zone_combo')!==null){ComboTag.erreurChamp(champ,messageErreur);}}},champOK:function(champ){if(champ.get('tag')==='input'&&champ.get('type')==='text'){ChampSaisieTag.champOK(champ);}else if(champ.get('tag')==='textarea'){TexteTag.champOK(champ);}else if(champ.getParent('.zone_choix')!==null){ChoixTag.champOK(champ);}else if(champ.getParent('.zone_combo')!==null){ComboTag.champOK(champ);}},getForm:function(elm){var formElement=null;if(document.id(elm)&&document.id(elm).tagName==="FORM"){formElement=document.id(elm);}else if($(elm)&&$(elm).tagName==="FORM"){formElement=$(elm);}else if(document.getElementsByName(elm).length>0&&document.getElementsByName(elm)[0].tagName==="FORM"){formElement=document.getElementsByName(elm)[0];}else if($(elm)){formElement=$(elm).getParent('form');}
return formElement;},retablirFormulaire:function(formid){ChampTag.getForm(formid).getElements('.zone_champ_saisie input, .zone_choix .choix-nav-v, .zone_choix .choix-nav-h, .zone_texte textarea, .zone_combo select').each(function(elem){ChampTag.champOK(elem);});return true;},effacerFormulaire:function(formid){ChampSaisieTag.effacerFormulaire(formid);ChoixTag.effacerFormulaire(formid);TexteTag.effacerFormulaire(formid);ComboTag.effacerFormulaire(formid);return true;}};
var ChoixTag={erreurChamp:function(champ,messageErreur){var container=$(champ.id).getParent('.zone_choix');var tagErreur=$(champ.id).getParent('.erreur_choix');if(!tagErreur){tagErreur=new Element('div');tagErreur.addClass('erreur_choix');$(champ.id).inject(tagErreur);container.addClass('erreur_champ');tagErreur.inject(container,'top');}
if($(champ.id+ChampTag.suffixIdErr)!==null){$(champ.id+ChampTag.suffixIdErr).innerHTML=messageErreur;$(champ.id+ChampTag.suffixIdErr).style.display="inline-block";}},champOK:function(champ){var container=$(champ.id).getParent('.zone_choix');var tagErreur=$(champ.id).getParent('.erreur_choix');if(tagErreur){$(champ.id).inject(container,'top');tagErreur.destroy();}
container.removeClass('erreur_champ');if($(champ.id+ChampTag.suffixIdErr)!==null){$(champ.id+ChampTag.suffixIdErr).style.display="none";$(champ.id+ChampTag.suffixIdErr).innerHTML="";}},effacerFormulaire:function(formid){ChampTag.getForm(formid).getElements('.zone_choix .choix-nav-v, .zone_choix .choix-nav-h').each(function(champ){ChoixTag.champOK(champ);champ.getElements('input').each(function(choix){choix.erase('checked');});});return true;}};
Elements.implement({chosen:function(options){return this.each(function(el){if(!el.hasClass("chzn-done")){return new Chosen(el,options);}});}});var Chosen=new Class({Implements:Options,Binds:['test_active_click','container_mousedown','container_mouseup','mouse_enter','mouse_leave','search_results_mouseup','search_results_mouseover','search_results_mouseout','input_blur','keyup_checker','keydown_checker','choices_click','input_focus','activate_field','results_update_field'],options:{allow_single_deselect:false,disable_search_threshold:0,placeholder:null,width:null},active_field:false,mouse_on_container:false,results_showing:false,result_highlighted:null,result_single_selected:null,choices:0,initialize:function(elmn,options){this.setOptions(options);this.form_field=elmn;this.is_multiple=this.form_field.multiple;this.is_rtl=this.form_field.hasClass('chzn-rtl');this.set_up_html();this.register_observers();this.update_label();this.form_field.addClass('chzn-done');},set_up_html:function(){if(!this.form_field.get('id')){this.form_field.set('id',String.uniqueID());}
this.container_id=this.form_field.id.replace(/(:|\.)/g,'_')+"_chzn";this.f_width=this.form_field.measure(function(){return(this.options.width?this.getSize().x:this.getSize().x+25);});this.default_text=this.options.placeholder?this.options.placeholder:Locale.get('Chosen.placeholder',this.form_field.multiple);this.container=new Element('div',{'id':this.container_id,'class':'chzn-container'+(this.is_rtl?' chzn-rtl':'')+" chzn-container-"+(this.is_multiple?"multi":"single"),'styles':{'width':this.f_width}});if(this.is_multiple){this.container.set('html','<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>');}else{this.container.set('html','<a href="javascript:void(0)" tabindex="-1" class="chzn-single" aria-expanded="false" id="'+this.container_id+'_text" aria-owns="'+this.container_id+'_drop"><span>'+this.default_text+'</span><span class="btn-down"><b></b></span></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input id="input_'+this.form_field.get('id')+'" type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>');}
this.form_field.setStyle('display','none').grab(this.container,'after');this.dropdown=this.container.getElement('div.chzn-drop');this.dropdown.set('id',this.container_id+'_drop');var dd_width=this.f_width-this.dropdown.get_side_border_padding();this.dropdown_pos();this.search_field=this.container.getElement('input');this.search_field.setProperty('aria-controls',this.container_id+'_listbox');this.search_results=this.container.getElement('ul.chzn-results');this.search_results.setProperty('role','listbox');this.search_results.set('id',this.container_id+'_listbox');this.search_results.tabIndex=-1;this.search_field_scale();this.search_no_results=this.container.getElement('li.no-results');if(this.is_multiple){this.search_choices=this.container.getElement('ul.chzn-choices');this.search_container=this.container.getElement('li.search-field');}else{this.search_container=this.container.getElement('div.chzn-search');this.selected_item=this.container.getElement('.chzn-single');var sf_width=dd_width-this.search_container.get_side_border_padding()-this.search_field.get_side_border_padding();this.search_field.setStyle('width',sf_width);}
this.results_build();this.form_field.fireEvent('liszt:ready',this);},register_observers:function(){this.container.addEvents({mousedown:this.container_mousedown,mouseup:this.container_mouseup,mouseenter:this.mouse_enter,mouseleave:this.mouse_leave});this.search_results.addEvents({mouseup:this.search_results_mouseup,mouseover:this.search_results_mouseover,mouseout:this.search_results_mouseout});this.form_field.addEvent("liszt:updated",this.results_update_field);this.search_field.addEvents({keyup:this.keyup_checker,keydown:this.keydown_checker});this.search_results.addEvents({blur:this.input_blur,keyup:this.keyup_checker,keydown:this.keydown_checker});if(this.is_multiple){this.search_choices.addEvent("click",this.choices_click);this.search_field.addEvent("focus",this.input_focus);}else{this.selected_item.addEvent("focus",this.activate_field);this.search_field.addEvent("focus",this.activate_field);}},unregister_observers:function(){this.container.removeEvents({mousedown:this.container_mousedown,mouseup:this.container_mouseup,mouseenter:this.mouse_enter,mouseleave:this.mouse_leave});this.search_results.removeEvents({mouseup:this.search_results_mouseup,mouseover:this.search_results_mouseover,mouseout:this.search_results_mouseout});this.form_field.removeEvent("liszt:updated",this.results_update_field);this.search_field.removeEvents({blur:this.input_blur,keyup:this.keyup_checker,keydown:this.keydown_checker});this.search_results.removeEvents({blur:this.input_blur,keyup:this.keyup_checker,keydown:this.keydown_checker});if(this.is_multiple){this.search_choices.removeEvent("click",this.choices_click);this.search_field.removeEvent("focus",this.input_focus);}else{this.selected_item.removeEvent("focus",this.activate_field);}
document.removeEvent('click',this.test_active_click);},update_label:function(){var lbl=$$('label[for='+this.form_field.get('id')+']');if(lbl!=null){lbl.setProperty("for",'input_'+this.form_field.get('id'));}},search_field_disabled:function(){this.is_disabled=this.form_field.get('disabled');if(this.is_disabled){this.container.addClass('chzn-disabled');this.search_field.set('disabled',true);if(!this.is_multiple){this.selected_item.removeEvent("focus",this.activate_field);}
this.close_field();}else{this.container.removeClass('chzn-disabled');this.search_field.set('disabled',false);if(!this.is_multiple){this.selected_item.addEvent("focus",this.activate_field);}}},container_mousedown:function(evt){if(!this.is_disabled){var target_closelink=evt!=null?evt.target.hasClass("search-choice-close"):false;if(!this.pending_destroy_click&&!target_closelink){if(!this.active_field){if(this.is_multiple){this.search_field.set('value','');}
document.addEvent('click',this.test_active_click);this.results_show();}else if(!this.is_multiple&&evt&&(evt.target===this.selected_item||evt.target.getParents('a.chzn-single').length)){evt.preventDefault();this.results_toggle();}
this.activate_field();}else{this.pending_destroy_click=false;}}},container_mouseup:function(evt){if(evt.target.get('tag').toUpperCase()==="ABBR"){return this.results_reset(evt);}},mouse_enter:function(){this.mouse_on_container=true;},mouse_leave:function(){this.mouse_on_container=false;},input_focus:function(evt){if(!this.active_field){setTimeout(this.container_mousedown,50);}},input_blur:function(evt){if(!this.mouse_on_container){this.active_field=false;setTimeout(this.blur_test.bind(this),100);}},blur_test:function(evt){if(!this.active_field&&this.container.hasClass('chzn-container-active')){this.close_field();}},close_field:function(){document.removeEvent('click',this.test_active_click);this.active_field=false;this.results_hide();this.container.removeClass("chzn-container-active");this.selected_item.removeClass('chzn-container-focus');this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();this.search_field_scale();},activate_field:function(){if(!this.container.hasClass('chzn-disabled')){this.container.addClass('chzn-container-active');this.active_field=true;this.search_field.set('value',this.search_field.get('value'));this.selected_item.addClass('chzn-container-focus');this.search_field.removeEvents('blur');this.search_field.addEvent('blur',this.input_blur);this.search_field.focus();}},test_active_click:function(evt){if(evt.target.getParents('#'+this.container_id).length){this.active_field=true;}else{this.close_field();}},results_build:function(){this.parsing=true;this.results_data=this.form_field.select_to_array();if(this.is_multiple&&(this.choices>0)){this.search_choices.getElements("li.search-choice").destroy();this.choices=0;}else if(!this.is_multiple){this.selected_item.getElements("span:not(.btn-down)").set('text',this.default_text);if(this.form_field.options.length<=this.options.disable_search_threshold){this.container.addClass("chzn-container-single-nosearch");}else{this.container.removeClass("chzn-container-single-nosearch");}}
var content='';this.results_data.each(function(data){if(data.group){content+=this.result_add_group(data);}else if(!data.empty){content+=this.result_add_option(data);if(data.selected&&this.is_multiple){this.choice_build(data);}else if(data.selected&&!this.is_multiple){this.selected_item.getElements("span:not(.btn-down)").set('text',data.text);if(this.options.allow_single_deselect){this.single_deselect_control_build();}}}},this);this.search_field_disabled();this.show_search_field_default();this.search_field_scale();this.search_results.set('html',content);this.parsing=false;},result_add_group:function(group){if(!group.disabled){group.dom_id=this.container_id+"_g_"+group.array_index;return'<li id="'+group.dom_id+'" class="group-result"><div>'+group.label+'</div></li>';}else{return'';}},result_add_option:function(option){if(!option.disabled){option.dom_id=this.container_id+"_o_"+option.array_index;var classes=option.selected&&this.is_multiple?[]:["active-result"];if(option.selected){classes.push('result-selected');}
if(option.group_array_index!=null){classes.push("group-option");}
if(option.classes!==""){classes.push(option.classes);}
var style=option.style.cssText!==''?' style="'+option.style+'"':'';return'<li id="'+option.dom_id+'" tabindex="-1" role="option" aria-controls="'+this.container_id+'_text" '+(option.selected?'aria-selected="true"':'')+' class="'+classes.join(' ')+'"'+style+'>'+option.html+'</li>';}else{return'';}},results_update_field:function(){this.result_clear_highlight();this.result_single_selected=null;this.results_build();this.form_field.setStyle('display','block');this.form_field.setStyle('display','none');},result_do_highlight:function(el){if(el){this.result_clear_highlight();this.result_highlight=el;this.result_highlight.addClass("highlighted");}},result_clear_highlight:function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted");}
this.result_highlight=null;},results_toggle:function(){if(this.results_showing){this.results_hide();}else{this.results_show();}},dropdown_pos:function(){var outOfScreen=(this.container.getCoordinates().top+this.container.getCoordinates().height-window.getScroll().y+this.dropdown.getComputedSize().totalHeight)>window.getSize().y;var dd_width=this.f_width-this.dropdown.get_side_border_padding();if((outOfScreen||this.container.getParent(".force-drop-up"))&&!this.container.getParent(".force-drop-down")){this.dropdown.swapClass("chzn-drop-down","chzn-drop-up");this.dropdown.setStyles({'width':dd_width,"top":"auto",bottom:this.container.getCoordinates().height});}else{this.dropdown.swapClass("chzn-drop-up","chzn-drop-down");this.dropdown.setStyles({'width':dd_width,"top":this.container.getCoordinates().height,"bottom":"auto"});}},results_show:function(){if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");this.selected_item.setProperty('aria-expanded','true');this.search_results.setProperty('aria-hidden','false');if(this.result_single_selected){this.result_do_highlight(this.result_single_selected);}}
this.dropdown_pos();this.dropdown.setStyle('left',0);this.results_showing=true;this.selected_item.removeClass('chzn-container-focus');this.search_field.focus();this.search_field.set('value',this.search_field.get('value'));this.winnow_results();},results_hide:function(){if(!this.is_multiple){this.selected_item.removeClass("chzn-single-with-drop");this.selected_item.setProperty('aria-expanded','false');this.search_results.setProperty('aria-hidden','true');}
this.result_clear_highlight();this.dropdown.setStyle('left',-9000);this.results_showing=false;},show_search_field_default:function(){if(this.is_multiple&&(this.choices<1)&&!this.active_field){this.search_field.set('value',this.default_text);this.search_field.addClass("default");}else{this.search_field.set('value',"");this.search_field.removeClass("default");}},search_results_mouseup:function(evt){var target=evt.target.hasClass("active-result")?evt.target:evt.target.getParent(".active-result");if(target){this.result_highlight=target;this.result_select(evt);}},search_results_mouseover:function(evt){var target=evt.target.hasClass("active-result")?evt.target:evt.target.getParent(".active-result");if(target){this.result_do_highlight(target);}},search_results_mouseout:function(evt){},choices_click:function(evt){evt.preventDefault();if(this.active_field&&!(evt.target.hasClass("search-choice")||evt.target.getParent('.search-choice'))&&!this.results_showing){this.results_show();}},choice_build:function(item){var choice_id=this.container_id+"_c_"+item.array_index;this.choices+=1;var el=new Element('li',{'id':choice_id}).addClass('search-choice').set('html','<span>'+item.html+'</span><a href="#" class="search-choice-close" rel="'+item.array_index+'"></a>');this.search_container.grab(el,'before');el.getElement("a").addEvent('click',this.choice_destroy_link_click.bind(this));},choice_destroy_link_click:function(evt){evt.preventDefault();if(!this.is_disabled){this.pending_destroy_click=true;this.choice_destroy(evt.target);}else{evt.stop();}},choice_destroy:function(link){this.choices-=1;this.show_search_field_default();if(this.is_multiple&&(this.choices>0)&&(this.search_field.value.length<1)){this.results_hide();}
this.result_deselect(link.get("rel"));link.getParent('li').destroy();},results_reset:function(evt){this.form_field.options[0].selected=true;this.selected_item.getElement("span:not(.btn-down)").set('text',this.default_text);this.show_search_field_default();evt.target.destroy();this.form_field.fireEvent("change");if(this.active_field){this.results_hide();}},result_select:function(evt){if(this.result_highlight){var high=this.result_highlight,high_id=high.id;this.result_clear_highlight();if(this.is_multiple){this.result_deactivate(high);}else{var selected=this.search_results.getElement(".result-selected");if(selected){selected.removeClass("result-selected");selected.removeProperty("aria-selected");}
this.result_single_selected=high;}
high.addClass("result-selected");high.setProperty("aria-selected","true");var position=high_id.substr(high_id.lastIndexOf("_")+1),item=this.results_data[position];item.selected=true;this.form_field.selectedIndex=item.options_index;if(this.is_multiple){this.choice_build(item);}else{this.selected_item.getElement("span:not(.btn-down)").set('text',item.text);if(this.options.allow_single_deselect){this.single_deselect_control_build();}}
if(!this.is_multiple||!evt.control){this.results_hide();}
this.search_field.set('value',"");this.form_field.fireEvent("change");this.search_field_scale();}},result_activate:function(el){el.addClass("active-result");},result_deactivate:function(el){el.removeClass("active-result");},result_deselect:function(pos){var result_data=this.results_data[pos];result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;var result=document.id(this.container_id+"_o_"+pos);result.removeClass("result-selected").addClass("active-result").setStyle('display','block');result.removeProperty('aria-selected');this.result_clear_highlight();this.winnow_results();this.form_field.fireEvent("change");this.search_field_scale();},single_deselect_control_build:function(){if(this.options.allow_single_deselect&&(this.selected_item.getElements("abbr").length<1)){return this.selected_item.getElement("span").grab(new Element('abbr',{'class':'search-choice-close'}),'before');}},results_search:function(evt){if(this.results_showing){this.winnow_results();}else{this.results_show();}},winnow_results:function(){this.no_results_clear();var results=0,searchText=this.search_field.get('value')===this.default_text?"":new Element('div',{text:this.search_field.get('value').trim()}).get('html'),regex=new RegExp('^'+searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i'),zregex=new RegExp(searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i');if(this.container.hasClass("chzn-container-single-nosearch")){searchText="";}
this.results_data.each(function(option){if(!option.disabled&&!option.empty){if(option.group){document.id(option.dom_id).setStyle('display','none');}else if(!(this.is_multiple&&option.selected)){var found=false,result_id=option.dom_id,result=$(result_id);if(regex.test(option.html)||this.container.hasClass("chzn-container-single-nosearch")){found=true;results+=1;}else if((option.html.indexOf(" ")>=0)||option.html.indexOf("[")===0){var parts=[option.html.replace(/\[|\]/g,"")];if(parts.length){parts.each(function(part){if(regex.test(part)){found=true;results+=1;}});}}
if(found){var text;if(searchText.length){var startpos=option.html.search(zregex);text=option.html.substr(0,startpos+searchText.length)+'</em>'+option.html.substr(startpos+searchText.length);text=text.substr(0,startpos)+'<em>'+text.substr(startpos);}else{text=option.html;}
result.set('html',text);this.result_activate(result);if(option.group_array_index!=null){document.id(this.results_data[option.group_array_index].dom_id).setStyle('display','list-item');}}else{if(this.result_highlight&&result_id===this.result_highlight.id){this.result_clear_highlight();}
this.result_deactivate(result);}}}},this);if((results<1)&&searchText.length){this.no_results(searchText);}else{this.winnow_results_set_highlight();}},winnow_results_clear:function(){this.search_field.set('value','');this.search_results.getElements("li").each(function(li){if(li.hasClass("group-result")){li.setStyle('display','block');}else{if(this.is_multiple&&!li.hasClass("result-selected")){this.result_activate(li);}}},this);},winnow_results_set_highlight:function(){if(!this.result_highlight){var selected_results=!this.is_multiple?this.search_results.getElements(".active-result.result-selected"):[];var do_high=selected_results.length?selected_results[0]:null;if(do_high!=null){this.result_do_highlight(do_high);}}},no_results:function(terms){var no_results_html=new Element('li',{'class':'no-results'}).set('html',Locale.get('Chosen.noResults')+' "<span></span>"');no_results_html.getElement("span").set('html',terms);this.search_results.grab(no_results_html);},no_results_clear:function(){this.search_results.getElements(".no-results").destroy();},keydown_arrow:function(){this.search_field.removeEvents('blur');if(!this.result_highlight){var first_active=this.search_results.getElement("li.active-result");if(first_active){first_active.focus();this.result_do_highlight(first_active);}}else if(this.results_showing){var next_sib=this.result_highlight.getNext("li.active-result");if(next_sib){next_sib.focus();this.result_do_highlight(next_sib);}}
if(!this.results_showing){this.results_show();}},keyup_arrow:function(){if(!this.results_showing&&!this.is_multiple){this.results_show();}else if(this.result_highlight){var prev_sib=this.result_highlight.getPrevious('li.active-result');if(prev_sib){this.search_field.removeEvents('blur');prev_sib.focus();this.result_do_highlight(prev_sib);}}},keydown_backstroke:function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.getElement("a"));this.clear_backstroke();}else{this.pending_backstroke=this.search_choices.getLast("li.search-choice");this.pending_backstroke.addClass("search-choice-focus");}},clear_backstroke:function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus");}
this.pending_backstroke=null;},keyup_checker:function(evt){this.search_field_scale();switch(evt.key){case'backspace':if(this.is_multiple&&(this.backstroke_length<1)&&(this.choices>0)){this.keydown_backstroke();}else if(!this.pending_backstroke){this.result_clear_highlight();this.results_search();}
break;case'enter':evt.preventDefault();if(this.results_showing){this.result_select(evt);this.activate_field();}
break;case'esc':if(this.results_showing){this.results_hide();}
break;case'tab':case'up':case'down':case'shift':case'ctrl':break;default:if(!this.container.hasClass("chzn-container-single-nosearch")){this.results_search();}}},keydown_checker:function(evt){var eventOnSearchField=(evt.target.get('tag')==='input');this.search_field_scale();if(evt.key!=='backspace'&&this.pending_backstroke){this.clear_backstroke();}
switch(evt.key){case'backspace':if(eventOnSearchField){this.backstroke_length=this.search_field.value.length;}else{this.search_field.focus();this.search_field.fireEvent('keydown',evt);evt.preventDefault();}
break;case'tab':if(this.results_showing&&!this.is_multiple){this.result_select(evt);}
this.mouse_on_container=false;break;case'enter':evt.preventDefault();break;case'up':evt.preventDefault();this.keyup_arrow();break;case'down':evt.preventDefault();this.keydown_arrow();break;default:this.search_field.focus();break;}},search_field_scale:function(){if(this.is_multiple){var h=0,w=0,style_block={position:'absolute',left:'-1000px',top:'-1000px',display:'none'},styles=this.search_field.getStyles('font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing');Object.merge(style_block,styles);var div=new Element('div',{'styles':style_block});div.set('text',this.search_field.get('value'));$(document.body).grab(div);w=div.getDimensions().width+25;div.destroy();if(w>this.f_width-10){w=this.f_width-10;}
this.search_field.setStyle('width',w);var dd_top=this.container.getCoordinates().height;this.dropdown.setStyle('top',dd_top);}}});Element.implement({get_side_border_padding:function(){var styles=this.getStyles('padding-left','padding-right','border-left-width','border-right-width'),notNull=Object.filter(styles,function(value){return(typeof(value)=='string');}),mapped=Object.map(notNull,function(s){return s.toInt();}),array=Object.values(mapped),result=0,l=array.length;if(l){while(l--){result+=array[l];}}
return result;},select_to_array:function(){var parser=new SelectParser();this.getChildren().each(function(child){parser.add_node(child);});return parser.parsed;}});var SelectParser=new Class({options_index:0,parsed:[],add_node:function(child){if(child.nodeName.toUpperCase()==="OPTGROUP"){this.add_group(child);}else{this.add_option(child);}},add_group:function(group){var group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:group.label,children:0,disabled:group.disabled});group.getChildren().each(function(option){this.add_option(option,group_position,group.disabled);},this);},add_option:function(option,group_position,group_disabled){if(option.nodeName.toUpperCase()==="OPTION"){if(option.text!==""){if(group_position!=null){this.parsed[group_position].children+=1;}
this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.get("value"),text:option.get("text").trim(),html:option.get("html"),selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position,classes:option.className,style:option.style.cssText});}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true});}
this.options_index+=1;}}});var ComboTag={erreurChamp:function(champ,messageErreur){var container=$(champ.id).getParent('.zone_combo');container.addClass('erreur_combo');if($(champ.id+ChampTag.suffixIdErr)!==null){$(champ.id+ChampTag.suffixIdErr).innerHTML=messageErreur;$(champ.id+ChampTag.suffixIdErr).style.display="inline-block";}},champOK:function(champ){var container=$(champ.id).getParent('.zone_combo');container.removeClass('erreur_combo');if($(champ.id+ChampTag.suffixIdErr)!==null){$(champ.id+ChampTag.suffixIdErr).style.display="none";$(champ.id+ChampTag.suffixIdErr).innerHTML="";}},effacerFormulaire:function(formid){ChampTag.getForm(formid).getElements('.zone_combo select').each(function(champ){ComboTag.champOK(champ);champ.selectedIndex=0;champ.fireEvent("liszt:updated");});return true;}};var combosTag={};combosTag.clearCombo=function(combo){var options=combo.getElements('option');for(i=1;i<options.length;i++){options[i].destroy();}};combosTag.addItems=function(comboTarget,data){if(data){for(i=0;i<data.length;i++){var elem=data[i];if(elem.label){var group=new Element('optgroup',{label:elem.label});for(j=0;j<elem.items.length;j++){new Element('option',{value:elem.items[j].value,text:elem.items[j].text}).inject(group);}
group.inject(comboTarget);}else{new Element('option',{value:elem.value,text:elem.text}).inject(comboTarget);}}}};combosTag.getComboRequest=function(comboTarget,url){return new Request.JSON({url:url,onSuccess:function(data_combo){combosTag.clearCombo(comboTarget);combosTag.addItems(comboTarget,data_combo);comboTarget.removeProperty('disabled');comboTarget.fireEvent("liszt:updated");}});};combosTag.getNextComboId=function(comboIdList,currentComboId){for(i=0;i<comboIdList.length;i++){if(comboIdList[i]==currentComboId){return comboIdList[i+1];}}
return null;};combosTag.clearAllFollowingCombos=function(comboIdList,comboId){var clearFlag=false;for(j=0;j<comboIdList.length;j++){if(clearFlag){combosTag.clearCombo($(comboIdList[j]));$(comboIdList[j]).set("disabled","disabled");$(comboIdList[j]).fireEvent("liszt:updated");}
if(comboIdList[j]==comboId){clearFlag=true;}}};combosTag.initAjax=function(comboIdList,url,params){for(i=0;i<(comboIdList.length-1);i++){$(comboIdList[i]).addEvent('change',function(event){var nextComboId=combosTag.getNextComboId(comboIdList,this.id);var request=combosTag.getComboRequest($(nextComboId),url);var data=this.name+"="+this.value;if(params!==""){data+="&"+params;}
request.send(data);combosTag.clearAllFollowingCombos(comboIdList,nextComboId);});}};combosTag.getItems=function(data,comboIdList,valueSelected,level){var data_combo=[];if(level<1){data_combo=data;}else{data_combo=combosTag.getItems(data,comboIdList,$(comboIdList[level-1]).value,level-1);}
for(i=0;i<data_combo.length;i++){var elem=data_combo[i];if(elem.label){for(j=0;j<elem.items.length;j++){if(elem.items[j].value==valueSelected){return elem.items[j].items;}}}else{if(elem.value==valueSelected){return elem.items;}}}};combosTag.updateCombo=function(comboTarget,data,comboIdList,valueSelected,level){combosTag.clearCombo(comboTarget);var data_combo=combosTag.getItems(data,comboIdList,valueSelected,level);combosTag.addItems(comboTarget,data_combo);comboTarget.removeProperty('disabled');comboTarget.fireEvent("liszt:updated");};combosTag.initLocal=function(comboIdList,data){for(i=0;i<(comboIdList.length-1);i++){$(comboIdList[i]).addEvent('change',function(event){var nextComboId=combosTag.getNextComboId(comboIdList,this.id);combosTag.updateCombo($(nextComboId),data,comboIdList,this.value,i);combosTag.clearAllFollowingCombos(comboIdList,nextComboId);});}};
var EtapeTag=new Class({element:null,initialize:function(element){this.element=element;this.initEvents();},initEvents:function(){this.element.getElement('ul').navigChildsSelector='li > a:not([aria-disabled=true])';ListNavig.initEvents(this.element);}});EtapeTag.extend({components:{},init:function(element){this.components[element.id]=new EtapeTag(element);}});
var Fenetre=new Class({Implements:[Options],options:{overlays:true,url:null,draggable:false,onload:false,position:document.body,cssclass:null},element:null,triggerElement:null,level:null,drag:null,keyboardHandlerId:null,focusableElements:[],overlay:null,initialize:function(elementId,options){if(Fenetre.components[elementId]!==undefined){Fenetre.components[elementId].destroy();}
Fenetre.components[elementId]=this;this.setOptions(options);this.element=$(elementId);if(this.element===null){this.construct(elementId);}else{$(document.body).adopt(this.element);}
var closeButton=this.getCloseElement();if(closeButton!==null){closeButton.set('tabindex',0);closeButton.addEvent('click',this.close.bind(this));closeButton.addEvent('keydown',function(evt){switch(evt.key){case'enter':this.close();evt.stop();break;default:break;}}.bind(this));}
if(this.options.draggable){this.enableDrag();}
if(this.options.onload){this.open();}},construct:function(elementId){this.element=new Element('div',{id:elementId,'class':'invisible fenetre','tabindex':0,role:this.getRole()});if(this.options.cssclass){this.element.addClass(this.options.cssclass);}
var header=this.constructHeader();this.element.set('aria-labelledby',header.getElement('.fenetre-title').id);header.inject(this.element);var elementContent=new Element('div',{'class':'fenetre-content'});elementContent.inject(this.element);this.element.inject($(document.body));},constructHeader:function(){var elementHeader=new Element('div',{'class':'fenetre-header'});var elementTitle=new Element('span',{id:this.element.id+'_title','class':'fenetre-title'});if(this.options.title){elementTitle.set('html',this.options.title);}
var elementClose=new Element('span',{id:this.element.id+'_close','class':'fenetre-button',role:'button',title:'Fermer'});var elementLabelClose=new Element('span',{'class':'label-close','html':'Fermer'});elementTitle.inject(elementHeader);elementLabelClose.inject(elementClose);elementClose.inject(elementHeader);return elementHeader;},getRole:function(){return'';},getCloseElement:function(){return this.element.getElement('.fenetre-button');},enableDrag:function(){var header=this.element.getElement('.fenetre-header');header.set('tabindex',0);this.element.addClass('draggable');this.drag=new Drag(this.element.id,{snap:0,limit:{x:[0,false],y:[0,false]},handle:header,onSnap:function(el){el.addClass('dragging');},onComplete:function(el){el.removeClass('dragging');}});header.addEvent('keydown',function(evt){var currentPosition=this.element.getPosition();switch(evt.key){case'up':if(currentPosition.y>0){this.element.setPosition({x:currentPosition.x,y:currentPosition.y-Fenetre.dragStep});}
evt.stop();break;case'down':this.element.setPosition({x:currentPosition.x,y:currentPosition.y+Fenetre.dragStep});evt.stop();break;case'left':if(currentPosition.x>0){this.element.setPosition({x:currentPosition.x-Fenetre.dragStep,y:currentPosition.y});}
evt.stop();break;case'right':this.element.setPosition({x:currentPosition.x+Fenetre.dragStep,y:currentPosition.y});evt.stop();break;default:break;}}.bind(this));},open:function(){this.triggerElement=document.activeElement;this.element.removeClass('invisible');Fenetre.visibleStack.push(this);this.level=Fenetre.visibleStack.length;if(this.options.overlays){this.drawOverlay();}
this.element.setStyle('z-index',Fenetre.zIndexMin+(this.level*2)+1);this.position();if(this.options.url===null){this.element.focus();}else{this.loadContent();}
$(document).addEvent('keydown',this.keyboardHandlerId=this.keyboardHandler.bind(this));},position:function(){this.element.position({relativeTo:this.options.position});},drawOverlay:function(){var idOverlay=this.element.id+Fenetre.suffixOverlay;if(this.overlay){this.removeOverlay();}
this.overlay=new Element('div',{id:idOverlay});this.overlay.addClass(Fenetre.classOverlay);this.overlay.inject($(document.body),'top');this.overlay.setStyle('z-index',Fenetre.zIndexMin+(this.level*2));},loadContent:function(){var contentContainer=this.element.getElement('.fenetre-content');var self=this;contentContainer.set('aria-busy',true);contentContainer.set('html',Fenetre.waitMessageHtml);contentContainer.set('load',{method:'post',async:true,onFailure:function(){contentContainer.set('html',Fenetre.errorMessageHtml);},onError:function(){contentContainer.set('html',Fenetre.errorMessageHtml);},onComplete:function(){self.position();self.element.focus();}});contentContainer.load(this.options.url);contentContainer.set('aria-busy',false);},removeOverlay:function(){if(this.overlay){this.overlay.destroy();this.overlay=null;}},close:function(){this.element.addClass('invisible');Fenetre.visibleStack.pop();if(this.options.overlays){this.removeOverlay();}
$(document).removeEvent('keydown',this.keyboardHandlerId);if(this.triggerElement!==null){this.triggerElement.focus();}
this.element.fireEvent('close');},destroy:function(){this.removeOverlay();this.element.destroy();},keyboardHandler:function(event){if(Fenetre.getVisibleFenetre()===this){if(event.key==='esc'){this.close();event.stop();}else if(event.key==='tab'){event.stop();this.initFocusableElements();var focusableElement;if(event.shift){focusableElement=this.getPreviousFocusableElement();}else{focusableElement=this.getNextFocusableElement();}
if(focusableElement!==null){focusableElement.focus();}}}},setContent:function(htmlContent){this.element.getElement('.fenetre-content').set('html',htmlContent);},initFocusableElements:function(){var focusableElementsSelector='[tabindex]:not([tabindex^="-"]),a[href]:not([tabindex]),'
+'input:not([tabindex]):not([disabled="disabled"]),'
+'button:not([tabindex]):not([disabled="disabled"]),'
+'select:not([tabindex]):not([disabled="disabled"]),'
+'textarea:not([tabindex]):not([disabled="disabled"])';var visibleFocusableElements=this.element.getElements(focusableElementsSelector).filter(function(item,index){return item.isDisplayed();});this.focusableElements=$$(this.element).concat(visibleFocusableElements);},getNextFocusableElement:function(){for(var i=1;i<this.focusableElements.length;i++){if(this.focusableElements[i-1]===document.activeElement){return this.focusableElements[i];}}
return this.focusableElements[0];},getPreviousFocusableElement:function(){for(var i=this.focusableElements.length-2;i>=0;i--){if(this.focusableElements[i+1]===document.activeElement){return this.focusableElements[i];}}
return this.focusableElements[this.focusableElements.length-1];}});Fenetre.extend({components:{},visibleStack:[],suffixOverlay:'_overlay',classOverlay:'popbg',zIndexMin:98,dragStep:4,waitMessageHtml:'<p class="zone-attente">Chargement en cours, veuillez patienter</p>',errorMessageHtml:'<p class="zone-alerte">Le serveur est temporairement indisponible, veuillez fermer la fen&ecirc;tre</p>',initDialogue:function(elementId,options){return new Fenetre.Dialogue(elementId,options);},initModale:function(elementId,options){return new Fenetre.Modale(elementId,options);},initBulle:function(elementId,options){return new Fenetre.Bulle(elementId,options);},getVisibleFenetre:function(){if(this.visibleStack.length>0){return this.visibleStack[this.visibleStack.length-1];}
return null;}});Fenetre.Dialogue=new Class({Extends:Fenetre,initialize:function(elementId,options){this.parent(elementId,options);this.element.addClass('dialogue');this.position();},getRole:function(){return'dialog';}});Fenetre.Modale=new Class({Extends:Fenetre,initialize:function(elementId,options){options.draggable=false;options.position=document.body;this.parent(elementId,options);this.element.addClass('modale');this.position();},getRole:function(){return'alert';},getCloseElement:function(){return this.element.getElement('.fenetre-header');}});Fenetre.Bulle=new Class({Extends:Fenetre,initialize:function(elementId,options){options.overlays=false;this.parent(elementId,options);this.element.addClass('bulle');document.addEvent('mousedown',function(event){if(Fenetre.visibleStack.contains(this)&&!this.element.contains(event.target)){this.close();}}.bind(this));},getRole:function(){return'alert';},position:function(){if(this.options.position===null||$(this.options.position)===$(document.body)){this.element.position({relativeTo:this.options.position});}else{var x=$(this.options.position).getPosition().x+$(this.options.position).getComputedSize().totalWidth;if(this.element.getComputedSize().totalWidth+x<$(document.body).getSize().x){this.element.position({relativeTo:this.options.position,position:'upperRight',edge:'upperLeft'});}else{this.element.position({relativeTo:this.options.position,position:'bottomRight',edge:'upperRight'});}}}});FenetreModaleTag={ouvrirFenetre:function(idFenetre){Fenetre.components[idFenetre].open();return false;},fermerFenetre:function(idFenetre){Fenetre.components[idFenetre].close();return false;}};
var Grille=new Class({Implements:[Options],options:{minrows:0,animationDuration:2000,threshold:300,collapse:true,button:true,expandTitle:'D\u00E9plier la liste',collapseTitle:'Plier la liste'},grid:null,container:null,button:null,isCollapse:false,activeElements:null,activeElementsSelector:'li[role=option]:not([aria-disabled=true]) .item-nl',items:null,initialize:function(elementId,options){Grille.components[elementId]=this;this.setOptions(options);this.container=$(elementId);this.grid=this.container.getElement('ul[role=listbox]');this.activeElements=this.grid.getElements(this.activeElementsSelector);this.items=this.grid.getElements('li[role=option]');if(this.items.length===0){return false;}
if(this.options.collapse){this.grid.setStyle('height',this.getRowHeight()*this.options.minrows);this.isCollapse=true;}else{this.isCollapse=false;}
this.updateItems();if(this.options.button){this.button=this.container.getElement('.btngrille');this.button.addEvent('click',this.toggle.bind(this));this.button.addEvent('keydown',this.buttonKeydownEvent.bind(this));this.updateButton();var gridWidth=this.grid.getDimensions().width;var elemsPerRow=Math.floor(gridWidth/this.getItemWidth());var rows=Math.ceil(this.items.length/elemsPerRow);if(this.options.minrows>=rows){this.button.setStyle('visibility','hidden');}}
this.addItemEvents();this.grid.addEvent('keydown',this.grilleKeydownEvent.bind(this));},getRowHeight:function(){return this.grid.getElement('li').getDimensions().height;},getItemWidth:function(){return this.grid.getElement('li').getDimensions().width-1;},toggle:function(){if(this.grid.get('aria-busy')===null||this.grid.get('aria-busy')==='false'){this.grid.set('aria-busy','true');if(this.isCollapse){this.expandGrid();}else{this.collapseGrid();}}},updateButton:function(){if(this.isCollapse){this.button.set('title',this.options.expandTitle);this.button.removeClass('deplier');this.button.addClass('plier');}else{this.button.set('title',this.options.collapseTitle);this.button.removeClass('plier');this.button.addClass('deplier');}},animate:function(height){var myFx=new Fx.TweenBiblicnam(this.grid,{duration:this.options.animationDuration,threshold:this.options.threshold,transition:Fx.Transitions.Quad.easeInOut,property:'height',onComplete:this.animateComplete.bind(this)});myFx.start(this.grid.getDimensions().height,height);},animateComplete:function(){this.isCollapse=!this.isCollapse;this.updateButton();this.updateItems();this.grid.set('aria-busy','false');},collapseGrid:function(){this.animate(this.getRowHeight()*this.options.minrows);},expandGrid:function(){var gridWidth=this.grid.getDimensions().width;var elemsPerRow=Math.floor(gridWidth/this.getItemWidth());var items=this.grid.getElements('li');var maxHeight=this.getRowHeight()*Math.ceil(items.length/elemsPerRow);this.grid.getElements('li[role=option][aria-hidden=true]').set('aria-hidden',false);this.animate(maxHeight);},evalDataEvent:function(event){event.preventDefault();eval(this.get('data-event'));},isItemHidden:function(item){return item.get('aria-hidden')==='true';},isItemDisabled:function(item){return item.get('aria-disabled')==='true';},addItemEvents:function(){for(var i=0;i<this.items.length;i++){var item=this.items[i];var link=this.getLinkNavigable(item);if(link){var itemEventStr=link.get('data-event');if(itemEventStr!==null){link.addEvent('click',this.evalDataEvent);}}}},updateItems:function(){var items=this.grid.getElements('li[role=option]');for(var i=0;i<items.length;i++){var item=items[i];var link=this.getLinkNavigable(item);var relPosY=item.getPosition(this.grid).y;if(relPosY<this.grid.getDimensions().height){item.set('aria-hidden',false);}else{item.set('aria-hidden',true);}
if(link){link.set('tabindex',-1);}}
var firstVisible=this.grid.getFirst('li[aria-hidden=false]:not([aria-disabled=true]) .item-nl');if(firstVisible!==null){firstVisible.set('tabindex',0);}},buttonKeydownEvent:function(event){switch(event.key){case'space':case'enter':this.toggle();break;default:break;}},isLinkNavigable:function(element){var parent=element.getParent('li[role=option]');if(parent){return this.getLinkNavigable(parent)===element;}
return false;},getLinkNavigable:function(item){return item.getElement('.item-nl');},grilleKeydownEvent:function(event){var gridWidth=this.grid.getDimensions().width;var elemsPerRow=Math.floor(gridWidth/this.getItemWidth());var currentLink=event.target;var currentItem=currentLink.getParent('li[role=option]');if(this.isLinkNavigable(currentLink)){switch(event.key){case'space':event.preventDefault();$(currentLink).click();break;case'home':event.preventDefault();this.switchFocus(this.grid.getFirst(this.activeElementsSelector));break;case'end':event.preventDefault();var lastItem=this.grid.getLast(this.activeElementsSelector);this.switchFocus(lastItem);break;case'left':event.preventDefault();var currentIndex=this.activeElements.indexOf(currentLink);var targetIndex=currentIndex-1;if(targetIndex>=0){this.switchFocus(this.activeElements[targetIndex]);}
break;case'right':event.preventDefault();var currentIndex=this.activeElements.indexOf(currentLink);var targetIndex=currentIndex+1;if(targetIndex<this.activeElements.length){this.switchFocus(this.activeElements[targetIndex]);}
break;case'up':event.preventDefault();var currentIndex=this.items.indexOf(currentItem);var targetIndex=currentIndex-elemsPerRow;if(targetIndex>=0){var targetItem=this.items[targetIndex];var targetLink=this.getLinkNavigable(targetItem);if(this.isItemDisabled(targetItem)){targetLink=targetItem.getNext(this.activeElementsSelector);if(targetLink===currentLink){targetLink=targetItem.getPrevious(this.activeElementsSelector);}}
this.switchFocus(targetLink);}
break;case'down':event.preventDefault();var currentIndex=this.items.indexOf(currentItem);var targetIndex=currentIndex+elemsPerRow;if(targetIndex<this.items.length){var targetItem=this.items[targetIndex];var targetLink=this.getLinkNavigable(targetItem);if(this.isItemDisabled(targetItem)){targetLink=targetItem.getPrevious(this.activeElementsSelector);if(targetLink===currentLink){targetLink=targetItem.getNext(this.activeElementsSelector);}}
this.switchFocus(targetLink);}
break;default:break;}}else{if(event.key==='left'){event.preventDefault();var link=this.getLinkNavigable(currentItem);if(link){link.focus();}}}},switchFocus:function(targetLink){if(targetLink!==null){document.activeElement.set('tabindex',-1);targetLink.set('tabindex',0);if(this.isItemHidden(targetLink.getParent('li[role=option]'))){this.toggle();(function(){this.focus();}).delay(this.options.animationDuration,targetLink);}else{targetLink.focus();}}}});Grille.Banner=new Class({Extends:Grille,options:{previousBtnHtml:null,nextBtnHtml:null},previousBtn:null,nextBtn:null,isNavigable:false,containerWidth:null,liveUpdateInterval:500,intervalId:null,initialize:function(elementId,options){Grille.components[elementId]=this;this.setOptions(options);this.container=$(elementId);this.containerWidth=this.container.getDimensions().width;this.grid=this.container.getElement('ul[role=listbox]');this.activeElements=this.grid.getElements(this.activeElementsSelector);this.items=this.grid.getElements('li[role=option]');this.container.addClass('grille-banner');if(this.items.length===0){return false;}
var ulWidth=this.getItemWidth()*this.items.length;this.grid.setStyle('height',this.getRowHeight());this.grid.setStyle('width',ulWidth);if(this.container.getDimensions().width<ulWidth){this.addNavig();this.grid.setStyle('left',this.previousBtn.getDimensions().width);this.updateNavig();}
this.addItemEvents();if(this.liveUpdateInterval>0){this.intervalId=this.checkNavig.periodical(this.liveUpdateInterval,this);}},checkNavig:function(event){if(this.liveUpdateInterval>0&&this.container.getDimensions().width!==this.containerWidth){this.containerWidth=this.container.getDimensions().width;if(this.isNavigable){if(this.grid.getDimensions().width<=this.containerWidth){this.removeNavig();this.grid.setStyle('left',0);}else{this.updateNavig();}}else{if(this.grid.getDimensions().width>this.containerWidth){this.addNavig();this.updateNavig();}}}},removeNavig:function(){this.previousBtn.destroy();this.nextBtn.destroy();this.grid.getElements('li[aria-hidden])').set('aria-hidden',false);this.isNavigable=false;},destroy:function(){if(this.intervalId){clearInterval(this.intervalId);}
this.container.removeClass('grille-banner');this.grid.removeAttribute('style');this.grid.getElements("li a.item-nl").each(function(item){item.removeAttribute('tabindex');});this.removeNavig();},addNavig:function(){var self=this;if(this.isNavigable===false){this.previousBtn=new Element('div',{'class':'item-prec','role':'button','tabindex':0,html:this.options.previousBtnHtml});this.previousBtn.addEvent('click',function(){if(this.get('aria-disabled')==='false'){var previousPosition=self.computePreviousPosition();self.slideTo(previousPosition);}});this.previousBtn.addEvent('keydown',function(event){if(event.key==='enter'){this.fireEvent('click');}});this.previousBtn.inject(this.container,'top');this.nextBtn=new Element('div',{'class':'item-suiv','role':'button','tabindex':0,html:this.options.nextBtnHtml});this.nextBtn.addEvent('click',function(){if(this.get('aria-disabled')==='false'){var nextPosition=self.computeNextPosition();self.slideTo(nextPosition);}});this.nextBtn.addEvent('keydown',function(event){if(event.key==='enter'){this.fireEvent('click');}});this.nextBtn.inject(this.container);this.isNavigable=true;}
this.grid.setStyle('left',this.computeListPositionFor(this.grid.getElement('li')));this.updateNavig();},computeListPositionFor:function(item){var posRightLimit=this.container.getDimensions().width-this.nextBtn.getDimensions().width;var items=this.grid.getElements('li');var lastItem=items[items.length-1];if(this.isItemVisible(item)){return this.getListPosition();}
var newPosition=this.previousBtn.getDimensions().width+1-item.getPosition(this.grid).x;var newPositionLastItem=lastItem.getPosition(this.grid).x+newPosition;if(newPositionLastItem+lastItem.getDimensions().width<posRightLimit){newPosition=-(this.grid.getDimensions().width)+Math.floor(this.container.getDimensions().width)-
this.nextBtn.getDimensions().width-1;}
return newPosition;},isItemVisible:function(item){if(item===null){return true;}
var posLeftLimit=this.container.getPosition().x+this.previousBtn.getDimensions().width;var posRightLimit=this.container.getPosition().x+this.container.getDimensions().width-
this.nextBtn.getDimensions().width;return(item.getPosition().x>=posLeftLimit&&item.getPosition().x+
item.getDimensions().width<=posRightLimit);},computeNextPosition:function(){var lastVisible=this.grid.getLast('li[aria-hidden=false]');var nextHidden=lastVisible.getNext('li');return this.computeListPositionFor(nextHidden);},computePreviousPosition:function(){var item=this.grid.getFirst('li[aria-hidden=false]');if(item===null){return this.computeListPositionFor(this.grid.getLast('li'));}else{var viewportWidth=this.container.getDimensions().width-this.previousBtn.getDimensions().width-
this.nextBtn.getDimensions().width;var newPosition=this.getListPosition()+viewportWidth-(item.getPosition(this.container).x-
this.previousBtn.getDimensions().width);return(newPosition>this.previousBtn.getDimensions().width?this.previousBtn.getDimensions().width:newPosition);}},getItemWidth:function(){return this.grid.getElement('li').getDimensions().width;},updateNavig:function(){var items=this.grid.getElements('li');var nbPrev=0;var nbNext=0;var token=false;for(var i=0;i<items.length;i++){if(this.isItemVisible(items[i])){items[i].set('aria-hidden',false);token=true;}else{items[i].set('aria-hidden',true);if(token){nbNext++;}else{nbPrev++;}}}
this.updateIndicator(this.previousBtn,nbPrev);this.updateIndicator(this.nextBtn,nbNext);if(nbPrev===0){this.previousBtn.set('title','');this.previousBtn.set('aria-disabled',true);}else{this.previousBtn.set('title',Grille.getPreviousBtnTitle(nbPrev));this.previousBtn.set('aria-disabled',false);}
if(nbNext===0){this.nextBtn.set('title','');this.nextBtn.set('aria-disabled',true);}else{this.nextBtn.set('title',Grille.getNextBtnTitle(nbNext));this.nextBtn.set('aria-disabled',false);}
this.updateItems();this.container.set('aria-busy',false);},updateItems:function(){var items=this.grid.getElements('li[role=option]');for(var i=0;i<items.length;i++){var item=items[i];var link=this.getLinkNavigable(item);if(this.isItemVisible(item)){item.set('aria-hidden',false);if(link){link.set('tabindex',0);}}else{item.set('aria-hidden',true);if(link){link.set('tabindex',-1);}}}
var firstVisible=this.grid.getFirst('li[aria-hidden=false]:not([aria-disabled=true]) .item-nl');if(firstVisible!==null){firstVisible.set('tabindex',0);}},updateIndicator:function(button,num){if(button.getElement('sub')!==null){button.getElement('sub').set('text',num);}},getListPosition:function(){return this.grid.getPosition(this.container).x;},slideTo:function(position){if(this.container.get('aria-busy')==='false'){this.container.set('aria-busy',true);var myFx=new Fx.TweenBiblicnam(this.grid,{duration:this.options.animationDuration,threshold:this.options.threshold,transition:Fx.Transitions.Quad.easeInOut,property:'left',onComplete:this.updateNavig.bind(this)});myFx.start(this.getListPosition(),position);}}});Grille.extend({components:{},init:function(elementId,options){return new Grille(elementId,options);},initBanner:function(elementId,options){return new Grille.Banner(elementId,options);},getPreviousBtnTitle:function(num){return num+' item(s) pr\u00e9c\u00e9dents(s)';},getNextBtnTitle:function(num){return num+' item(s) suivant(s)';}});
var InterpageTag={};InterpageTag.initFocusableElements=function(conteneurInterpage){return conteneurInterpage.getElements('a[href],a[tabindex]');};InterpageTag.findNextFocusableElement=function(anchor){var conteneur=anchor.getParent('.navigation-interpage');var focusableElements=InterpageTag.initFocusableElements(conteneur);for(var i=1;i<focusableElements.length;i++){if(focusableElements[i-1]===anchor){return focusableElements[i];}}
if(focusableElements.length>0){return focusableElements[0];}};InterpageTag.findPreviousFocusableElement=function(anchor){var conteneur=anchor.getParent('.navigation-interpage');var focusableElements=InterpageTag.initFocusableElements(conteneur);for(var i=0;i<focusableElements.length-1;i++){if(focusableElements[i+1]===anchor){return focusableElements[i];}}
if(focusableElements.length>0){return focusableElements[focusableElements.length-1];}};InterpageTag.initKeyboardEvents=function(idConteneur){$(idConteneur).getElements('.navigation-interpage').each(function(interpage){var focusableElements=InterpageTag.initFocusableElements(interpage);for(var i=0;i<focusableElements.length;i++){focusableElements[i].addEvent('keydown',function(event){switch(event.key){case'right':InterpageTag.findNextFocusableElement(this).focus();break;case'left':InterpageTag.findPreviousFocusableElement(this).focus();break;case'space':window.location.href=this.href;break;default:break;}});if(!(focusableElements[i].hasClass('suivant')||focusableElements[i].hasClass('precedent')||focusableElements[i].hasClass('courant'))){focusableElements[i].set('tabindex',-1);}}});};var Interfiche=new Class({element:null,pagesize:null,current:null,items:null,interpage:null,position:null,showMonoPage:true,addEvents:function(){this.interpage.addEvent('click:relay(a)',this.mouseHandler.bind(this));this.interpage.addEvent('keydown',this.keyboardHandler.bind(this));},getPageSize:function(){return this.pagesize;},destroy:function(){var ol=this.interpage.getElement('.navigation-interpage');if(ol){ol.destroy();}},construct:function(){this.destroy();if(this.getLastPageNumber()>1||this.showMonoPage){var pagename=new Element('li',{id:this.element.id+'_pagename','class':'pagename',text:'Page'});ol=new Element('ol',{'class':'navigation-interpage','aria-labelledby':pagename.id});ol.grab(this.navItem(this.previousButton()));ol.grab(pagename);this.navList(ol);ol.grab(this.navItem(this.nextButton()));ol.inject(this.interpage);this.interpage.inject(this.element,this.position);}},mouseHandler:function(event,clicked){event.preventDefault();if(clicked.hasClass('precedent')){this.previous();}else if(clicked.hasClass('suivant')){this.next();}else{this.page(parseInt(clicked.get('text')));}},keyboardHandler:function(event){switch(event.key){case'space':event.stop();this.mouseHandler(event,event.target).bind(this);break;case'right':event.stop();InterpageTag.findNextFocusableElement(event.target).focus();break;case'left':event.stop();InterpageTag.findPreviousFocusableElement(event.target).focus();break;default:break;}},navItem:function(element){var li=new Element('li');return li.grab(element);},navPos:function(position){var pos=new Element('a',{'class':'page'});if(this.current===position){pos.addClass('courant');pos.set('title',position+': page courante');pos.set('tabindex',0);}else{pos.set('href','#');pos.set('tabindex',-1);}
pos.set('text',position);return this.navItem(pos);},navList:function(ol){var lastpage=this.getLastPageNumber();for(var i=1;i<=lastpage;i++){if(this.isPosDisplayed(i,lastpage)){ol.grab(this.navPos(i));switchEllipsis=true;}else if(i<lastpage){if(this.isPosDisplayed(i-1,lastpage)){var ellipsis=new Element('span',{html:'&hellip;'});if(this.isBigEllipsis()){ellipsis.addClass('dbl');}
ol.grab(this.navItem(ellipsis));}}}},isBigEllipsis:function(){var lastpage=this.getLastPageNumber();return((lastpage>5&&this.current>3)&&(lastpage-this.current<3))||((lastpage-this.current>2)&&(this.current<4));},isPosDisplayed:function(pPosition,pPositionFin){if(pPosition==1||pPosition==pPositionFin){return true;}
if(this.current<=2&&pPosition<5){return true;}else if(this.current>=pPositionFin-2){if(pPosition<pPositionFin-3){return false;}}else{if(pPosition<this.current-1||pPosition>this.current+1){return false;}}
return true;},previousButton:function(){if(this.current===1){return new Element('span',{'class':'precedentinactif'});}else{return new Element('a',{'class':'precedent',title:(this.current-1)+': page precedente',href:'#'});}},nextButton:function(){if(this.current===this.getLastPageNumber()){return new Element('span',{'class':'suivantinactif'});}else{return new Element('a',{'class':'suivant',title:(this.current+1)+': page suivante',href:'#'});}},next:function(){this.current++;this.construct();this.updateList();},previous:function(){this.current--;this.construct();this.updateList();},first:function(){this.current=1;this.construct();this.updateList();},page:function(page){this.current=page;this.construct();this.updateList();},last:function(){this.current=this.getLastPageNumber();this.construct();this.updateList();},getLastPageNumber:function(){var last=Math.ceil(this.items.length/this.getPageSize());if((this.items.length%this.getPageSize())===0){last++;}
return last;},updateList:function(){var max=this.current*this.getPageSize();var min=max-this.getPageSize();for(var i=0;i<this.items.length;i++){if(i>=min&&i<max){this.items[i].removeClass('invisible');}else{this.items[i].addClass('invisible');}}}});
Historique=new Class({Extends:Interfiche,position:'top',initialize:function(element,pagesize){this.element=element;this.pagesize=pagesize;this.items=this.element.getElements('.histo-list > li');this.interpage=new Element('div',{'class':'histo-interfiche',role:'navigation'});this.addEvents();this.first();},getLastPageNumber:function(){var last=Math.ceil(this.items.length/this.pagesize);if((this.items.length%this.pagesize)===0){last++;}
return last;},updateList:function(){var max=this.current*this.pagesize;var min=max-this.pagesize;for(var i=0;i<this.items.length;i++){if(i>=min&&i<max){this.items[i].removeClass('invisible');}else{this.items[i].addClass('invisible');}}}});
(function(){var nTips=0;this.lastTip={set:function(tip,element){this.tip=tip;this.element=element;},getTip:function(){return this.tip;},getElement:function(){return this.element;}};this.Tips=new Class({Implements:[Events,Options],options:{id:'tip',onShow:function(){this.tip.setStyle('visibility','visible');},onHide:function(){this.tip.setStyle('visibility','hidden');},title:'title',text:function(element){return element.get('rel')||element.get('href');},showDelay:100,hideDelay:100,className:'tip-wrap',offset:{x:16,y:16},windowPadding:{x:0,y:0},fixed:false,waiAria:true},handlerEsc:function(event){if(event.type==='keydown'&&event.key==='esc'){var tip=lastTip.getTip(),elem=lastTip.getElement();if(tip&&elem){tip.hide(elem);}}},initialize:function(){var params=Array.link(arguments,{options:Type.isObject,elements:function(obj){return obj!==null;}});this.setOptions(params.options);nTips=nTips+1;this.container=new Element('div.tip');if(this.options.id){this.options.id=this.options.id+nTips;this.container.set('id',this.options.id);}
if(params.elements){this.attach(params.elements);}
document.addEvent('keydown',this.handlerEsc);},toElement:function(){if(!this.tip){this.tip=new Element('div',{'class':this.options.className,styles:{position:'absolute',top:0,left:0}}).adopt(new Element('div',{'class':'tip-top'}),this.container,new Element('div',{'class':'tip-bottom'}));}
return this.tip;},attachWaiAria:function(){var id=this.options.id,tip=this.container;tip.set('role','tooltip');if(!this.waiAria){this.waiAria={show:function(element){tip.set('aria-hidden','false');},hide:function(element){tip.set('aria-hidden','true');}};}},detachWaiAria:function(element){if(this.waiAria){this.container.erase('role');this.container.erase('aria-hidden');element.erase('aria-describedby');}},read:function(option,element){if(option){if(typeOf(option)==='function'){return(option(element));}
return element.get(option);}
return'';},elementSearch:function(elements){if(typeOf(elements)==='element'){return[elements];}
if(typeOf(elements)==='elements'){return elements;}
return $$(elements);},attach:function(elements){this.elementSearch(elements).each(function(element){var title=this.read(this.options.title,element),text=this.read(this.options.text,element);if(!element.retrieve('tip:native')&&element.title){element.store('tip:native',element.title);element.erase('title');}
if(!element.retrieve('tip:text')){if(text&&text!==""){element.store('tip:text',text);}}
if(!element.retrieve('tip:title')){if(title&&title!==""){if(!element.retrieve('tip:text')){element.store('tip:text',title);}else{element.store('tip:title',title);}}}
this.fireEvent('attach',element);if(this.options.waiAria){if(this.options.id){element.set('aria-describedby',this.options.id);}
this.attachWaiAria(element);}
var events=['enter','leave'];if(!this.options.fixed){events.push('move');}
events.each(function(value){var handler=element.retrieve('tip:'+value);if(!handler){handler=function(event){this['element'+value.capitalize()].apply(this,[event,element]);}.bind(this);}
element.store('tip:'+value,handler);element.addEvent('mouse'+value,handler);if(value==='enter'){element.addEvent('focus',handler);}
if(value==='leave'){element.addEvent('blur',handler);}},this);},this);return this;},detach:function(elements){this.elementSearch(elements).each(function(element){['enter','leave','move'].each(function(value){var handler=element.retrieve('tip:'+value);element.removeEvent('mouse'+value,handler);if(value==='enter'){element.removeEvent('focus',handler);}
if(value==='leave'){element.removeEvent('blur',handler);}
element.eliminate('tip:'+value);});if(lastTip.getElement()===element){lastTip.set(null,null);}
this.fireEvent('detach',[element]);if(this.waiAria){element.erase('aria-describedby');this.detachWaiAria(element);}
var original=element.retrieve('tip:native');if(original&&original!==''){element.set('title',original);}
element.eliminate('tip:native');element.eliminate('tip:text');element.eliminate('tip:title');},this);return this;},elementEnter:function(event,element){this.container.empty();['title','text'].each(function(value){var content=element.retrieve('tip:'+value),div;if(content){div=new Element('div',{'class':'tip-'+value}).inject(this.container);this.fill(div,content);}},this);this.position((this.options.fixed||event.type==='focus')?{page:element.getPosition()}:event);clearTimeout(this.timerEnter);this.timerEnter=(function(){this.show(element);}).delay(this.options.showDelay,this);var lastElem=lastTip.getElement();if(lastElem&&lastElem!==element){lastTip.getTip().hide(lastElem);}
lastTip.set(this,element);},elementLeave:function(event,element){clearTimeout(this.timerLeave);this.timerLeave=(function(){this.hide(element);}).delay(this.options.hideDelay,this);this.fireForParent(event,element);},setTitle:function(element,title){if(title&&title!==""){element.store('tip:title',title);}else{element.eliminate('tip:title');}
return this;},setText:function(element,text){if(text&&text!==""){element.store('tip:text',text);}else{element.eliminate('tip:text');}
return this;},fireForParent:function(event,element){if(event.type==='mouseleave'){element=element.getParent();if(!element||element===document.body){return;}
if(element.retrieve('tip:enter')){element.fireEvent('mouseenter',event);}else{this.fireForParent(event,element);}}},elementMove:function(event,element){this.position(event);},position:function(event){if(!this.tip){document.id(this);}
var size=window.getSize(),scroll=window.getScroll(),tip={x:this.tip.offsetWidth,y:this.tip.offsetHeight},props={x:'left',y:'top'},bounds={y:false,x2:false,y2:false,x:false},obj={},z;for(z in props){obj[props[z]]=event.page[z]+this.options.offset[z];bounds[z]=(obj[props[z]]<0);if((obj[props[z]]+tip[z]-scroll[z])>size[z]-this.options.windowPadding[z]){obj[props[z]]=event.page[z]-this.options.offset[z]-tip[z];bounds[z+'2']=true;}}
this.fireEvent('bound',bounds);this.tip.setStyles(obj);},fill:function(element,contents){if(typeof contents==='string'){element.set('html',contents);}else{element.adopt(contents);}},show:function(element){if(!this.tip){document.id(this);}
if(!this.tip.getParent()){this.tip.inject(document.body);}
this.fireEvent('show',[this.tip,element]);if(this.waiAria){this.waiAria.show(element);}},hide:function(element){if(!this.tip){document.id(this);}
this.fireEvent('hide',[this.tip,element]);if(this.waiAria){this.waiAria.hide(element);}}});})();var Infobulle={create:function(element,separator){var title=element.get('title'),titre="",texte="",tabTitle=[];if(typeOf(title)!=='null'){texte=title;if(typeOf(separator)!=='null'){tabTitle=title.split(separator);if(tabTitle.length>1){titre=tabTitle[0];texte=title.substring(tabTitle[0].length+separator.length);}}
this.tip.attach(element);this.tip.setTitle(element,titre);this.tip.setText(element,texte);}},createHtml:function(element,elementHtml){var titre="";var texte="";elementHtml.getElements('.info-titre').each(function(el){titre+=el.get('html');});elementHtml.getElements('.info-contenu').each(function(el){texte+=el.get('html');});this.tip.attach(element);this.tip.setTitle(element,titre);this.tip.setText(element,texte);},init:function(elements,elementOrSeparator){this.tip=this.tip||new Tips();if(typeOf(elementOrSeparator)==='string'||typeOf(elementOrSeparator)==='null'){if(typeOf(elements)==='element'){this.create(elements,elementOrSeparator);}else{$$(elements).each(function(element){this.create(element,elementOrSeparator);},this);}}else if(typeOf(elementOrSeparator)==='element'){if(typeOf(elements)==='element'){this.createHtml(elements,elementOrSeparator);}else{$$(elements).each(function(element){this.createHtml(element,elementOrSeparator);},this);}}}};
var InterApplicationTag={};InterApplicationTag.conteneur="liens-interapplication";InterApplicationTag.zlPlaceholder="Changer d'application\u2026";InterApplicationTag.zlCssClass="ia-list";InterApplicationTag.lienMaxWidth=0;InterApplicationTag.listMaxHeight=190;InterApplicationTag.mouseOnContainer=false;InterApplicationTag.bandeauWidth=270;InterApplicationTag.afficheListe=function(){$(InterApplicationTag.conteneur).getElement('ul').setStyle('display','block');$(InterApplicationTag.conteneur).getElement('.ia-select-btn').setStyle('visibility','hidden');};InterApplicationTag.masqueListe=function(){$(InterApplicationTag.conteneur).getElement('ul').setStyle('display','none');$(InterApplicationTag.conteneur).getElement('.ia-select-btn').setStyle('visibility','visible');};InterApplicationTag.toggleListe=function(){if($(InterApplicationTag.conteneur).getElement('ul').getStyle('display')==='none'){InterApplicationTag.afficheListe();}else{InterApplicationTag.masqueListe();}};InterApplicationTag.setListeMaxHeight=function(height){if($(InterApplicationTag.conteneur).getElement('ul').getSize().y>height){$(InterApplicationTag.conteneur).getElement('ul').setStyle('height',height);}};InterApplicationTag.initLienMaxWidth=function(){var liens=$(InterApplicationTag.conteneur).getElements('ul li a');InterApplicationTag.lienMaxWidth=0;for(i=0;i<liens.length;i++){if(liens[i].getSize().x>InterApplicationTag.lienMaxWidth){InterApplicationTag.lienMaxWidth=liens[i].getSize().x;}}};InterApplicationTag.listeClearHightLight=function(){var conteneur=$(InterApplicationTag.conteneur);if(conteneur.getElement('.hightlight')){conteneur.getElement('.hightlight').removeClass('hightlight');}};InterApplicationTag.listeHightLightItem=function(item){item.addClass('hightlight');};InterApplicationTag.listePreviousKey=function(){var conteneur=$(InterApplicationTag.conteneur);var items=conteneur.getElements('.ia-select-dropdown a');var previousLink=items[items.length-1];for(i=items.length-1;i>0;i--){if(items[i].hasClass('hightlight')){previousLink=items[i-1];break;}}
InterApplicationTag.listeClearHightLight();InterApplicationTag.listeHightLightItem(previousLink);var posCourant=previousLink.getPosition(conteneur.getElement('.ia-select-dropdown')).y;var heightCourant=previousLink.getCoordinates().height;if(posCourant<0){conteneur.getElement('.ia-select-dropdown ul').scrollTo(0,conteneur.getElement('.ia-select-dropdown ul').getScroll().y-heightCourant-2);}else if(posCourant+heightCourant>conteneur.getElement('.ia-select-dropdown').getCoordinates().height){conteneur.getElement('.ia-select-dropdown ul').scrollTo(0,posCourant+2);}};InterApplicationTag.listeNextKey=function(){var conteneur=$(InterApplicationTag.conteneur);var items=conteneur.getElements('.ia-select-dropdown a');var nextLink=items[0];for(i=0;i<items.length-1;i++){if(items[i].hasClass('hightlight')){nextLink=items[i+1];break;}}
InterApplicationTag.listeClearHightLight();InterApplicationTag.listeHightLightItem(nextLink);var posCourant=nextLink.getPosition(conteneur.getElement('.ia-select-dropdown')).y;var heightCourant=nextLink.getCoordinates().height;if(posCourant+heightCourant>conteneur.getElement('.ia-select-dropdown').getCoordinates().height){conteneur.getElement('.ia-select-dropdown ul').scrollTo(0,conteneur.getElement('.ia-select-dropdown ul').getScroll().y+heightCourant+2);}else if(posCourant<0){conteneur.getElement('.ia-select-dropdown ul').scrollTo(0,posCourant);}};InterApplicationTag.test_active_click=function(evt){if(evt.target.getParents('#'+InterApplicationTag.conteneur).length){}else{InterApplicationTag.masqueListe();InterApplicationTag.listeClearHightLight();}};InterApplicationTag.listeDeroulanteEvents=function(){var zoneListeConteneur=$(InterApplicationTag.conteneur).getElement('.ia-select');var liensDropdown=$(InterApplicationTag.conteneur).getElement('.ia-select-dropdown');zoneListeConteneur.addEvent('click',function(event){event.preventDefault();InterApplicationTag.toggleListe();InterApplicationTag.listeNextKey();if(Browser.ie6||Browser.ie7){InterApplicationTag.setListeMaxHeight(InterApplicationTag.listMaxHeight);}
this.focus();});zoneListeConteneur.addEvent('blur',function(){if(!InterApplicationTag.mouseOnContainer){InterApplicationTag.masqueListe();InterApplicationTag.listeClearHightLight();}});liensDropdown.addEvent('mouseenter',function(event){InterApplicationTag.mouseOnContainer=true;});liensDropdown.addEvent('mouseleave',function(event){InterApplicationTag.mouseOnContainer=false;});zoneListeConteneur.addEvent('keydown',function(event){switch(event.key){case'down':event.preventDefault();InterApplicationTag.afficheListe();InterApplicationTag.listeNextKey();break;case'up':event.preventDefault();InterApplicationTag.listePreviousKey();break;default:break;}});var liens=liensDropdown.getElements('ul a');for(i=0;i<liens.length;i++){liens[i].addEvent('mouseover',function(event){InterApplicationTag.listeClearHightLight();InterApplicationTag.listeHightLightItem(this);});}
document.addEvent('click',InterApplicationTag.test_active_click);};InterApplicationTag.listeDeroulante=function(){InterApplicationTag.initLienMaxWidth();$(InterApplicationTag.conteneur).erase('class');$(InterApplicationTag.conteneur).set('class',InterApplicationTag.zlCssClass);var zoneListe=new Element('span');var btn=new Element('span');var btnContent=new Element('b');var zoneListeConteneur=new Element('a');zoneListe.set('text',InterApplicationTag.zlPlaceholder);btn.set('class','ia-select-btn');btnContent.inject(btn);zoneListeConteneur.set('class','ia-select');zoneListeConteneur.set('href','#');zoneListe.inject(zoneListeConteneur);btn.inject(zoneListeConteneur);zoneListeConteneur.inject($(InterApplicationTag.conteneur));var liensDropdown=new Element('div');liensDropdown.set('class','ia-select-dropdown');$(InterApplicationTag.conteneur).getElement('ul').inject(liensDropdown);liensDropdown.inject($(InterApplicationTag.conteneur));var zlWidth=0;var placeholderWidth=$(InterApplicationTag.conteneur).getElement('.ia-select span').getSize().x-2;if(InterApplicationTag.lienMaxWidth+12>placeholderWidth){zlWidth=InterApplicationTag.lienMaxWidth+12;}else{zlWidth=placeholderWidth;}
if((zlWidth>300)||(zlWidth<=0)){zlWidth=300;}
liensDropdown.setStyle('width',zlWidth+24);$(InterApplicationTag.conteneur).getElement('.ia-select').setStyle('width',zlWidth);InterApplicationTag.masqueListe();$(InterApplicationTag.conteneur).setStyle('visibility','visible');InterApplicationTag.listeDeroulanteEvents();};InterApplicationTag.initBandeauTabIndex=function(){var liensImage=$(InterApplicationTag.conteneur).getElements('ul a');for(i=0;i<liensImage.length;i++){if(i<6){liensImage[i].set('tabindex','0');}else{liensImage[i].set('tabindex','-1');}}};InterApplicationTag.bandeauPreviousKey=function(lien){var conteneur=$(InterApplicationTag.conteneur);var items=conteneur.getElements('a[tabindex=0]');var previousLink=items[items.length-1];for(i=items.length-1;i>0;i--){if(items[i]===lien){previousLink=items[i-1];break;}}
previousLink.focus();};InterApplicationTag.bandeauNextKey=function(lien){var conteneur=$(InterApplicationTag.conteneur);var items=conteneur.getElements('a[tabindex=0]');var nextLink=items[0];for(i=0;i<items.length-1;i++){if(items[i]===lien){nextLink=items[i+1];break;}}
nextLink.focus();};InterApplicationTag.bandeauKeyEvents=function(event){switch(event.key){case'space':event.preventDefault();this.fireEvent('click');break;case'right':InterApplicationTag.bandeauNextKey(this);break;case'left':InterApplicationTag.bandeauPreviousKey(this);break;default:break;}};InterApplicationTag.bandeau=function(){var imgList=$(InterApplicationTag.conteneur).getElements('ul li');var imgListSize=imgList.length;if(imgListSize>5){$(InterApplicationTag.conteneur).setStyle('width',InterApplicationTag.bandeauWidth);$(InterApplicationTag.conteneur).getElement('ul').setStyle('width',InterApplicationTag.bandeauWidth*2);}
InterApplicationTag.initBandeauTabIndex();if(imgListSize>6){var btnSuivant=new Element('img');btnSuivant.set('src','biblicnam/images/entete/picto_bandeau_r_bleu.gif');var lienBtnSuivant=new Element('a');lienBtnSuivant.setAttribute('href','#');lienBtnSuivant.set('id','bandeau-suivant');lienBtnSuivant.set('tabindex','0');btnSuivant.inject(lienBtnSuivant);lienBtnSuivant.inject($(InterApplicationTag.conteneur));lienBtnSuivant.addEvent("click",function(event){event.preventDefault();var imgList=$(InterApplicationTag.conteneur).getElements('ul li');var imgListSize=imgList.length;if((imgListSize>6)&&(imgListSize<12)){for(i=0;i<imgListSize;i++){var liCopie=imgList[i].clone();var lienCopie=liCopie.getElement('a');lienCopie.set('id','ia-autogenerated'+i);lienCopie.cloneEvents(imgList[i].getElement('a'));liCopie.inject($(InterApplicationTag.conteneur).getElement('ul'),'bottom');}}
var myFx=new Fx.Tween($(InterApplicationTag.conteneur).getElement('ul'),{duration:2000,transition:Fx.Transitions.Quad.easeInOut,property:'left',onComplete:function(){for(i=0;i<6;i++){$(InterApplicationTag.conteneur).getElement('ul li').inject($(InterApplicationTag.conteneur).getElement('ul'),'bottom');}
$(InterApplicationTag.conteneur).getElement('ul').setStyle('left',0);InterApplicationTag.initBandeauTabIndex();}});myFx.start(0,-270);});}
var liens=$(InterApplicationTag.conteneur).getElements('a');for(i=0;i<liens.length;i++){liens[i].addEvent('keydown',InterApplicationTag.bandeauKeyEvents.bind(liens[i]));}
$(InterApplicationTag.conteneur).setStyle('visibility','visible');};
OngletTag=new Class({element:null,initialize:function(element){this.element=element;this.element.navigChildsSelector='li > a:not([aria-disabled=true])';ListNavig.initEvents(this.element);}});OngletTag.extend({components:{},waitMessage:'<p>Chargement en cours\u2026</p>',errorMessage:'Erreur lors du chargement des données',init:function(element){this.components[element.id]=new OngletTag(element);},loadContent:function(onglet,contentContainer,params){contentContainer.set('aria-busy',true);this.select(onglet);contentContainer.set('aria-labelledby',onglet.id);contentContainer.set('html',OngletTag.waitMessage);contentContainer.set('load',{method:'post',async:true,data:params,onFailure:function(){contentContainer.set('text',OngletTag.errorMessage);},onError:function(){contentContainer.set('text',OngletTag.errorMessage);}});contentContainer.load(onglet.get('data-href'));contentContainer.set('aria-busy',false);},select:function(onglet){var onglets=onglet.getParent('.onglets');var previousCurrent=onglets.getElement('a[aria-selected=true]');if(previousCurrent){previousCurrent.set('aria-selected',false);previousCurrent.set('tabindex',-1);if(previousCurrent.get('data-href')){previousCurrent.href=previousCurrent.get('data-href');previousCurrent.erase('data-href');}
onglet.set('aria-selected',true);onglet.set('tabindex',0);onglet.set('data-href',onglet.href);onglet.erase('href');}}});
DossierTag=new Class({Implements:[Options],element:null,initialize:function(element){this.element=element;this.element.navigChildsSelector='li > a:not([aria-disabled=true])';ListNavig.initEvents(this.element);this.addDeleteEvents();},addDeleteEvents:function(){var self=this;this.element.getElements('.deletable').each(function(lien){var supprButton=new Element('div',{'class':'delete-btn','role':'button','tabindex':-1});supprButton.inject(lien,'after');lien.addEvent('delete',lien.remove=DossierTag.remove.bind(lien),200);supprButton.addEvent('click',function(event){this.fireEvent('delete',event);}.bind(lien));lien.addEvent('keydown',function(event){if(event.key==='delete'){this.fireEvent('delete',event);}}.bind(lien));});},removeContainer:function(){this.element.destroy();}});DossierTag.Navigable=new Class({Extends:DossierTag,animationDuration:2000,threshold:300,container:null,previousBtn:null,nextBtn:null,listDossier:null,containerWidth:null,isNavigable:false,liveUpdateInterval:500,options:{previousBtnHtml:null,nextBtnHtml:null},initialize:function(element,options){this.element=element;this.setOptions(options);this.container=this.element.getParent('.dossiers-navig');this.containerWidth=this.container.getDimensions().width;this.listDossier=this.container.getElement('ul');this.updateListWidth();if(this.element.getDimensions().width>this.container.getDimensions().width){this.addNavig();this.element.setStyle('left',this.previousBtn.getDimensions().width);this.element.setStyle('left',this.computeListPositionFor(this.getCurrent()));this.updateNavig();this.element.navigChildsSelector='li > a[aria-hidden=false]:not([aria-disabled=true])';}else{this.element.setStyle('left',0);this.element.navigChildsSelector='li > a:not([aria-disabled=true])';}
if(this.liveUpdateInterval>0){this.checkNavig.periodical(this.liveUpdateInterval,this);}
this.addDeleteEvents();this.container.setStyle('visibility','visible');},checkNavig:function(event){if(this.liveUpdateInterval>0){if(this.container.getDimensions().width!==this.containerWidth||event==='delete'){this.containerWidth=this.container.getDimensions().width;if(this.isNavigable){if(this.element.getDimensions().width<=this.containerWidth){this.removeNavig();this.element.setStyle('left',0);}else{var elem=this.container.getElement('a[aria-selected=true]');if(elem!==null){var current=elem.getParent('li');this.element.setStyle('left',this.computeListPositionFor(current));}
this.updateNavig();}}else{if(this.element.getDimensions().width>this.containerWidth){this.addNavig();this.element.setStyle('left',this.computeListPositionFor(this.getCurrent()));this.updateNavig();}}}else{var focusedElement=this.container.getElement(document.activeElement);if(focusedElement===null&&this.isNavigable){var elem=this.container.getElement('a[aria-selected=true]');if(elem!==null){var current=elem.getParent('li');if(!this.isDossierVisible(current)){this.element.setStyle('left',this.computeListPositionFor(current));this.updateNavig();}}}}}},removeNavig:function(){this.previousBtn.destroy();this.nextBtn.destroy();this.element.getElements('li a[aria-hidden])').set('aria-hidden',false);this.manageTabindex();this.isNavigable=false;},removeContainer:function(){this.element.destroy();this.container.destroy();},addNavig:function(){var self=this;if(this.isNavigable===false){this.previousBtn=new Element('div',{'class':'dossier-prec','role':'button','tabindex':0,html:this.options.previousBtnHtml});this.previousBtn.addEvent('click',function(){if(this.get('aria-disabled')==='false'){var previousPosition=self.computePreviousPosition();self.slideTo(previousPosition);}});this.previousBtn.addEvent('keydown',function(event){if(event.key==='enter'){this.fireEvent('click');}});this.previousBtn.inject(this.container,'top');this.nextBtn=new Element('div',{'class':'dossier-suiv','role':'button','tabindex':0,html:this.options.nextBtnHtml});this.nextBtn.addEvent('click',function(){if(this.get('aria-disabled')==='false'){var nextPosition=self.computeNextPosition();self.slideTo(nextPosition);}});this.nextBtn.addEvent('keydown',function(event){if(event.key==='enter'){this.fireEvent('click');}});this.nextBtn.inject(this.container);this.isNavigable=true;}
this.element.setStyle('left',this.computeListPositionFor(this.getCurrent()));this.updateNavig();},updateListWidth:function(){var dossiers=this.element.getElements('li');var width=0;for(var i=0;i<dossiers.length;i++){width+=dossiers[i].getComputedSize({styles:['padding','border','margin']}).totalWidth;}
this.element.setStyle('width',width);},isDossierVisible:function(dossier){if(dossier==null){return true;}
var posLeftLimit=this.container.getPosition().x+this.previousBtn.getDimensions().width;var posRightLimit=this.container.getPosition().x+this.container.getDimensions().width-
this.nextBtn.getDimensions().width;return(dossier.getPosition().x>=posLeftLimit&&dossier.getPosition().x+
dossier.getDimensions().width<posRightLimit);},updateNavig:function(){var dossiers=this.element.getElements('li');var nbPrev=0;var nbNext=0;var token=false;for(var i=0;i<dossiers.length;i++){if(this.isDossierVisible(dossiers[i])){dossiers[i].getElement('a').set('aria-hidden',false);token=true;}else{dossiers[i].getElement('a').set('aria-hidden',true);if(token){nbNext++;}else{nbPrev++;}}}
this.updateIndicator(this.previousBtn,nbPrev);this.updateIndicator(this.nextBtn,nbNext);if(nbPrev===0){this.previousBtn.set('title','');this.previousBtn.set('aria-disabled',true);}else{this.previousBtn.set('title',nbPrev+' dossier(s) pr\u00e9c\u00e9dents(s)');this.previousBtn.set('aria-disabled',false);}
if(nbNext===0){this.nextBtn.set('title','');this.nextBtn.set('aria-disabled',true);}else{this.nextBtn.set('title',nbNext+' dossier(s) suivant(s)');this.nextBtn.set('aria-disabled',false);}
this.manageTabindex();this.container.set('aria-busy',false);},manageTabindex:function(){this.element.getElements('li a[aria-hidden])').each(function(lien){if(lien.get('aria-hidden')==='true'||lien.get('aria-disabled')==='true'){lien.set('tabindex',-1);}else{lien.set('tabindex',0);}});},updateIndicator:function(button,num){if(button.getElement('sub')!==null){button.getElement('sub').set('text',num);}},getListPosition:function(){return this.element.getPosition(this.container).x;},getCurrent:function(){var elem=this.element.getElement('li a[aria-selected=true]');return(elem)?elem.getParent('li'):null;},computeListPositionFor:function(dossier){var posRightLimit=this.container.getDimensions().width-this.nextBtn.getDimensions().width;var dossiers=this.element.getElements('li');var lastDossier=dossiers[dossiers.length-1];if(this.isDossierVisible(dossier)){return this.getListPosition();}
var newPosition=this.previousBtn.getDimensions().width-dossier.getPosition(this.element).x;var newPositionLastDossier=lastDossier.getPosition(this.element).x+newPosition;if(newPositionLastDossier+lastDossier.getDimensions().width<posRightLimit){newPosition=-(this.element.getDimensions().width)+this.container.getDimensions().width-
this.nextBtn.getDimensions().width;}
return newPosition;},computeNextPosition:function(){var lastVisible=this.element.getLast('li a[aria-hidden=false]').getParent('li');var nextHidden=lastVisible.getNext('li');return this.computeListPositionFor(nextHidden);},computePreviousPosition:function(){var item=this.element.getFirst('li a[aria-hidden=false]');if(item===null){return this.computeListPositionFor(this.element.getLast('li a').getParent('li'));}else{var firstVisible=item.getParent('li');var viewportWidth=this.container.getDimensions().width-this.previousBtn.getDimensions().width-
this.nextBtn.getDimensions().width;var newPosition=this.getListPosition()+viewportWidth-(firstVisible.getPosition(this.container).x-
this.previousBtn.getDimensions().width);return(newPosition>this.previousBtn.getDimensions().width?this.previousBtn.getDimensions().width:newPosition);}},slideTo:function(position){if(this.container.get('aria-busy')==='false'){this.container.set('aria-busy',true);var myFx=new Fx.TweenBiblicnam(this.element,{duration:this.animationDuration,threshold:this.threshold,transition:Fx.Transitions.Quad.easeInOut,property:'left',onComplete:this.updateNavig.bind(this)});myFx.start(this.getListPosition(),position);}}});DossierTag.extend({components:{},waitMessage:'<p>Chargement en cours\u2026</p>',errorMessage:'Erreur lors du chargement des données',init:function(element,options){if(element.getParent('.dossiers-navig')===null){this.components[element.id]=new DossierTag(element);}else{this.components[element.id]=new DossierTag.Navigable(element,options);}},loadContent:function(dossier,contentContainer){contentContainer.set('aria-busy',true);this.select(dossier);contentContainer.set('aria-labelledby',dossier.id);contentContainer.set('html',DossierTag.waitMessage);contentContainer.set('load',{method:'post',async:true,data:'dossierChoisi='+dossier.id,onFailure:function(){contentContainer.set('text',DossierTag.errorMessage);},onError:function(){contentContainer.set('text',DossierTag.errorMessage);}});contentContainer.load(dossier.get('data-href'));contentContainer.set('aria-busy',false);},select:function(dossier){var dossiers=dossier.getParent('.dossiers');var previousCurrent=dossiers.getElement('a[aria-selected=true]');if(previousCurrent){previousCurrent.set('aria-selected',false);previousCurrent.set('tabindex',-1);if(previousCurrent.get('data-href')){previousCurrent.href=previousCurrent.get('data-href');previousCurrent.erase('data-href');}}
dossier.set('aria-selected',true);dossier.set('tabindex',0);dossier.set('data-href',dossier.href);dossier.erase('href');},remove:function(){var component=DossierTag.components[this.getParent('ul').id];this.getParent('li').destroy();if(instanceOf(component,DossierTag.Navigable)){component.updateListWidth();component.checkNavig('delete');}
if(component.element.getElements('li').length===0){component.removeContainer();}}});
var Progression=new Class({Implements:[Options],options:{timeout:2000,delay:2000,errorMessage:null,callback:null},element:null,url:null,isError:false,isGlobalError:false,isComplete:false,isRunning:false,isRequestRunning:false,periodicalFunctionId:null,initialize:function(element,url,options){this.setOptions(options);this.element=element;this.url=url;this.start();},start:function(){this.element.removeClass('invisible');this.isRunning=true;this.checkFunction();this.periodicalFunctionId=this.checkFunction.periodical(this.options.delay,this);},stop:function(){clearInterval(this.periodicalFunctionId);this.isRunning=false;if(this.options.callback!==null){window[this.options.callback].bind(this)();}},checkFunction:function(){if(!this.isRequestRunning){var request=new Request.JSON({url:this.url,async:true,timeout:this.options.timeout,onSuccess:function(data){this.isRequestRunning=false;if(!this.isGlobalError){this.element.set('html','');this.formatData(data).inject(this.element);if(this.isComplete){this.stop();}}}.bind(this),onTimeout:function(){this.isGlobalError=true;this.showGlobalError();this.stop();}.bind(this),onError:function(){this.isGlobalError=true;this.showGlobalError();this.stop();}.bind(this),onFailure:function(){this.isGlobalError=true;this.showGlobalError();this.stop();}.bind(this)});this.isRequestRunning=true;request.send();}},showGlobalError:function(){var error=new Element('p',{'class':'zone-alerte'});error.set('text',this.options.errorMessage||Progression.errorMessage);error.inject(this.element);var items=this.element.getElement('ul');if(items!=null){items.addClass('global-error');}},formatData:function(data){var ul=new Element('ul');this.isComplete=true;for(var i=0;i<data.length;i++){this.formatItem(data[i]).inject(ul);}
return ul;},formatItem:function(bean){var li=new Element('li',{'class':'incomplete'});if(bean.value>=100){li.className='complete';}
var label=new Element('span',{text:bean.text});if(bean.value<100&&bean.error===undefined){this.isComplete=false;}
label.inject(li);if(bean.error!==undefined){li.className='error';this.isError=true;var errorMessage=new Element('span',{'class':'errormessage',text:bean.error});errorMessage.inject(li);}
return li;}});Progression.Barre=new Class({Extends:Progression,initialize:function(element,url,options){this.parent(element,url,options);},progressNativeSupport:function(){if('position'in document.createElement('progress')){return true;}
return false;},formatItem:function(bean){var li=new Element('li');var progress;if(this.progressNativeSupport()){progress=new Element('progress',{max:100});progress.set('value',bean.value);li.set('title',bean.value+'%');}else{progress=new Element('div',{'class':'progress'});var pbar=new Element('div',{'class':'pbar'});pbar.setStyle('width',bean.value+'%');pbar.inject(progress);}
li.set('title',bean.value+'%');var label=new Element('span',{text:bean.text});if(bean.value<100&&bean.error===undefined){this.isComplete=false;}
progress.inject(li);label.inject(li);if(bean.error!==undefined){this.isError=true;var errorMessage=new Element('span',{'class':'errormessage',text:bean.error});errorMessage.inject(li);}
return li;}});Progression.extend({components:{},errorMessage:'Une erreur est survenue lors de communication avec le serveur',init:function(element,url,options){if(element.hasClass('barre')){this.components[element.id]=new Progression.Barre(element,url,options);}else{this.components[element.id]=new Progression(element,url,options);}}});
var TexteTag={erreurChamp:function(champ,messageErreur){var container=$(champ.id).getParent('.zone_texte');var bTagErreur=$(champ.id).getParent('b');if(!bTagErreur){bTagErreur=new Element('b');$(champ.id).inject(bTagErreur);container.addClass('erreur_champ');bTagErreur.inject(container,'top');}
$(champ.id).setProperty('aria-invalid','true');if($(champ.id+ChampTag.suffixIdErr)!==null){$(champ.id+ChampTag.suffixIdErr).innerHTML=messageErreur;$(champ.id+ChampTag.suffixIdErr).style.display="inline-block";}},champOK:function(champ){var container=$(champ.id).getParent('.zone_texte');var bTagErreur=$(champ.id).getParent('b');if(bTagErreur){$(champ.id).inject(container,'top');bTagErreur.destroy();}
$(champ.id).removeProperty('aria-invalid');container.removeClass('erreur_champ');if($(champ.id+ChampTag.suffixIdErr)!==null){$(champ.id+ChampTag.suffixIdErr).style.display="none";$(champ.id+ChampTag.suffixIdErr).innerHTML="";}},effacerFormulaire:function(formid){ChampTag.getForm(formid).getElements('.zone_texte textarea').each(function(champ){TexteTag.champOK(champ);champ.value='';});TexteTag.majCompteurs(formid);return true;},majCompteurs:function(formid){ChampTag.getForm(formid).getElements('.zone_texte textarea').each(function(champ){if($(champ).textChars){$(champ).textChars.updateText();}
if($(champ).textRows){$(champ).textRows.updateText();}});return true;}};var TextUtil=new Class({isOnInputSupported:function(elem){return'oninput'in document.createElement(elem.type);},isOnPropertyChangeSupported:function(elem){return'onpropertychange'in document.createElement(elem.type);},isOnPasteSupported:function(elem){return'onpaste'in document.createElement(elem.type);},isOnDropSupported:function(elem){return'ondrop'in document.createElement(elem.type);},getSelection:function(elem){var s={start:0,end:0};if(document.activeElement!==elem){elem.focus();}
if(typeof elem.selectionStart==="number"&&typeof elem.selectionEnd==="number"){s.start=elem.selectionStart;s.end=elem.selectionEnd;}else if(document.selection){var bookmark=document.selection.createRange().getBookmark();var sel=elem.createTextRange();var bfr=sel.duplicate();sel.moveToBookmark(bookmark);bfr.setEndPoint("EndToStart",sel);s.start=bfr.text.length;s.end=s.start+sel.text.length;}
return s;},offsetToRangeCharacterMove:function(el,offset){return offset-(el.value.slice(0,offset).split("\r\n").length-1);},setSelection:function(elem,start,end){var range=elem.createTextRange();var startCharMove=this.offsetToRangeCharacterMove(elem,start);range.collapse(true);if(start===end){range.move("character",startCharMove);}else{range.moveEnd("character",this.offsetToRangeCharacterMove(elem,end));range.moveStart("character",startCharMove);}
range.select();},inputEvent:function(elem,fnEvent){if(this.isOnInputSupported(elem)){elem.addEvent('input',fnEvent);}else if(this.isOnPropertyChangeSupported(elem)){elem.addEvent('propertychange',fnEvent);}}});var TextMaxlength=new Class({Extends:TextUtil,initialize:function(element){this.element=element;var max=parseInt(element.getProperty("maxlength"));this.maxlength=(isNaN(max))?0:max;this.lastValue=element.value;this.data={value:"",type:""};if(this.maxlength>0&&!this.isMaxlengthSupported(element)){this.element.maxlength=this.maxlength;element.addEvent('keypress',this.maxlengthKeypress.bind(this));if(this.isOnPasteSupported(element)){element.addEvent('paste',this.maxlengthPaste.bind(this));}
if(this.isOnDropSupported(element)){if(element.attachEvent&&!element.addEventListener){element.addEvent('focus',this.maxlengthEvent.bind(this));}else{element.addEventListener("drop",this.maxlengthEvent.bind(this),false);}}
this.inputEvent(element,this.maxlengthEvent.bind(this));}},isMaxlengthSupported:function(elem){if(elem.type==='textarea'){return('maxLength'in document.createElement(elem.type))&&(Browser.name!=='ie'||Browser.version>9);}else{return'maxLength'in document.createElement(elem.type);}},setData:function(value,type){this.data.value=value;this.data.type=type;},maxlengthKeypress:function(event){var elem=event.target;if(document.activeElement===elem&&!this.isMaxlengthSupported(elem)){if(elem.value.length>=this.maxlength){event.stop();}
this.lastValue=elem.value;}},maxlengthPaste:function(event){var clp=(event.clipboardData||window.clipboardData);if(typeOf(clp)!=='null'){this.setData(clp.getData("text")||"",event.type);var elem=event.target;event.preventDefault();if(this.data.value.length>0){var posit=this.getSelection(elem);var textLeft=elem.value.substr(0,posit.start);var textRight=elem.value.substr(posit.end,elem.value.length);var calcLength=this.maxlength-textLeft.length-textRight.length;if(calcLength>0){var text=this.data.value.substr(0,calcLength);this.lastValue=textLeft+text+textRight;elem.value=textLeft+text+textRight;}else{elem.value=this.lastValue;}
this.setData("","");this.setSelection.delay(20,this,[elem,posit.start,posit.end]);}}},maxlengthDrop:function(event){var data=event.dataTransfer;if(typeOf(data)==='null'){this.setData("",event.type);}else{this.setData(data.getData("text"),event.type);}},maxlengthEvent:function(event){var elem=event.target;if(this.lastValue!==elem.value){if(elem.value.length<=this.maxlength||this.lastValue.length>=elem.value.length){this.lastValue=elem.value;this.setData("","");}else if(this.data.value.length>0){var posit=this.getSelection(elem);if(posit.start===posit.end){posit.start=posit.end-this.data.value.length;}
var textLeft=elem.value.substr(0,posit.start);var textRight=elem.value.substr(posit.end,elem.value.length);var calcLength=this.maxlength-textLeft.length-textRight.length;if(calcLength>0){var text=this.data.value.substr(0,calcLength);this.lastValue=textLeft+text+textRight;elem.value=textLeft+text+textRight;posit.start=textLeft.length;posit.end=textLeft.length+text.length;if(this.data.type==='drop'){posit.start=textLeft.length;posit.end=textLeft.length+text.length;}else{posit.start=posit.end=textLeft.length+text.length;}}else{elem.value=this.lastValue;posit.end=posit.start;}
this.setData("","");this.setSelection.delay(20,this,[elem,posit.start,posit.end]);}else{if(elem.value.charAt(this.maxlength)==='\n'){this.lastValue=elem.value.substr(0,this.maxlength+1);}else{this.lastValue=elem.value.substr(0,this.maxlength);}
this.setData("","");elem.value=this.lastValue;}}},});var TextTrim=new Class({Extends:TextUtil,Implements:[Options],options:{trim:'none'},initialize:function(element,options){this.element=element;this.setOptions(options);this.lastValue=element.value;if(this.options.trim==='left'||this.options.trim==='right'||this.options.trim==='both'){element.addEvent('keypress',this.trimKeypress.bind(this));this.inputEvent(element,this.trimInput.bind(this));element.addEvent('focus',this.trimFocusBlur.bind(this));element.addEvent('blur',this.trimFocusBlur.bind(this));}},trimLeft:function(text){var i;for(i=0;i<text.length&&text.charCodeAt(i)<=32;i++){}
return(i>0)?text.substr(i):text;},trimRight:function(text){var j;for(j=text.length-1;j>=0&&text.charCodeAt(j)<=32;j--){}
return(j<0)?"":text.substr(0,j+1);},trimBoth:function(text){return this.trimLeft(this.trimRight(text));},trimKeypress:function(event){var elem=event.target;if(document.activeElement===elem){var s=this.getSelection(elem);if((this.options.trim==='left'||this.options.trim==='both')&&(s.start===0&&event.code<=32&&event.key!=='backspace'&&event.key!=='tab')){event.stop();}
this.lastValue=elem.value;}},trimInput:function(event){var elem=event.target;if(this.lastValue!==elem.value&&(this.options.trim==='left'||this.options.trim==='both')){this.lastValue=this.trimLeft(elem.value);if(this.lastValue!==elem.value){elem.value=this.lastValue;}}},trimFocusBlur:function(event){var elem=event.target;if(this.options.trim==='left'){this.lastValue=this.trimLeft(elem.value);}else if(this.options.trim==='right'){this.lastValue=this.trimRight(elem.value);}else if(this.options.trim==='both'){this.lastValue=this.trimBoth(elem.value);}
if(this.lastValue!==elem.value){elem.value=this.lastValue;}}});var TextCounter=new Class({Extends:TextUtil,Implements:[Options],options:{max:0,rowLength:0,infoText:null,tabChars:8,rowCut:'char'},textarea:null,spanLabel:null,classLabel:null,classCount:null,infoText:"",maxText:"",initialize:function(element,options){var container;this.setOptions(options);if(this.options.max>0){if(this.options.infoText!==null){this.maxText=this.options.infoText;}}else{if(this.options.infoText!==null){this.infoText=this.options.infoText;}}
this.htmlInfo='<span class="'+this.classCount+'">{1}</span>';this.element=element;container=element.getParent('.zone_texte');if(container.getElement('.'+this.classLabel)){this.spanLabel=container.getElement('.'+this.classLabel);}else{this.spanLabel=new Element('span',{'class':this.classLabel});this.spanLabel.inject(container);}
element.addEvent('keypress',this.updateText.bind(this));this.inputEvent(element,this.updateText.bind(this));element.addEvent('focus',this.updateText.bind(this));element.addEvent('blur',this.updateText.bind(this));if(Browser.name==='ie'&&Browser.version===9){element.addEvent('focus',this.onFocusChange.bind(this));element.addEvent('blur',this.onFocusChange.bind(this));}
this.updateText();},calcNewCount:function(text){return 0;},onFocusChange:function(event){if(event.type==="focus"){document.addEventListener("selectionchange",this.updateText.bind(this),false);}else{document.removeEventListener("selectionchange",this.updateText.bind(this),false);}},updateText:function(event){var newText;var formatCount;var infoCpl;var text=this.element.value;if(event&&event.type==="keypress"&&(event.key==="space"||event.key==="enter"||event.key==="tab"||event.key.length===1)&&text.length<this.element.maxlength){text=text+String.fromCharCode(event.code);}
var count=this.calcNewCount(text);if(this.options.max>0){newText=this.htmlInfo+'/{2} ';if(count>this.options.max){formatCount='<b>'+count+'</b>';}else{formatCount=count;}
infoCpl=this.maxText.split("|");if(infoCpl.length===1){infoCpl.push(infoCpl[0]);}
newText=MessageFormat.pluralFormat(newText+infoCpl[0],newText+infoCpl[1],count,formatCount,this.options.max);}else{infoCpl=this.infoText.split("|");if(infoCpl.length===1){infoCpl.push(infoCpl[0]);}
newText=this.htmlInfo+' ';newText=MessageFormat.pluralFormat(newText+infoCpl[0],newText+infoCpl[1],count,count);}
this.spanLabel.set('html',newText);return count;}});var TextChars=new Class({Extends:TextCounter,classCount:'nbcars',classLabel:'maxcars',infoText:'caractère saisi|caractères saisis',maxText:'caractères max.|caractères. max.',initialize:function(element,options){this.parent(element,options);},calcNewCount:function(text){return text.length;}});var TextRows=new Class({Extends:TextCounter,classCount:'nblignes',classLabel:'maxlignes',infoText:'ligne saisie|lignes saisies',maxText:'lignes max.|lignes max.',initialize:function(element,options){this.parent(element,options);},isCutChar:function(car){return car===' '||car==='\t'||car==='\n';},calcNewCount:function(text){if(this.options.rowLength>0){return this.calcNbRowsFixedCols(text);}else{return this.calcNbRowsLegacy(text);}},calcNbRowsLegacy:function(text){var nbligne=0;var nbcars=0;var textLength=text.length;for(var i=0;i<text.length;i++){if(text.charAt(i)==='\r'||text.charAt(i)==='\n'){if(nbcars===0){nbligne++;}
if(i<textLength-1&&text.charAt(i)==='\r'&&text.charAt(i+1)==='\n'){i++;}
nbcars=0;}else{if(nbcars===0){nbligne++;}
nbcars++;}}
return nbligne;},calcNbRowsFixedCols:function(text){var nbligne=0;var nbcars=0;var textLength=text.length;for(var i=0;i<textLength;i++){if(text.charAt(i)==='\r'||text.charAt(i)==='\n'){if(nbcars===0){nbligne++;}
if(i<textLength-1&&text.charAt(i)==='\r'&&text.charAt(i+1)==='\n'){i++;}
nbcars=0;}else{if(nbcars===0){nbligne++;}
if(text.charAt(i)==='\t'){nbcars=nbcars+this.options.tabChars;}else{nbcars++;}
if(nbcars>this.options.rowLength){nbligne++;if(this.options.rowCut==='char'){if(text.charAt(i)==='\t'){nbcars=this.options.tabChars;}else{nbcars=1;}}else{if(this.isCutChar(text.charAt(i))){if(text.charAt(i)==='\t'){nbcars=this.options.tabChars;}else{nbcars=1;}}else{var j;for(j=i-1;j>=0&&!this.isCutChar(text.charAt(j));j--){}
nbcars=i-j;}}}}}
return nbligne;}});
var ZoneMessage={afficherMessage:function(zone,message){document.getElementById(zone).className="zone-message";document.getElementById(zone).innerHTML=message;},afficherErreur:function(zone,message){document.getElementById(zone).className="zone-alerte";document.getElementById(zone).innerHTML=message;},afficherAttente:function(zone,type,message){document.getElementById(zone).className="zone-attente";if(type==="roue"){document.getElementById(zone).innerHTML="<img alt='Traitement en cours, veuillez patienter ...' "+"title='Traitement en cours, veuillez patienter ...' "+"src='biblicnam/images/zoneMessage/roue-tempo.gif' />";}else{document.getElementById(zone).innerHTML="<img alt='Traitement en cours, veuillez patienter ...' "+"title='Traitement en cours, veuillez patienter ...' "+"src='biblicnam/images/zoneMessage/barre-progress-rapide.gif' />";}
if(message!==null&&message!==""){document.getElementById(zone).innerHTML+=message;}},effacerMessage:function(zone){document.getElementById(zone).innerHTML="";document.getElementById(zone).className="invisible";}};
var MODE_PAIEMENTS=[];var NOM_PREFIX_DIV_CHOIX="dbc_section_types_choix_";var NOM_PREFIX_DIV_COORD="dbc_section_coord_";var MODE_PAIEMENT_SEPARATEUR;function MODE_PAIEMENT(codeModePaiement,typesCoordonneeBancaire){this.codeModePaiement=codeModePaiement;this.typesCoordonneeBancaire=typesCoordonneeBancaire;}
function changerVisibilite(idElement,visible){var eltDiv=document.getElementById(idElement);if(eltDiv!==null){if(visible!==true)
{eltDiv.style.display='none';}
else{if(idElement.indexOf("idTypeCoordonneeBancaire")>-1)
{eltDiv.style.display='inline-block';}
else
{eltDiv.style.display='block';}}}}
function afficherElement(idElement){changerVisibilite(idElement,true);}
function cacherElement(idElement){changerVisibilite(idElement,false);}
function idTypesCoordonneeBancaire(valCodeModePaiement){var result='idTypeCoordonneeBancaire'+valCodeModePaiement;return result;}
function nomDivSectionChoix(valCodeModePaiement){var result=NOM_PREFIX_DIV_CHOIX+valCodeModePaiement;return result;}
function nomDivSectionCoord(valCodeTypeCoordonneeBancaire){var result=NOM_PREFIX_DIV_COORD+valCodeTypeCoordonneeBancaire;return result;}
function recupererModePaiementsForm(){var forms=document.forms;var result=null;var testPresent=false;for(i=0;i<forms.length;i++){try{testPresent=(forms[i].codeModePaiement!==undefined);}catch(e){testPresent=false;}
if(testPresent){result=forms[i];break;}}
return result;}
function recupererCodeModePaiement(form){var eltCodeMP=form.codeModePaiement;var eltMPOptions=eltCodeMP.options;var testTypeSelect=false;var codeMPSelected="";try{var eltCodeMPOptions=eltCodeMP.options;testTypeSelect=((eltCodeMPOptions!==null)&&(eltCodeMPOptions!==undefined));}catch(e){testTypeSelect=false;}
if(testTypeSelect){for(i=0;i<eltMPOptions.length;i++){if(eltMPOptions[i].selected===true){codeMPSelected=eltMPOptions[i].value;break;}}}else{codeMPSelected=eltCodeMP.value;}
return codeMPSelected;}
function changerAffichage(){var form=recupererModePaiementsForm();if(form!==null){var codeMPSelected=recupererCodeModePaiement(form);var nomFieldset;for(i=0;i<MODE_PAIEMENTS.length;i++){var valCodeMP=MODE_PAIEMENTS[i].codeModePaiement;cacherElement(nomDivSectionChoix(valCodeMP));cacherElement('idTypeCoordonneeBancaire'+valCodeMP);cacherElement('idTypeCoordonneeBancaire'+valCodeMP+'_label');for(j=0;j<MODE_PAIEMENTS[i].typesCoordonneeBancaire.length;j++){nomFieldset=nomDivSectionCoord(MODE_PAIEMENTS[i].typesCoordonneeBancaire[j]).replace("+","");cacherElement("formulaire"+nomFieldset);cacherElement("consultation"+nomFieldset);$("formulaire"+nomFieldset).setProperty('aria-expanded','false');}}
if($('idTypeCoordonneeBancaire'+codeMPSelected)===null){return;}
if($('idTypeCoordonneeBancaire'+codeMPSelected).getElements('option').length!==0){afficherElement('idTypeCoordonneeBancaire'+codeMPSelected+'_label');afficherElement('idTypeCoordonneeBancaire'+codeMPSelected);}
var eltTC=document.getElementById(idTypesCoordonneeBancaire(codeMPSelected));var eltTCOptions=eltTC.options;var codeTCSelected="";for(i=0;i<eltTCOptions.length;i++){if(eltTCOptions[i].selected===true){codeTCSelected=eltTCOptions[i].value;break;}}
if((eltTCOptions!==null)&&(eltTCOptions.length>1)){afficherElement(nomDivSectionChoix(codeMPSelected));}
if(codeTCSelected===""){eltTCOptions.seletedIndex=0;codeTCSelected=eltTCOptions[0].value;}
nomFieldset=nomDivSectionCoord(codeTCSelected.replace("+",""));afficherElement("formulaire"+nomFieldset);afficherElement("consultation"+nomFieldset);$("formulaire"+nomFieldset).setProperty('aria-expanded','true');form.codeTypeCoordonneeBancaire.value=codeTCSelected.replace("+","");}}
var keyDownField;function autoJump_keyDown(){if(this!==keyDownField){this.beforeLength=this.value.length;keyDownField=this;}}
function autoJump_keyUp(){if((this===keyDownField)&&(this.value.length>this.beforeLength)&&(this.value.length>=this.maxLength)){this.nextField.focus();this.nextField.select();}
keyDownField=null;}
var Domiciliation={};Domiciliation.autoUpperCase=function(){this.value=this.value.toUpperCase();};Domiciliation.addEventAutoUpperCase=function(champList){for(i=0;i<champList.length-1;i++){var champId=champList[i];if($(champId)){$(champId).addEvent('blur',Domiciliation.autoUpperCase);}}};Domiciliation.addEventAutoJump=function autoJump(fieldId,nextFieldId){if($(fieldId)){$(fieldId).nextField=$(nextFieldId);if($(fieldId).maxLength!==null){$(fieldId).addEvent('keydown',autoJump_keyDown);$(fieldId).addEvent('keyup',autoJump_keyUp);}}};
function postAction(action,formObject){if(action!==null){formObject.action=action;if(typeof Placeholders!=='undefined'){Placeholders.disable(formObject);}
formObject.submit();}}
function setAction(url,form){var formObject=document.forms[0];if(form!==null&&form!==''){formObject=ChampTag.getForm(form);}
if(formObject!==null){postAction(url,formObject);}else{window.location=url;}}
function checkALL(form,name,nameParent){var formObject=document.forms[0];if(form!==null&&form!==''&&(document.forms[form]!==null)){formObject=document.forms[form];}
var state=formObject.elements[nameParent].checked;for(i=formObject.elements.length-1;i>=0;i--){var elm=formObject.elements[i];if((elm.type==='checkbox')&&(elm.name===name)){elm.checked=state;}}}
function setReset(form){var formObject=document.forms[0];if((form!==null)&&(form!=='')&&(document.forms[form]!==null)){formObject=document.forms[form];}
for(i=formObject.elements.length-1;i>=0;i--){var elm=formObject.elements[i];if((elm.type==='text')&&(elm.name!=='')&&(elm.name.match("-f$")==="-f")){formObject.elements[i].value='';}
if((elm.type==='select-one')&&(elm.name.match("-f$")==="-f")){elm.options[elm.length-1].selected=true;}}}
function changeAllSelect(nomSelect,selectElm){var elements=document.getElementsByName(nomSelect);for(i=elements.length-1;i>=0;i--){elements[i].selectedIndex=selectElm;}}
function openPopUpSimple(titre,url,height,width){if(height!==undefined){config="height="+height;}else{config="height=550";height=550;}
if(width!==undefined){config+=", width="+width;}else{config+=", width=700";width=700;}
var H=(screen.height-height)/2;var W=(screen.width-width)/2;popup=window.open(url,titre,config+',scrollbars=1,resizable=0,locationbar=no,left='+W+',top='+H);}
var TableTag={checkAllSelector:'input[name$="-ct"]',checkboxesSelector:'input[name$="-c"]',formFieldsSuffix:["-f","-f1","-f2","-z","c","r","-ct","-restore","-filter"]};TableTag.cleanParameters=function(href){var cleanHref=href;if(href!==null){var url=href.split("?");if(url.length<=1){return href;}
cleanHref=href.split("?")[0];var parameters=href.split("?")[1].split("&");cleanHref+="?";for(var i=0;i<parameters.length;i++){var parametre=parameters[i];if(parametre!==null){var isFormField=false;for(var j=0;(j<TableTag.formFieldsSuffix.length)&&!isFormField;j++){if(parameters[i].indexOf(TableTag.formFieldsSuffix[j]+"=")!==-1){isFormField=true;}}
if(!isFormField){cleanHref+=parameters[i]+"&";}}}
cleanHref=cleanHref.substr(0,cleanHref.length-1);}
return cleanHref;};TableTag.updateHref=function(href,formId){if(href===null){return"";}else{return"javascript:setAction('"+TableTag.cleanParameters(href)+"','"+formId+"');";}};TableTag.updateLinks=function(formId,tabUid){var form=ChampTag.getForm(formId);if(form){var table=form.getElement("#"+tabUid);var interpage=table.getParent('.tab-body').getPrevious('.tab-interpage');var interpagebas=table.getParent('.tab-body').getNext('.tab-interpagebas');var interpages=[interpage,interpagebas];for(var i=0;i<interpages.length;i++){if(interpages[i]){interpages[i].getElements('a').each(function(anchor){if(!anchor.hasClass('precedentinactif')&&!anchor.hasClass('suivantinactif')&&!anchor.hasClass('courant')){var oldhref=anchor.getProperty('href');anchor.setProperty('href',TableTag.updateHref(oldhref,formId));}});}}
var thead=table.getElement('thead');if(thead){thead.getElements('.triable a').each(function(anchor){var oldhref=anchor.getProperty('href');anchor.setProperty('href',TableTag.updateHref(oldhref,formId));});}}};TableTag.updatePaging=function(formId,tabUid,baseHref){var form=ChampTag.getForm(formId);if(form){var table=form.getElement("#"+tabUid);var divPaginationHaut=table.getParent('.tab-body').getPrevious('.tab-interpage');var divPaginationBas=table.getParent('.tab-body').getNext('.tab-interpagebas');if(divPaginationHaut&&divPaginationHaut.getElement('.pagination')){divPaginationHaut.getElement('button').destroy();divPaginationHaut.getElement('select').addEvent('change',function(){if(divPaginationBas){divPaginationBas.getElement('select').selectedIndex=this.selectedIndex;}
eval(TableTag.updateHref(baseHref,formId));});}
if(divPaginationBas&&divPaginationBas.getElement('.pagination')){divPaginationBas.getElement('button').destroy();divPaginationBas.getElement('select').addEvent('change',function(){if(divPaginationHaut){divPaginationHaut.getElement('select').selectedIndex=this.selectedIndex;}
eval(TableTag.updateHref(baseHref,formId));});}}};TableTag.updateRowHref=function(tabUid){var table=$(tabUid);if(table){table.getElements('tr.trClickable').each(function(row){var onclickValue=row.getProperty('data-onclick');if(onclickValue!==null){row.removeProperty('data-onclick');row.getElements('td').each(function(cell){var isLoupeSansHref=cell.hasClass('pictogramme')&&cell.getElement('a.vue-detail')!==null&&cell.getElement('a.vue-detail').getProperty('href')===null;if((!cell.hasClass('pictogramme')&&cell.getElement('a')===null)||isLoupeSansHref){cell.addEvent('click',function(){if(onclickValue.indexOf('(')===-1){window.location=onclickValue;}else{eval(onclickValue);}});}});}});}};TableTag.updateCheckAll=function(checkAll,checkboxes){var checked=true;if(checkboxes.length>0){checkboxes.each(function(checkbox){if(!checkbox.checked){checked=false;}});checkAll.set('checked',checked);}};TableTag.addCheckEvents=function(checkAll,checkboxes){checkAll.addEvent("click",function(event){checkboxes.set('checked',this.checked);});checkboxes.addEvent("click",function(event){TableTag.updateCheckAll(checkAll,checkboxes);});};TableTag.init=function(formName,tabUid,baseHref){var table=$(tabUid);TableTag.updatePaging(formName,tabUid,baseHref);TableTag.updateLinks(formName,tabUid);TableTag.updateRowHref(tabUid);if(table){var checkAll=table.getElement(TableTag.checkAllSelector);var checkboxes=table.getElements(TableTag.checkboxesSelector);if(checkAll){TableTag.addCheckEvents(checkAll,checkboxes);TableTag.updateCheckAll(checkAll,checkboxes);}}};function getLinkFrom(bouton){var lienBouton=new Element('a');lienBouton.set('id',bouton.get('id'));lienBouton.set('class',bouton.get('class'));lienBouton.store('oldButton',bouton.clone());bouton.getChildren().inject(lienBouton);lienBouton.addEvent('click',function(){var oldButton=this.retrieve('oldButton');oldButton.setStyle('display','none');oldButton.inject(this);this.getParent('form').submit();});return lienBouton;}
window.addEvent('domready',function(){if(Browser.ie6||Browser.ie7){var tableaux=$(document.body).getElements('.tab-box table');for(j=0;j<tableaux.length;j++){var boutons=tableaux[j].getElements('.filtre button:not([disabled])');for(i=0;i<boutons.length;i++){if(String.from(boutons[i].get('name')).contains("-restore")){var conteneur=boutons[i].getParent();var lienBouton=getLinkFrom(boutons[i]);lienBouton.inject(conteneur,'top');boutons[i].destroy();break;}}}}});
TableJs=new Class({Implements:[Options],rowMin:0,rowMax:0,columns:[],isArrayDataSource:false,interfiches:[],resultats:[],paginationSelects:[],hasFilters:false,options:{pagination:{value:10,options:[5,10,50],position:"top",partialList:false},sortable:true,paginationOptions:[5,10,50],noValueMatchFilter:false},initialize:function(element,data,options){Locale.use('fr-FR');var opts=Object.merge({},data,options);opts.data=undefined;this.setOptions(opts);this.id=this.options.id||'t'+Math.floor((Math.random()*1000)+1);this.container=$(element);this.source=data;this.check();this.rows=Array.from(this.source.data);if(this.rows[0]){this.isArrayDataSource=(this.rows[0]instanceof Array);}
var j=0;this.options.columns.each(function(column,index){var values=[];var nameOrIndex;if(this.isArrayDataSource){nameOrIndex=j;}else{nameOrIndex=column.name;}
this.rows.each(function(row){if(row[nameOrIndex]){values.push(row[nameOrIndex]);}});var col=new TableJs.Column(column,index,values,this);this.hasFilters=this.hasFilters||col.isFilterable;this.columns.push(col);if(!col.skipData){j++;}}.bind(this));this.pagination=this.options.pagination.value;this.rowMax=this.pagination;if(!isNaN(this.pagination)){this.options.pagination.options.include(this.pagination).sort(function(a,b){return a-b;});}
if(this.options.sort!==undefined){this.sortColumn=this.getColIndexFor(this.options.sort);this.sortReverse=(this.options.order==='desc');this.sort();}
var hasFilterValue=(this.options.columns.filter(function(col){return col.filterValue!==undefined;}).length>0);if(hasFilterValue){this.filter();}
this.construct();this.attachEvents();this.table.fireEvent('tbody:ready');this.table.fireEvent('table:ready');this.table.tableJs=this;},check:function(){if(this.source.data===undefined){throw new SyntaxError("No data");}
if(this.options.caption===undefined){throw new SyntaxError("Caption is required for a table (accessibility)");}
this.options.columns.each(function(column){if(column.decorator){if(TableJs.Decorators[column.decorator]===undefined){throw new SyntaxError("Decorator not found for column "+JSON.stringify(column));}
if(column.decorator==='radio'||column.decorator==='checkbox'){if(column.name===undefined){throw new SyntaxError("Property name is required for column "+JSON.stringify(column));}
if(column.value===undefined){throw new SyntaxError("Property value is required for column "+JSON.stringify(column));}}}
if(column.filter){if(TableJs.Filters[column.filter]===undefined){throw new SyntaxError("Filter not found for column "+JSON.stringify(column));}
if(column.filter==='DateBetween'&&column.filterValue&&typeof column.filterValue!=='object'){throw new SyntaxError("Wrong value for filter DateBetween, column: "+JSON.stringify(column));}}});},construct:function(){this.tabbox=this.container;this.tabbox.addClass('tab-box');var tabbody=new Element('div',{'class':'tab-body'});this.writer=new TableJs.TableWriter(this);if(this.hasBanner('top')){this.tabbox.adopt(this.buildInterpage('h'));}
tabbody.inject(this.tabbox);this.table=this.writer.writeTable(tabbody);if(this.hasBanner('bottom')){this.tabbox.adopt(this.buildInterpage('b'));}
this.updateResultatHtml();this.writer.updateHeaders();this.writer.updatePaginationSelect();},hasBanner:function(position){if(position){return this.options.pagination&&(this.options.pagination.position==='both'||this.options.pagination.position===position);}else{return this.options.pagination.position!=='none';}},buildInterpage:function(suffix){var tabinterpage=new Element('div',{'id':this.id+'interpage'+suffix,'class':'tab-interpage'});this.interfiches.push(new TableJs.Interfiche(this,tabinterpage));var resultat=new Element('div',{'class':'resultat'});this.resultats.push(resultat);resultat.inject(tabinterpage,'top');var pagination=new Element('div',{'class':'pagination'});var idselp=this.id+'pagesel'+suffix;var labelp=new Element('label',{'class':'lignePage','for':idselp,'text':'nb. de lignes par page'});var paginationSelect=new Element('select',{'id':idselp});this.paginationSelects.push(paginationSelect);pagination.adopt(labelp,paginationSelect);pagination.inject(tabinterpage,'bottom');return tabinterpage;},updateResultatHtml:function(){var message;if(this.rows.length<this.source.data.length){message=MessageFormat.pluralFormat('<b>{0}</b> ligne filtrée sur {1}','<b>{0}</b> lignes filtrées sur {1}',this.rows.length,this.source.data.length);}else{message=MessageFormat.pluralFormat('<b>{0}</b> ligne','<b>{0}</b> lignes',this.rows.length);}
this.resultats.each(function(div){div.set('html',message);});},attachEvents:function(){var self=this;this.table.addEvent('filter:updated',function(event){this.filter();this.rowMin=0;this.writer.updateInterpage();this.writer.updateBody();this.writer.updatePaginationSelect();this.updateResultatHtml();}.bind(this));this.table.addEvent('interfiche:updated',function(trigger){this.writer.updateBody();this.interfiches.each(function(interfiche){if(trigger!==interfiche){interfiche.current=trigger.current;interfiche.construct();}}.bind(this));}.bind(this));this.paginationSelects.each(function(select){select.addEvent('change',function(event){self.pagination=this.value;self.writer.updatePaginationSelect();self.table.fireEvent('pagination:select');});});this.table.addEvent('pagination:select',function(event){this.writer.updateInterpage();this.writer.updateBody();}.bind(this));this.table.addEvent('click:relay(th.triable a)',this.sortEventHandler.bind(this));this.table.addEvent('keydown:keys(enter):relay(th.triable a)',this.sortEventHandler.bind(this));this.table.addEvent('sort:updated',function(event){this.sort();this.writer.updateHeaders();this.writer.updateBody();this.writer.updateInterpage();}.bind(this));this.table.addEvent('filter:restore',function(event){this.writer.restoreFilters();this.filter();this.writer.updateBody();this.writer.updateInterpage();}.bind(this));this.table.addEvent('table:ready',function(event){var checkAll=self.table.getElement('thead input[type=checkbox]');if(checkAll){checkAll.addEvent("click",function(event){var checkboxes=self.table.getElements('tbody input[type=checkbox]');checkboxes.set('checked',this.checked);});}});this.table.addEvent('tbody:ready',function(event){var checkAll=self.table.getElement('thead .cb-decorator input[type=checkbox]');if(checkAll){var checkboxes=self.table.getElements('tbody .cb-decorator input[type=checkbox]');checkboxes.addEvent("click",function(event){TableTag.updateCheckAll(checkAll,checkboxes);});TableTag.updateCheckAll(checkAll,checkboxes);}});if(this.options.rows){this.table.addEvent('click:relay(td:not(.no-row-link))',function(event){var tr=event.target.getParent('tr');var visibleTR=this.table.getElements('tbody tr');var rowNum=this.rowMin+visibleTR.indexOf(tr);if(this.options.rows.js){var eventClickFunction=new Function('event',this.options.rows.js);eventClickFunction.call({row:this.rows[rowNum]},event);}
if(this.options.rows.href!==undefined){window.location=TableJs.buildHref(this.options.rows.href,this.options.rows.params,this.rows[rowNum]);}}.bind(this));}},sortEventHandler:function(event){var th=event.target.getParent('th');this.sortColumn=this.table.getElements('thead th').indexOf(th);if(th.hasClass('tri-desc')){this.sortReverse=false;}else if(th.hasClass('tri-asc')){this.sortReverse=true;}else{this.sortReverse=(TableJs.sortFirstOrder!=="ascending");}
this.table.fireEvent('sort:updated');},filter:function(){this.rows=[];if(typeof Placeholders!=='undefined'){Placeholders.disable(this.table);}
this.source.data.each(function(row){var match=true;for(var i=0,j=0;i<this.columns.length;i++){var column=this.columns[i];if(!column.skipData){var val=row[(this.isArrayDataSource?j:column.name)];if(column.isFilterable){if(val){if(!column.filter.match(val)){match=false;break;}}else{if(!this.options.noValueMatchFilter&&!column.filter.match('')){match=false;break;}}}
j++;}}
if(match){this.rows.push(row);}}.bind(this));if(typeof Placeholders!=='undefined'){Placeholders.enable(this.table);}},sort:function(){var nameOrIndex;if(this.isArrayDataSource){nameOrIndex=this.getColIndexFor(this.sortColumn);}else{nameOrIndex=this.columns[this.sortColumn].name;}
this.rows.sort(function(a,b){return this.columns[this.sortColumn].compare(a[nameOrIndex],b[nameOrIndex]);}.bind(this));if(this.sortReverse){this.rows.reverse();}},getColIndexFor:function(name){for(var i=0,j=0;i<this.columns.length;i++){if(name===this.columns[i].name){return j;}
if(!this.columns[i].skipData){j++;}}}});TableJs.Column=new Class({values:[],initialize:function(column,index,values,tableJs){this.rawdata=column;this.index=index;this.name=column.name||index;this.values=values;this.decorator=TableJs.Decorators[column.decorator||'default'];this.compare=this.decorator.sortFunction||TableJs.Decorators['default'].sortFunction;if(typeof(column)==="string"){this.label=column;}else{this.label=column.label||'';this.format=column.format||this.decorator.format;}
if(column.filterable||column.filter){this.isFilterable=true;this.filter=new TableJs.Filters[column.filter||this.decorator.filter||'Default'](this,tableJs);}else{this.isFilterable=false;}
this.isSortable=column.sortable;this.css=column.css||this.decorator.css;this.skipData=column.skipData||false;},formatValue:function(value,row,opts){if(typeof this.format==='function'){return this.format.apply(this,[value,row,opts]);}
return value;}});
TableJs.Interfiche=new Class({Extends:Interfiche,position:'bottom',showMonoPage:false,initialize:function(tableJs,container){this.tableJs=tableJs;this.element=container;this.items=tableJs.rows;this.interpage=new Element('div',{'class':'tabinterfiche',role:'navigation'});this.addEvents();this.first();},getPageSize:function(){return this.tableJs.pagination;},getLastPageNumber:function(){return Math.ceil(this.items.length/this.getPageSize());},updateList:function(){this.tableJs.rowMax=this.current*this.getPageSize();this.tableJs.rowMin=this.tableJs.rowMax-this.getPageSize();if(this.tableJs.table){this.tableJs.table.fireEvent('interfiche:updated',this);}}});
TableJs.TableWriter=new Class({oddClass:'pair',evenClass:'impair',columns:[],visibleRows:[],initialize:function(tableJs){this.tableJs=tableJs;this.columns=this.tableJs.columns;this.hasFilters=this.tableJs.hasFilters;},getTable:function(){var table=new Element('table',{id:this.tableJs.id});if(this.tableJs.options.cssclass){table.addClass(this.tableJs.options.cssclass);}
table.adopt(new Element('caption',{text:this.tableJs.options.caption}));table.adopt(this.getColgroup());table.adopt(this.getThead());table.adopt(this.getTbody());return table;},writeTable:function(container){var table=this.getTable();container.adopt(table);this.tableJs.table=table;this.tableJs.table.fireEvent('table:ready');this.columns.each(function(column){if(column.isFilterable&&column.filter.js){column.filter.js();}}.bind(this));return table;},getColgroup:function(){var colgroup=new Element('colgroup');var cols=[];this.columns.each(function(column){var col=new Element('col');if(column.rawdata.width){col.setStyle('width',column.rawdata.width);}
cols.push(col);});colgroup.adopt(cols);return colgroup;},getThead:function(){var thead=new Element('thead');if(this.hasFilters){thead.adopt(this.getFilters());thead.adopt(this.getFiltersInfo());}
thead.adopt(this.getHeaders());return thead;},getHeaders:function(){var tr=new Element('tr');this.columns.each(function(column){var th=new Element('th',{scope:'col'});if(column.css){th.set('class',column.css);}
if(column.rawdata.decorator==='checkbox'){var checkall=new Element('input',{type:'checkbox'});th.adopt(checkall);}else if(column.isSortable){var anchor=new Element('a',{role:'button',tabIndex:0,text:column.label});anchor.addEvent('click',function(e){e.preventDefault();});th.addClass('tri triable');anchor.inject(th);}else{th.set('text',column.label);}
th.inject(tr);}.bind(this));return tr;},getFilters:function(){var tr=new Element('tr',{'class':'filtre top'});this.columns.each(function(column){var td=new Element('td');if(column.isFilterable){td.adopt(column.filter.elements);}
td.inject(tr);}.bind(this));return tr;},restoreFilters:function(){this.columns.each(function(column){if(column.isFilterable){column.filter.reset();}});},getFiltersInfo:function(){var tr=new Element('tr',{'class':'filtre ligne2'});var td=new Element('td',{colspan:this.tableJs.columns.length,'class':'droite'});var restoreBtn=new Element('button',{type:'button','class':'bouton intermediaire','html':'<span class="btn_action"><span><span>Rétablir</span></span></span>'});restoreBtn.addEvent('click',function(event){this.tableJs.table.fireEvent('filter:restore');}.bind(this));td.adopt(restoreBtn);td.adopt(new Element('a',TableJs.filterHelp));td.inject(tr);return tr;},getTbody:function(){var tbody=new Element('tbody');if(this.tableJs.options.rows!==undefined){tbody.addClass('has-row-link');}
var start=this.tableJs.rowMin;var end=this.tableJs.rows.length;if(this.tableJs.hasBanner()&&(this.tableJs.pagination!=='*'||this.tableJs.rows.length<=this.tableJs.pagination)){end=Math.min(this.tableJs.rows.length,this.tableJs.rowMax);}
this.visibleRows=[];for(var i=start;i<end;i++){this.visibleRows.push(this.tableJs.rows[i]);var tr=this.getRow(this.tableJs.rows[i]);tr.inject(tbody);}
return tbody;},getRow:function(row){var tr=new Element('tr',{'class':(this.visibleRows.indexOf(row)%2===1?this.oddClass:this.evenClass)});for(var i=0,j=0;i<this.columns.length;i++){var td=new Element('td');if(i<this.columns.length){var opts={rowIndex:this.visibleRows.indexOf(row),column:this.columns[i].rawdata};var val=(this.tableJs.isArrayDataSource?row[j]:row[this.columns[i].name]);if(val===undefined){val='';}
var formatedVal=this.columns[i].formatValue(val,row,opts);if(typeof formatedVal==="string"){td.set('html',formatedVal);}else{td.adopt(formatedVal);}
if(!(this.columns[i].skipData||j>=row.length)){j++;}}
if(this.columns[i].css){td.set('class',this.columns[i].css);}
td.inject(tr);}
return tr;},updateHeaders:function(){var headers=this.tableJs.table.getElements('thead th');headers.removeClass('tri-asc');headers.removeClass('tri-desc');headers.removeProperty('aria-sort');if(this.tableJs.sortColumn!==null&&this.tableJs.sortColumn!==undefined){var th=headers[this.tableJs.sortColumn];if(this.tableJs.sortReverse){th.addClass('tri-desc');th.set('aria-sort','descending');}else{th.addClass('tri-asc');th.set('aria-sort','ascending');}}},updateBody:function(){var tbody=this.tableJs.tabbox.getElement('tbody');if(tbody){tbody.destroy();this.tableJs.table.adopt(this.getTbody());this.tableJs.table.fireEvent('tbody:ready');}},updatePaginationSelect:function(){this.tableJs.paginationSelects.each(function(select){var opts=[];var optionSelected=false;var options=this.tableJs.options.pagination.options;options.each(function(val){if(val<this.rows.length){var opt=new Element('option',{value:val,text:val});if(val==this.pagination){opt.set('selected','selected');optionSelected=true;}
opts.push(opt);}}.bind(this.tableJs));var optall=new Element('option',{value:'*',text:'Toutes'});if('*'===this.tableJs.pagination||!optionSelected){optall.set('selected','selected');}
opts.push(optall);select.empty();select.adopt(opts);}.bind(this));},updateInterpage:function(){this.tableJs.interfiches.each(function(interfiche){interfiche.items=this.tableJs.rows;if(this.tableJs.pagination==='*'||this.tableJs.rows.length<=this.tableJs.pagination){this.tableJs.hasPagination=false;interfiche.destroy();}else{this.tableJs.hasPagination=true;interfiche.construct();interfiche.first();}}.bind(this));}});
TableJs.FilterUtils={getOperator:function(filterValue){var ret={name:'NONE',length:0};if(filterValue.indexOf('<>')===0||filterValue.indexOf('!=')===0){ret={name:'DIFF',length:2};}else if(filterValue.indexOf('>=')===0){ret={name:'SUPEQ',length:2};}else if(filterValue.indexOf('>')===0){ret={name:'SUP',length:1};}else if(filterValue.indexOf('<=')===0){ret={name:'INFEQ',length:2};}else if(filterValue.indexOf('<')===0){ret={name:'INF',length:1};}else if(filterValue.indexOf('=')===0){ret={name:'EQ',length:1};}
return ret;},strToRegex:function(str){var resultat='';var character;for(var i=0;i<str.length;++i){character=str.charAt(i);if("*".indexOf(character)!=-1){resultat+='.';resultat+=character;}else if("?".indexOf(character)!=-1){resultat+='.';}else if(".^$|?*+[]{}\"()".indexOf(character)!=-1){resultat+='\\';resultat+=character;}else{resultat+=character;}}
return'^'+resultat+'$';},hasJokers:function(filterValue){var regex=RegExp('((".*")|\\?|\\*)');return filterValue.length>0&&regex.test(filterValue);},isCaseSensitive:function(filterValue){return filterValue.indexOf('"')===0&&filterValue.lastIndexOf('"')===(filterValue.length-1);}};TableJs.Filters={delay:200};TableJs.Filters.Abstract=new Class({op:{name:'NONE'},initialize:function(column,tableJs){this.column=column;this.tableJs=tableJs;this.elements=this.build();if(this.column.rawdata.filterValue!==undefined){this.updateComputedProp();}},match:function(cellValue){var ret;if(this.input.value.length===0){ret=true;}else{var cellVal=this.getComparableObject(cellValue);switch(this.op.name){case'DIFF':ret=this.column.compare(cellVal,this.filterVal)!==0;break;case'SUPEQ':ret=this.column.compare(cellVal,this.filterVal)>=0;break;case'SUP':ret=this.column.compare(cellVal,this.filterVal)>0;break;case'INFEQ':ret=this.column.compare(cellVal,this.filterVal)<=0;break;case'INF':ret=this.column.compare(cellVal,this.filterVal)<0;break;case'EQ':ret=this.column.compare(cellVal,this.filterVal)===0;break;case'NONE':ret=cellVal.indexOf(this.filterVal)>-1;break;default:ret=false;break;}}
return ret;},delayedNotifyUpdate:function(){clearTimeout(this.timer);this.timer=this.notifyUpdate.delay(TableJs.Filters.delay,this);},updateComputedProp:function(){},reset:function(){},notifyUpdate:function(){this.updateComputedProp();this.tableJs.table.fireEvent('filter:updated');}});TableJs.Filters.Default=new Class({Extends:TableJs.Filters.Abstract,build:function(){this.input=new Element('input',{type:'text','class':'champ_filtre',title:'Filtre sur la colonne '+this.column.label});if(this.column.rawdata.filterValue!==undefined){this.input.set('value',this.column.rawdata.filterValue);}
this.input.addEvent('keyup',this.firterUpdated.bind(this));return this.input;},reset:function(){if(this.column.rawdata.filterValue!==undefined){this.input.set('value',this.column.rawdata.filterValue);}else{this.input.set('value','');}
this.notifyUpdate();},updateComputedProp:function(){this.op=TableJs.FilterUtils.getOperator(this.input.value);this.filterVal=this.getComparableObject(this.input.value.substring(this.op.length));this.hasJokers=TableJs.FilterUtils.hasJokers(this.input.value);var valueWithoutOp=this.input.value.substring(this.op.length);var realFilterValue=valueWithoutOp;this.caseSensitive=false;if(TableJs.FilterUtils.isCaseSensitive(valueWithoutOp)){realFilterValue=valueWithoutOp.substring(1,valueWithoutOp.length-1);this.caseSensitive=true;}
this.regex=RegExp(TableJs.FilterUtils.strToRegex(this.getComparableObject(realFilterValue,this.caseSensitive)));},firterUpdated:function(event){var forbiddenKeys=[9,16,17,37,38,39,40];if(!forbiddenKeys.contains(event.code)){this.delayedNotifyUpdate();}},getComparableObject:function(value,caseSensitive){if(typeof value==='number'){return""+value;}
return(caseSensitive?value:value.standardize().toUpperCase());},match:function(cellValue){var ret;if(this.hasJokers){switch(this.op.name){case'NONE':case'EQ':ret=this.regex.test(this.getComparableObject(cellValue,this.caseSensitive));break;case'DIFF':ret=!this.regex.test(this.getComparableObject(cellValue,this.caseSensitive));break;default:ret=this.parent(cellValue);break;}}else{ret=this.parent(cellValue);}
return ret;}});TableJs.Filters.Numeric=new Class({Extends:TableJs.Filters.Default,hasJokers:false,match:function(cellValue){var ret;if(this.input.value.length===0){ret=true;}else{var cellVal=this.getComparableObject(cellValue);if(this.op.name==='NONE'){ret=this.column.compare(cellVal,this.filterVal)===0;}else{ret=this.parent(cellValue);}}
return ret;},updateComputedProp:function(){this.op=TableJs.FilterUtils.getOperator(this.input.value);this.filterVal=this.getComparableObject(this.input.value.substring(this.op.length));},getComparableObject:function(value){var num=value;if(typeof value==='string'){num=value.replace(',','.');}
if(!isNaN(num)){return Number.from(num);}
return 0;}});TableJs.Filters.DateBetween=new Class({Extends:TableJs.Filters.Abstract,input:{},build:function(){this.container=new Element('div',{'class':'filter-between'});this.container.adopt(this.buildDateField(1,'from','du'),this.buildDateField(2,'to','au'));return this.container;},buildDateField:function(num,name,lbl){var id=this.tableJs.id+'dbw'+num+'-'+this.column.name;var div=new Element('div',{'class':'between-'+num});var label=new Element('label',{'for':id,text:lbl});var input=new Element('input',{id:id,type:'text',maxLength:10,size:10,'autocomplete':'off','placeholder':'jj/mm/aaaa'});input.addEvent('keyup',this.firterUpdated.bind(this));if(typeof this.column.rawdata.filterValue==='object'){input.set('value',this.column.rawdata.filterValue[name]||'');}
this.input[name]=input;div.adopt(label,input);return div;},js:function(){for(var name in this.input){var picker=new DatePicker(this.input[name].id,{toggle:this.input[name].id+'_calendrier',pickerClass:'datepicker dpstandard',linkTitle:'Aide à la saisie de date'});picker.addEvent('select',this.firterUpdated.bind(this));}},firterUpdated:function(event){var forbiddenKeys=[9,16,17,37,38,39,40];if(!forbiddenKeys.contains(event.code)){this.delayedNotifyUpdate();}},isFilterValid:function(){var minValid=this.input.from.value.length===0||this.input.from.value.length===10;var maxValid=this.input.to.value.length===0||this.input.to.value.length===10;return(minValid&&maxValid);},match:function(cellValue){if(!this.isFilterValid()){return false;}else if(this.input.from.value===''&&this.input.to.value===''){return true;}else if(!cellValue){return false;}
var cellDate=Date.parse(cellValue);if(this.input.to.value===''){return cellDate>=this.minDate;}
if(this.input.from.value===''){return cellDate<=this.maxDate;}
return(cellDate>=this.minDate&&cellDate<=this.maxDate);},reset:function(){if(typeof this.column.rawdata.filterValue==='object'){this.input.from.value=this.column.rawdata.filterValue.from||'';this.input.to.value=this.column.rawdata.filterValue.to||'';}else{this.input.from.value='';this.input.to.value='';}
this.notifyUpdate();},updateComputedProp:function(){this.minDate=Date.parse(this.input.from.value);this.maxDate=Date.parse(this.input.to.value);}});TableJs.Filters.Combo=new Class({Extends:TableJs.Filters.Abstract,build:function(){this.select=new Element('select',{title:'Filtre sur la colonne '+this.column.label});var distinctValues=this.column.values.filter(function(value,index,self){return self.indexOf(value)===index;});var opts=[];opts.push(new Element('option'));distinctValues.each(function(val){var opt=new Element('option',{value:val,text:val});if(this.column.rawdata.filterValue!==undefined&&this.column.rawdata.filterValue===val){opt.selected='selected';}
opts.push(opt);}.bind(this));this.select.adopt(opts);this.select.addEvent('change',this.notifyUpdate.bind(this));return this.select;},match:function(cellValue){if(this.select.value===''){return true;}
return cellValue===this.select.value;},reset:function(){var opts=this.select.getElements('option');this.select.selectedIndex=0;opts.each(function(opt){if(this.column.rawdata.filterValue!==undefined&&this.column.rawdata.filterValue===opt.value){opt.selected='selected';}else{opt.removeProperty('selected');}}.bind(this));this.notifyUpdate();}});
TableJs.Decorators={'default':{format:function(value){return''+value;},sortFunction:function(a,b){if(a===undefined){return-1;}
if(b===undefined){return 1;}
if(a>b){return 1;}else if(a<b){return-1;}
return 0;},filter:'Default'},shortdate:{css:'center',format:function(value){if(value){return Date.parse(value).format(Locale.get('Date.shortDate'));}else{return'';}},sortFunction:function(a,b){if(a===undefined){return-1;}
if(b===undefined){return 1;}
if(a>b){return 1;}else if(a<b){return-1;}
return 0;},filter:'DateBetween'},boolean:{css:'center',format:function(value){if(value){return'O';}else if(value===false||value==="false"){return'N';}else{return'';}},sortFunction:function(a,b){if(a===undefined){return-1;}
if(b===undefined){return 1;}
if(a>b){return 1;}else if(a<b){return-1;}
return 0;},filter:'Combo'},numeric:{css:'colnum',format:function(value){if(value){var num=new Number(value);return(num).format({group:' ',decimal:','});}else{return'';}},sortFunction:function(a,b){if(isNaN(a))return-1;if(isNaN(b))return 1;a=parseFloat(a);b=parseFloat(b);if(a>b){return 1;}else if(a<b){return-1;}
return 0;},filter:'Numeric'},checkbox:{css:'pictogramme cb-decorator no-row-link',format:function(value,row,opts){return'<input type="checkbox" title="Choix de la ligne '+(opts.rowIndex+1)+'" value="'+row[opts.column.value]+'" name="'+opts.column.name+'">';}},radio:{css:'pictogramme no-row-link',format:function(value,row,opts){return'<input type="radio" title="Sélection de la ligne '+(opts.rowIndex+1)+'" value="'+row[opts.column.value]+'" name="'+opts.column.name+'">';}},loupe:{css:'pictogramme',format:function(value,row,opts){var alt='Détail ligne '+(opts.rowIndex+1);var anchor=new Element('a',{"class":"vue-detail",title:alt});if(opts.column.js){var eventClickFunction=new Function('event',opts.column.js);anchor.addEvent('click',eventClickFunction.bind({row:row}));}
if(opts.column.href!==undefined){anchor.set('href',TableJs.buildHref(opts.column.href,opts.column.params,row));}
var img=new Element('img',TableJs.loupeImg);img.set('alt',alt);anchor.adopt(img);return anchor;}},autolink:{css:'no-row-link',format:function(value,row,opts){if(/.+@.+/.test(value)){return'<a href="mailto:'+value+'">'+value+'</a>';}else{return'<a href="'+value+'">'+value+'</a>';}}},longtext:{css:'cell',format:function(value){var div=new Element('div');div.set('text',value);return div;}}};
TableJs.Adapter=new Class({initialize:function(element){this.table=$(element);},getData:function(){var dataArray=[];this.table.getElements('tbody tr').each(function(row){var rowArr=[];row.getElements('td').each(function(cell){rowArr.push(cell.get('text'));});dataArray.push(rowArr);});return{data:dataArray};}});
TableJs.extend({components:{},errorMessage:"Erreur lors du chargement des données du tableau",waitingMessage:"Chargement des données du tableau en cours...",loupeImg:{width:30,height:30,src:"biblicnam/images/table/btn_vuedetail.gif"},filterHelp:{'class':'aide',title:'Aide filtrage tableau (nouvelle fenêtre)',onclick:"javascript:openPopUpSimple('Aide','biblicnam/html/infoTableau.html');return false",href:"biblicnam/html/infoTableau.html"},sortFirstOrder:'descending',initFromObject:function(container,data,options){return new TableJs(container,data,options);},initFromAJAX:function(container,url,options){container.empty();container.set('text',TableJs.waitingMessage);var request=new Request.JSON({url:url,method:'get',async:true,onFailure:function(){container.set('text',TableJs.errorMessage);},onError:function(){container.set('text',TableJs.errorMessage);},onSuccess:function(data){container.empty();new TableJs(container,data,options);}});request.send();},initFromHTML:function(element,options){var container=element.getParent('.tab-box');var adapter=new TableJs.Adapter(element);var data=adapter.getData();container.empty();return new TableJs(container,data,options);},buildHref:function(hrefSource,params,row){var href=hrefSource;if(params){href+=(href.indexOf('?')>-1?'&':'?');params.each(function(param){var obj={};if(typeof param==="string"){obj[param]=row[param];}else{obj[param.name]=row[param.value];}
href+=Object.toQueryString(obj);href+='&';});href=href.substr(0,href.length-1);}
return href;}});
var Carrousel=new Class({Implements:[Options],options:{interval:5000,animationDuration:1500,autoplay:true,navigate:'dot'},animation:null,currentIndex:0,isRunning:false,initialize:function(element,options){this.setOptions(options);this.element=element;this.wrapper=element.getElement('.c-wrapper');this.list=this.wrapper.getElement('.c-content');this.diapos=this.list.getElements('li');if(this.diapos.length<=1){return;}
this.dimensions=this.list.getDimensions();this.getCurrentDiapo().setStyles({left:0});this.getHiddenDiapos().setStyles({left:this.dimensions.width});this.buildRunBtn();this.options.navigate.split(' ').each(function(type){switch(type){case'dot':this.buildNavigDot();break;case'video':this.buildNavigVideo();break;default:break;}}.bind(this));if(this.options.autoplay){this.autoplay=this.options.autoplay;this.start();}
this.updateDiapoAria();this.addEvents();},addEvents:function(){this.element.addEvent('focusin',function(event){if(event.target===this.btnRun){this.resume=false;}else{this.resume=this.isRunning;this.stop();}}.bind(this));this.element.addEvent('focusout',function(){if(this.resume&&this.autoplay){this.start();}}.bind(this));},buildRunBtn:function(){this.btnRun=this.wrapper.getElement('.btn-run');if(!this.btnRun){this.btnRun=new Element('button',{'class':'btn-run','aria-label':'Lancer l\'animation'});this.btnRun.addEvent('click',function(event){if(this.isRunning){this.stop();this.autoplay=false;}else{this.start();this.autoplay=true;}}.bind(this));this.wrapper.adopt(this.btnRun);}},start:function(){this.isRunning=true;this.timer=this.next.periodical(this.options.interval,this);if(this.btnRun){this.btnRun.addClass('pause');this.btnRun.set('aria-label','Arrêter l\'animation');}},stop:function(){clearInterval(this.timer);this.timer=null;this.isRunning=false;if(this.btnRun){this.btnRun.removeClass('pause');this.btnRun.set('aria-label','Lancer l\'animation');}},setCurrent:function(index){this.element.fireEvent('change',[this.currentIndex,index]);this.currentIndex=index;},buildNavigDot:function(){var navig=this.wrapper.getElement('.c-navig-dot');var items=[];if(!navig){navig=new Element('ol',{'class':'c-navig-dot'});}
for(var i=0;i<this.diapos.length;i++){var li=new Element('li');var diapoId=this.element.id+'_i'+i;this.diapos[i].set('id',diapoId);var button=new Element('button',{'aria-label':'Diapo '+(i+1),'aria-controls':diapoId});if(i===0){li.addClass('current');button.set('title','Diapo '+(i+1)+' (courante)');}
li.adopt(button);button.addEvent('click',function(event){var liParent=event.target.getParent('li');var targetIndex=navig.getElements('li').indexOf(liParent);this.goTo(targetIndex);}.bind(this));items.push(li);}
this.element.addEvent('change',function(previous,next){var dots=this.wrapper.getElements('.c-navig-dot li');for(var i=0;i<dots.length;i++){var button=dots[i].getElement('button');if(i===next){dots[i].addClass('current');button.set('title','Diapo '+(i+1)+' (courante)');}else{dots[i].removeClass('current');button.removeProperty('title');}}}.bind(this));navig.adopt(items);this.wrapper.adopt(navig);},buildNavigVideo:function(){var btnNext=this.wrapper.getElement('.btn-next');var btnPrevious=this.wrapper.getElement('.btn-previous');if(!btnPrevious){btnPrevious=new Element('button',{'class':'btn-previous','aria-label':'Précédent'});btnPrevious.addEvent('click',function(event){this.stop();this.previous();}.bind(this));this.wrapper.adopt(btnPrevious);}
if(!btnNext){btnNext=new Element('button',{'class':'btn-next','aria-label':'Suivant'});btnNext.addEvent('click',function(event){this.stop();this.next();}.bind(this));this.wrapper.adopt(btnNext);}},getCurrentDiapo:function(){return this.diapos[this.currentIndex];},getHiddenDiapos:function(){return this.diapos.filter(function(diapo,index){return this.currentIndex!==index;},this);},next:function(){if(this.animation===null||!this.animation.isRunning()){var nextIndex=(this.currentIndex+1)%this.diapos.length;this.getHiddenDiapos().setStyles({left:this.dimensions.width});this.animate(this.getCurrentDiapo(),0,-this.dimensions.width);this.animate(this.diapos[nextIndex],this.dimensions.width,0);this.setCurrent(nextIndex);}},previous:function(){if(this.animation===null||!this.animation.isRunning()){var previousIndex=(this.currentIndex-1+this.diapos.length)%this.diapos.length;this.getHiddenDiapos().setStyles({left:-this.dimensions.width});this.animate(this.getCurrentDiapo(),0,this.dimensions.width);this.animate(this.diapos[previousIndex],-this.dimensions.width,0);this.setCurrent(previousIndex);}},goTo:function(index){if(index>=0){this.stop();this.setCurrent(index);for(var i=0;i<this.diapos.length;i++){if(i!==this.currentIndex){this.diapos[i].setStyles({left:this.dimensions.width});}else{this.diapos[i].setStyles({left:0});}}
this.updateDiapoAria();}},animate:function(diapo,origin,destination){this.animation=new Fx.Tween(diapo,{duration:this.options.animationDuration,property:'left',onComplete:this.updateDiapoAria.bind(this)});this.getHiddenDiapos().removeClass('hidden');this.animation.start(origin,destination);},updateDiapoAria:function(){this.getHiddenDiapos().set('aria-hidden',true);this.getHiddenDiapos().addClass('hidden');this.getCurrentDiapo().set('aria-hidden',false);this.getCurrentDiapo().removeClass('hidden');}});Carrousel.extend({components:{},init:function(element,options){this.components[element.id]=new Carrousel(element,options);}});
var Vote=new Class({Implements:[Options],options:{max:5,average:0,readonly:false},presentation:{build:function(elm,width){this.stars=new Element('div',{'class':'stars'});this.average=new Element('div',{'class':'average'});this.current=new Element('div',{'class':'current'});this.over=new Element('div',{'class':'over'});this.stars.adopt(this.average,this.current,this.over);this.stars.setStyle('width',width);this.stars.inject(elm,'before');}},current:0,average:0,initialize:function(element,options){this.setOptions(options);this.element=element;this.blockRadios=element.getElement('.radios');this.itemList=this.blockRadios.getElements('li');this.radios=element.getElements('.radios input');this.description=element.getElement('.description');this.radiogroup=element.getElement('fieldset');this.readonly=this.options.readonly;this.presentation.build(this.blockRadios,Vote.levelWidth*this.options.max);this.sync();this.setAverage(this.options.average);this.setReadOnly(this.options.readonly);this.element.vote=this;},sync:function(){var currentElm=this.radios.filter(function(input){return input.checked===true;})[0];if(currentElm){this.setCurrent(this.radios.indexOf(currentElm)+1);}else{this.setCurrent(0);}},setCurrent:function(note){this.current=note;for(var i=0;i<this.radios.length;i++){var li=this.radios[i].getParent('li');if(i===(note-1)){this.radios[i].checked=true;li.addClass('checked');}else{this.radios[i].checked=false;li.removeClass('outline').removeClass('checked');}}
this.presentation.current.setStyle('width',Vote.levelWidth*this.current);},outlineCurrent:function(){if(this.current>0){this.radios[this.current-1].getParent('li').addClass('outline');}},setAverage:function(note){this.average=note;this.presentation.average.setStyle('width',Vote.levelWidth*this.average);},setDescription:function(htmlDescription){this.description.set('html',htmlDescription);},addEvents:function(){this.radios.addEvent('focus',function(event){var liParent=event.target.getParent('li');this.setCurrent(this.itemList.indexOf(liParent)+1);this.outlineCurrent();}.bind(this));this.radios.addEvent('blur',function(event){event.target.getParent('li').removeClass('outline');});this.blockRadios.addEvent('click:relay(label)',this.eventClickId=this.buttonsClickListener.bind(this));this.radiogroup.addEvent('keydown',this.eventKeyId=this.buttonsKeydownListener.bind(this));this.blockRadios.addEvent('mouseover',this.eventMouseOverId=this.mouseOverListener.bind(this));this.blockRadios.addEvent('mouseleave',this.eventMouseOutId=this.mouseOutListener.bind(this));},removeEvents:function(){this.radios.removeEvents('focus');this.radios.removeEvents('blur');this.blockRadios.removeEvent('click:relay(label)',this.eventClickId);this.radiogroup.removeEvent('keydown',this.eventKeyId);this.blockRadios.removeEvent('mouseover',this.eventMouseOverId);this.blockRadios.removeEvent('mouseleave',this.eventMouseOutId);},setReadOnly:function(readonly){if(readonly){this.element.addClass('readonly');this.radios.set('disabled',true);this.itemList.removeClass('outline');this.removeEvents();}else{this.element.removeClass('readonly');this.radios.removeProperty('disabled');this.addEvents();}
this.readonly=readonly;},buttonsClickListener:function(event){var targetIndex=this.itemList.indexOf(event.target.getParent('li'));this.setCurrent(targetIndex+1);this.outlineCurrent();this.element.fireEvent('vote',targetIndex+1);},buttonsKeydownListener:function(event){if(event.key==='enter'){this.element.fireEvent('vote',this.current);}},mouseOverListener:function(event){if(event.target.get('tag')==='label'){var targetIndex=this.itemList.indexOf(event.target.getParent('li'));this.presentation.over.setStyle('width',Vote.levelWidth*(targetIndex+1));}},mouseOutListener:function(event){this.presentation.over.setStyle('width',0);}});Vote.extend({components:{},levelWidth:30,init:function(element,options){this.components[element.id]=new Vote(element,options);}});!function(){var w=window,d=w.document;if(w.onfocusin===undefined&&Browser.name!=='ie'){d.addEventListener('focus',addPolyfill,true);d.addEventListener('blur',addPolyfill,true);d.addEventListener('focusin',removePolyfill,true);d.addEventListener('focusout',removePolyfill,true);}
function addPolyfill(e){var type=e.type==='focus'?'focusin':'focusout';var event=new CustomEvent(type,{bubbles:true,cancelable:false});event.c1Generated=true;e.target.dispatchEvent(event);}
function removePolyfill(e){if(!e.c1Generated){d.removeEventListener('focus',addPolyfill,true);d.removeEventListener('blur',addPolyfill,true);d.removeEventListener('focusin',removePolyfill,true);d.removeEventListener('focusout',removePolyfill,true);}
setTimeout(function(){d.removeEventListener('focusin',removePolyfill,true);d.removeEventListener('focusout',removePolyfill,true);});}}();